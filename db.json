{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/downloads/code/echo_server.rs","path":"downloads/code/echo_server.rs","modified":0,"renderable":0},{"_id":"themes/hiker/source/css/archive.css","path":"css/archive.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/dialog.css","path":"css/dialog.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/header-post.css","path":"css/header-post.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/home.css","path":"css/home.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/vdonate.css","path":"css/vdonate.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/dialog.js","path":"js/dialog.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/home.js","path":"js/home.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/scripts.js","path":"js/scripts.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/vdonate.js","path":"js/vdonate.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/browser-support.png","path":"preview/browser-support.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/donation-btn.png","path":"preview/donation-btn.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-abstract.png","path":"preview/preview-abstract.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/theme-color.png","path":"preview/theme-color.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/bootstrap.css","path":"css/bootstrap.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/bootstrap.js","path":"js/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/jquery-3.1.1.min.js","path":"js/jquery-3.1.1.min.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/avatar.jpg","path":"css/images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/homelogo.jpg","path":"css/images/homelogo.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/mylogo.jpg","path":"css/images/mylogo.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/mylogo.png","path":"css/images/mylogo.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/rocket.png","path":"css/images/rocket.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/sample.jpg","path":"css/images/sample.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-mobile.png","path":"preview/preview-mobile.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/pose.jpg","path":"css/images/pose.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/home-bg.jpg","path":"css/images/home-bg.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/code-theme.jpg","path":"preview/code-theme.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/Windmills.jpg","path":"css/images/Windmills.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-pc.png","path":"preview/preview-pc.png","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"a431652667c5c250f5d6cfd58f36ee4b743e1a40","modified":1531833699049},{"_id":"themes/hiker/.git","hash":"138ad5311d62fbf6d9d029c9d94d997fb191138d","modified":1531829339696},{"_id":"themes/hiker/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1531818064000},{"_id":"themes/hiker/.travis.yml","hash":"24851843a40973daaee47b2697e8b0dc4e6556b3","modified":1531818064000},{"_id":"themes/hiker/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1531818064000},{"_id":"themes/hiker/LICENSE","hash":"4ea4173f28adf2f688a59e3c5e6fa833bcdf7ced","modified":1531818064000},{"_id":"themes/hiker/README.cn.md","hash":"e87c3744f1fe3edeaad479a90e7e1aa66bbf6fd2","modified":1531818064000},{"_id":"themes/hiker/README.md","hash":"4973def0c3cb2ac856071de479d11ff76087b8c6","modified":1531818064000},{"_id":"themes/hiker/_config.yml","hash":"e660ce9d61f97a183d4df5adc92f63e903d17b48","modified":1533888752614},{"_id":"themes/hiker/package.json","hash":"ac7430d36de467f41a686fb716c8538c52f0e206","modified":1531818064000},{"_id":"source/_drafts/bt.md","hash":"176253bd36e93aec4973a2d0e09b70721d76434b","modified":1533889245859},{"_id":"source/_posts/blockchain.md","hash":"3c562fcc002da5e8bc64d281e6a67d90c4ca5b5f","modified":1533889279649},{"_id":"source/_posts/hello-world.md","hash":"8caa744b7d8b222158dab08e9e7990c33050933c","modified":1531833699049},{"_id":"source/_posts/tcp.md","hash":"602a232c9625aef5816e670781f5009254a64f59","modified":1533889360596},{"_id":"source/_posts/Âµtp.md","hash":"31d4e28dbeb5a84494d14a5169bf585c81549030","modified":1533889274033},{"_id":"source/about/index.md","hash":"9fa61ee360e96cb902169640084f3a8d358b333d","modified":1533382173608},{"_id":"source/tags/index.md","hash":"2f7d5e58da960f1aeeeaf8bf12f9d5e38c39ea73","modified":1531833699049},{"_id":"themes/hiker/languages/de.yml","hash":"3e244f9c48b641edd821bdeb743bdbcd0919685f","modified":1531818064000},{"_id":"themes/hiker/languages/default.yml","hash":"b43df4b426335107d87fe27bb0a8279ec83a4272","modified":1531818064000},{"_id":"themes/hiker/languages/en.yml","hash":"b43df4b426335107d87fe27bb0a8279ec83a4272","modified":1531818064000},{"_id":"themes/hiker/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1531818064000},{"_id":"themes/hiker/languages/fr.yml","hash":"f5ec801074df04e1e1fd097fa7cbdf7f57330374","modified":1531818064000},{"_id":"themes/hiker/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1531818064000},{"_id":"themes/hiker/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1531818064000},{"_id":"themes/hiker/languages/pt.yml","hash":"46bd5f121f4704e2cd6c0950ec18b549f03bfe5c","modified":1531818064000},{"_id":"themes/hiker/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1531818064000},{"_id":"themes/hiker/languages/zh-CN.yml","hash":"24c12fc7e4ff83ee3fa4dff17ce961bb5fb1a393","modified":1531818064000},{"_id":"themes/hiker/languages/zh-TW.yml","hash":"5e641b8a83a89d5ef12dfc008d2e75adbea0e24b","modified":1531818064000},{"_id":"themes/hiker/layout/archive.ejs","hash":"877ed5677c6fc12a3050843dd3d97cb6b53caceb","modified":1531818064000},{"_id":"themes/hiker/layout/categories.ejs","hash":"ac33c728b49863d3ca961547d33209618f591e4f","modified":1531818064000},{"_id":"themes/hiker/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1531818064000},{"_id":"themes/hiker/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1531818064000},{"_id":"themes/hiker/layout/layout.ejs","hash":"aa685e9762a356f9b677e6f9d17e04694492fb83","modified":1531818064000},{"_id":"themes/hiker/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1531818064000},{"_id":"themes/hiker/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1531818064000},{"_id":"themes/hiker/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1531818064000},{"_id":"themes/hiker/layout/tags.ejs","hash":"340ded907f5f52ef73c50bb9f1f27bf2f5de3fa7","modified":1531818064000},{"_id":"themes/hiker/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1531818064000},{"_id":"source/_posts/tcp/todo.mdx","hash":"90d7ea919af484e49846964c1a2edf3d88720ee2","modified":1532931829016},{"_id":"source/downloads/code/echo_server.rs","hash":"72bc85f2231a41ed51f82848e3c22382d85e32ff","modified":1533382579951},{"_id":"source/downloads/code/utp_header_format.html","hash":"3cd1268fc5232749c6269a51af79f85df232957e","modified":1533397987636},{"_id":"themes/hiker/layout/_partial/after-footer.ejs","hash":"cf844d9dda22b63e990c2b9e5c8bee82c41fd3aa","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/archive-post.ejs","hash":"55d661b63ffe41489bffe4d0570af50a1b952d63","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/article.ejs","hash":"5221db20b992f85f125f4babf37a08c180eb1d0b","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/baidu-analytics.ejs","hash":"5776714a003d2b96b04b5399f67e0899d821247e","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/archive.ejs","hash":"538346df9267cb701bb985faf0d5de2fa4c1e4e7","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/cnzz-analytics.ejs","hash":"87410fedf15383f119706c96f71552be14248d57","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/copyright.ejs","hash":"e5283a10763a6c279b8221a56a5e8845fdd6d725","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/dialog.ejs","hash":"453934257d0efa8124afc686f299e7a21e7a1c4d","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/comment.ejs","hash":"1471bafc3e1b348cdd081ad8f79e6656323ec04b","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/donate.ejs","hash":"046e168c6aad9889199c9a48b57dc973b4f46dab","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/facebook-sdk.ejs","hash":"06038db50d2e1febdefa3f8e1512b332c7da5a17","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/footer.ejs","hash":"dfbfe362953c8d44c875554f55fad74bd80b2afb","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/head.ejs","hash":"e2c9ac22c97944c9c25a8feb6d2ff712b07e6ce7","modified":1532275284455},{"_id":"themes/hiker/layout/_partial/header-post.ejs","hash":"f30b6833bdb54e5446a2078a792e4d9ef4551c24","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/header.ejs","hash":"09b8060c37b578785efdd8e06fa1388b816d44ca","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/tencent-analytics.ejs","hash":"93120ad06c5d73ca777470faf570e993a805e049","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/archive.ejs","hash":"9fffde4e794b35f07c96eaec6d9373a40014da8f","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/busuanzi-analytics.ejs","hash":"7de568681c315e88127bec120b8100ce6640210f","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/social.ejs","hash":"013beb5d78dfe34507b766f551b4a43ff628a5fe","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1531818064000},{"_id":"themes/hiker/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1531818064000},{"_id":"themes/hiker/layout/search/index-mobile.ejs","hash":"50a727ac1dfe3073eb6fa6699ba01e66f4ac41c0","modified":1531818064000},{"_id":"themes/hiker/layout/search/baidu.ejs","hash":"3e603a702d20c53fd3bcbeb570a16a86d54781ce","modified":1531818064000},{"_id":"themes/hiker/layout/search/index.ejs","hash":"a027a663baaffa212f5eb4947d43008419376177","modified":1531818064000},{"_id":"themes/hiker/layout/search/insight.ejs","hash":"c97ef6478f8cd45458614cd78511c23cbd4e7a28","modified":1531818064000},{"_id":"themes/hiker/layout/search/swiftype.ejs","hash":"379e66d2c13526e72e4120c443f95fccf4edef71","modified":1531818064000},{"_id":"themes/hiker/source/css/_extend.styl","hash":"5a2b18b03c18c92f130771aa97737e100202d21b","modified":1531818064000},{"_id":"themes/hiker/source/css/_variables.styl","hash":"fa78bacee554503760d9309b3ed10ec85dfcead1","modified":1532258721350},{"_id":"themes/hiker/source/css/archive.css","hash":"17cc72203cad1b0be66008d662c7494507aaee8b","modified":1531818064000},{"_id":"themes/hiker/source/css/dialog.css","hash":"5e0333adf3f496e0d443767fe228a1d4b1a2bafc","modified":1531818064000},{"_id":"themes/hiker/source/css/header-post.css","hash":"3f6d1f5593a353b4b05a67ee14e04ec9c986db21","modified":1531818064000},{"_id":"themes/hiker/source/css/home.css","hash":"2a7bfef438468b5b8be3f84ea6818156d371077d","modified":1531818064000},{"_id":"themes/hiker/source/css/style.styl","hash":"cbf244726bf1fde4d278b4d3768e289f9f64ae35","modified":1532258770257},{"_id":"themes/hiker/source/css/vdonate.css","hash":"bca2d291a71e7358654c51f23e8bfb467b2bc8b2","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1531818064000},{"_id":"themes/hiker/source/js/dialog.js","hash":"01e8b337c1721e0486fd5044f98b233e84ba1985","modified":1531818064000},{"_id":"themes/hiker/source/js/home.js","hash":"e403c3290d76c5f58571cbfe4414236e41a7ac94","modified":1531818064000},{"_id":"themes/hiker/source/js/insight.js","hash":"f79ab175d1c8c4fb59328ee4fd9eb95808eb0be5","modified":1531818064000},{"_id":"themes/hiker/source/js/scripts.js","hash":"e06a8948375df71cbf77abf8617db438ece811b3","modified":1531818064000},{"_id":"themes/hiker/source/js/totop.js","hash":"29bb40144ac238d22b25d59df465aff8dc38bfd0","modified":1531818064000},{"_id":"themes/hiker/source/js/vdonate.js","hash":"5738414c642d30e43943a69287b3d25a0b6be135","modified":1531818064000},{"_id":"themes/hiker/source/preview/browser-support.png","hash":"a6d8498553550c6b18a8f22bcd2f53c993c7d677","modified":1531818064000},{"_id":"themes/hiker/source/preview/donation-btn.png","hash":"ad78b1605b162e2399a1cdc5232f6a44298dba6c","modified":1531818064000},{"_id":"themes/hiker/source/preview/preview-abstract.png","hash":"3d18ad9ba38fe24770ba6758d8f1bb242f669ce3","modified":1531818064000},{"_id":"themes/hiker/source/preview/theme-color.png","hash":"725130ceea5e41bb2cc60b31e45275b4b0cc77b3","modified":1531818064000},{"_id":"source/_posts/Âµtp/udp_utp_header.png","hash":"c5f80e8516d5c7f55244a105e973e9cd4f27f070","modified":1533398087000},{"_id":"source/_posts/tcp/tcp_header.png","hash":"69d8d319c43fa7ce0be86f378572c8ee05e9c605","modified":1532088268872},{"_id":"themes/hiker/layout/_widget/curtains.ejs","hash":"630c11a237602b478df5215982face6681943f21","modified":1531818064000},{"_id":"themes/hiker/source/css/bootstrap.css","hash":"64fdc2e7c3f8a164d21c5632b5adbbb9990ea802","modified":1531818064000},{"_id":"themes/hiker/source/js/bootstrap.js","hash":"3b965a36a6b08854ad6eddedf85c5319fd392b4a","modified":1531818064000},{"_id":"themes/hiker/source/js/jquery-3.1.1.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1531818064000},{"_id":"source/_posts/tcp/congestion_control_example.png","hash":"02433df0635516013be7c5d96affa7d20cc883e7","modified":1533478758000},{"_id":"source/_posts/tcp/tcp_connection.png","hash":"987f536dca3acefdde97178c2087276fb69c41e1","modified":1532241966764},{"_id":"source/_posts/tcp/sliding_window.png","hash":"27e68439f11775d0816b712605458a940ad255bf","modified":1532857309241},{"_id":"themes/hiker/layout/_partial/post/busuanzi-analytics.ejs","hash":"4ef5022062c8ee59f3413bc92e6b3ae0d5020738","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/category.ejs","hash":"877a164bb13b46756eb111ec7bfe338a1eb36ad1","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/mathjax.ejs","hash":"571c19f57c2b38ac5cd9b8f811cfad53b38616cf","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/date.ejs","hash":"380985bb414f9a0d517834f65cce57bc0b493d8c","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/title.ejs","hash":"a61267f27f2148321e549344be91dbc4e22e1a48","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/urlconvert.ejs","hash":"2133f1029632417f9043b9d4749d580ed0c75db0","modified":1531818064000},{"_id":"themes/hiker/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1531818064000},{"_id":"themes/hiker/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/archive.styl","hash":"28e78ec6e703417c50447c4710ad4bcf6cf48008","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/article.styl","hash":"854aa3b19edcc82fcfd2d85af49bf867f4b14a45","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/comment.styl","hash":"f23dbf9c1224559314f7d10b7fee030a9ffab58a","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/footer.styl","hash":"ce9f600140d5cd246b59374f615c8a512bc5ecab","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/header-post.styl","hash":"e95431443eb28d45390de733068f87134e5780da","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/header.styl","hash":"4bbc6be125b55de743ad00a5ddf751eba1f617c4","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/highlight.styl","hash":"86aa65cbefd4ac7e1bd5b56872af3c34f2b98463","modified":1532261713763},{"_id":"themes/hiker/source/css/_partial/insight.styl","hash":"8cd23d8f0ce2d083dd7409a1a95315029070cbb8","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/mobile.styl","hash":"fcfbaf24634519063af46953e0eb733a8ada5556","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/sidebar-aside.styl","hash":"1b4caeb15892b2c34cc063065b9c408eb00216a6","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/sidebar-bottom.styl","hash":"36886d5436bfafbf980539be8dbc419631b8b6ee","modified":1531818064000},{"_id":"themes/hiker/source/css/_partial/sidebar.styl","hash":"e93ca6bb5b709accd667b939980ad39582fe062b","modified":1531818064000},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1531818064000},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1531818064000},{"_id":"themes/hiker/source/css/images/avatar.jpg","hash":"d685c61842df6ff3f44a96ba4ac15117502168ee","modified":1531818411000},{"_id":"themes/hiker/source/css/images/homelogo.jpg","hash":"4bfc9650c4fd6e60b09ae29f888a819cdf88e9fe","modified":1531818412000},{"_id":"themes/hiker/source/css/images/mylogo.jpg","hash":"8a890ea06da34c2be81ca28d96f3d44a2d7fcdd7","modified":1531818412000},{"_id":"themes/hiker/source/css/images/mylogo.png","hash":"6c6233232a427cd33129e2ea6268e878a57e9ac7","modified":1531818412000},{"_id":"themes/hiker/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1531818413000},{"_id":"themes/hiker/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1531818064000},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1531818064000},{"_id":"themes/hiker/layout/_partial/post/gallery.ejs","hash":"30028f10a4f03561e53da323d06b292e1ae7990c","modified":1531818064000},{"_id":"themes/hiker/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1531818064000},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1531818064000},{"_id":"source/_posts/tcp/wireshark.png","hash":"14661db4e3571db5e1315f221773ec37e6f67b6b","modified":1532264688005},{"_id":"themes/hiker/source/css/images/sample.jpg","hash":"36b49a2f0183ac20207c44a8172e410e4d6865e6","modified":1531818413000},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1531818064000},{"_id":"source/_posts/Âµtp/wireshark.png","hash":"f8da641e627808d136eeb69f7abdb497008b2c75","modified":1533472159000},{"_id":"themes/hiker/source/preview/preview-mobile.png","hash":"7679a50aef93fc364cbcee4a52cd84604bf741b1","modified":1531818064000},{"_id":"themes/hiker/source/css/images/pose.jpg","hash":"4d394a662e7d6d2de6a4598688c7cd3dba5c2fa3","modified":1531818412000},{"_id":"themes/hiker/source/css/images/home-bg.jpg","hash":"e8dcdb6e03bd02d831bae593feccb7028c9dc5e9","modified":1531818411000},{"_id":"themes/hiker/source/preview/code-theme.jpg","hash":"8c8512fd04e6106033656d10e92d51de76cca6d8","modified":1531818064000},{"_id":"themes/hiker/source/css/images/Windmills.jpg","hash":"19e411118d22c321710c1f2aeca14e27678e369e","modified":1531818413000},{"_id":"themes/hiker/source/preview/preview-pc.png","hash":"2471e0697938721e4c5d7c66940e165c59a31a0f","modified":1531818064000},{"_id":"public/content.json","hash":"001859f9a6f57f693f2776a812000b43a9e34732","modified":1533889379120},{"_id":"public/about/index.html","hash":"6499cfd96992d18fe0a11242650350d63d8e792b","modified":1533889379217},{"_id":"public/tags/index.html","hash":"533852d5ed3c695285f854b3c467bfb35b243e83","modified":1533889379217},{"_id":"public/2018/07/17/hello-world/index.html","hash":"53e273ce78b41a7e2445d3a18800e71df1c4275e","modified":1533889379217},{"_id":"public/archives/index.html","hash":"c4e45b94241a4c73190ab8fb9676d51432b02afc","modified":1533889379217},{"_id":"public/archives/2018/index.html","hash":"909a4df5febfbf186f2db22fe0ab5d446276321b","modified":1533889379217},{"_id":"public/archives/2018/07/index.html","hash":"0a8623cd6dd48c8131392db80a4b933a7a1f5c0f","modified":1533889379217},{"_id":"public/archives/2018/08/index.html","hash":"fd0d011dfaca71ed7206d21dcb3977e327ba917d","modified":1533889379217},{"_id":"public/tags/BlockChain/index.html","hash":"df051fdd5ecbb0cb14be8f4d05d8c8fb558549f1","modified":1533889379218},{"_id":"public/tags/Essay/index.html","hash":"947449721aae3415f10dc1b4a38cc263417f3037","modified":1533889379218},{"_id":"public/tags/Network/index.html","hash":"10b7f17b99daa230574cee54c15d29c416ab4624","modified":1533889379218},{"_id":"public/tags/BT/index.html","hash":"f36cf46eaf6bab2252fe73a542e7d23059d6f624","modified":1533889379218},{"_id":"public/downloads/code/utp_header_format.html","hash":"4a240788d23af0fbdb3dd44120a88346f0002b16","modified":1533889379218},{"_id":"public/2018/08/04/Âµtp/index.html","hash":"17d4501d0220b2b34f57937e3a6adfec051509d1","modified":1533889379218},{"_id":"public/2018/08/04/blockchain/index.html","hash":"312e2757f233ab71a535b5d02abc4d7a203af4c1","modified":1533889379218},{"_id":"public/2018/07/20/tcp/index.html","hash":"b6520c3a1af38c72f6d63f9be33ac05d61531095","modified":1533889379218},{"_id":"public/index.html","hash":"a7eb730b4208298869b4e9f7cd7460cac5f94c6b","modified":1533889379218},{"_id":"public/CNAME","hash":"a431652667c5c250f5d6cfd58f36ee4b743e1a40","modified":1533889379229},{"_id":"public/downloads/code/echo_server.rs","hash":"72bc85f2231a41ed51f82848e3c22382d85e32ff","modified":1533889379229},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1533889379230},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1533889379230},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1533889379230},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1533889379230},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1533889379230},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1533889379231},{"_id":"public/preview/browser-support.png","hash":"a6d8498553550c6b18a8f22bcd2f53c993c7d677","modified":1533889379231},{"_id":"public/preview/donation-btn.png","hash":"ad78b1605b162e2399a1cdc5232f6a44298dba6c","modified":1533889379231},{"_id":"public/preview/preview-abstract.png","hash":"3d18ad9ba38fe24770ba6758d8f1bb242f669ce3","modified":1533889379231},{"_id":"public/preview/theme-color.png","hash":"725130ceea5e41bb2cc60b31e45275b4b0cc77b3","modified":1533889379231},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1533889379231},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1533889379231},{"_id":"public/css/images/avatar.jpg","hash":"d685c61842df6ff3f44a96ba4ac15117502168ee","modified":1533889379231},{"_id":"public/css/images/homelogo.jpg","hash":"4bfc9650c4fd6e60b09ae29f888a819cdf88e9fe","modified":1533889379231},{"_id":"public/css/images/mylogo.jpg","hash":"8a890ea06da34c2be81ca28d96f3d44a2d7fcdd7","modified":1533889379231},{"_id":"public/css/images/mylogo.png","hash":"6c6233232a427cd33129e2ea6268e878a57e9ac7","modified":1533889379231},{"_id":"public/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1533889379231},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1533889379231},{"_id":"public/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1533889379232},{"_id":"public/2018/07/20/tcp/todo.mdx","hash":"90d7ea919af484e49846964c1a2edf3d88720ee2","modified":1533889379232},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1533889379723},{"_id":"public/2018/08/04/Âµtp/udp_utp_header.png","hash":"c5f80e8516d5c7f55244a105e973e9cd4f27f070","modified":1533889379723},{"_id":"public/2018/07/20/tcp/tcp_header.png","hash":"69d8d319c43fa7ce0be86f378572c8ee05e9c605","modified":1533889379724},{"_id":"public/css/archive.css","hash":"17cc72203cad1b0be66008d662c7494507aaee8b","modified":1533889379730},{"_id":"public/css/dialog.css","hash":"5e0333adf3f496e0d443767fe228a1d4b1a2bafc","modified":1533889379731},{"_id":"public/css/header-post.css","hash":"3f6d1f5593a353b4b05a67ee14e04ec9c986db21","modified":1533889379731},{"_id":"public/css/home.css","hash":"2a7bfef438468b5b8be3f84ea6818156d371077d","modified":1533889379731},{"_id":"public/css/vdonate.css","hash":"bca2d291a71e7358654c51f23e8bfb467b2bc8b2","modified":1533889379731},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1533889379731},{"_id":"public/js/dialog.js","hash":"01e8b337c1721e0486fd5044f98b233e84ba1985","modified":1533889379732},{"_id":"public/js/home.js","hash":"e403c3290d76c5f58571cbfe4414236e41a7ac94","modified":1533889379733},{"_id":"public/js/scripts.js","hash":"e06a8948375df71cbf77abf8617db438ece811b3","modified":1533889379733},{"_id":"public/js/totop.js","hash":"29bb40144ac238d22b25d59df465aff8dc38bfd0","modified":1533889379733},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1533889379734},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1533889379734},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1533889379734},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1533889379734},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1533889379734},{"_id":"public/css/style.css","hash":"329ea60711f90adfdb30697da9b92a3d7498e39a","modified":1533889379734},{"_id":"public/2018/07/20/tcp/congestion_control_example.png","hash":"02433df0635516013be7c5d96affa7d20cc883e7","modified":1533889379735},{"_id":"public/2018/07/20/tcp/sliding_window.png","hash":"27e68439f11775d0816b712605458a940ad255bf","modified":1533889379735},{"_id":"public/2018/07/20/tcp/tcp_connection.png","hash":"987f536dca3acefdde97178c2087276fb69c41e1","modified":1533889379736},{"_id":"public/js/insight.js","hash":"f79ab175d1c8c4fb59328ee4fd9eb95808eb0be5","modified":1533889379746},{"_id":"public/js/vdonate.js","hash":"5738414c642d30e43943a69287b3d25a0b6be135","modified":1533889379746},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1533889379746},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1533889379752},{"_id":"public/css/images/sample.jpg","hash":"36b49a2f0183ac20207c44a8172e410e4d6865e6","modified":1533889379753},{"_id":"public/2018/07/20/tcp/wireshark.png","hash":"14661db4e3571db5e1315f221773ec37e6f67b6b","modified":1533889379753},{"_id":"public/preview/preview-mobile.png","hash":"7679a50aef93fc364cbcee4a52cd84604bf741b1","modified":1533889379761},{"_id":"public/2018/08/04/Âµtp/wireshark.png","hash":"f8da641e627808d136eeb69f7abdb497008b2c75","modified":1533889379762},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1533889379767},{"_id":"public/css/images/pose.jpg","hash":"4d394a662e7d6d2de6a4598688c7cd3dba5c2fa3","modified":1533889379767},{"_id":"public/css/images/home-bg.jpg","hash":"e8dcdb6e03bd02d831bae593feccb7028c9dc5e9","modified":1533889379773},{"_id":"public/css/images/Windmills.jpg","hash":"19e411118d22c321710c1f2aeca14e27678e369e","modified":1533889379773},{"_id":"public/js/bootstrap.js","hash":"3b965a36a6b08854ad6eddedf85c5319fd392b4a","modified":1533889379777},{"_id":"public/js/jquery-3.1.1.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1533889379781},{"_id":"public/preview/code-theme.jpg","hash":"8c8512fd04e6106033656d10e92d51de76cca6d8","modified":1533889379783},{"_id":"public/preview/preview-pc.png","hash":"2471e0697938721e4c5d7c66940e165c59a31a0f","modified":1533889379784},{"_id":"public/css/bootstrap.css","hash":"64fdc2e7c3f8a164d21c5632b5adbbb9990ea802","modified":1533889379786}],"Category":[],"Data":[],"Page":[{"title":"å³äºåç¶è­","_content":" - å­å¨å·ä¸ï¼éèå¦æ¯å¤«ï¼ä¸èæå¤ã\n - \"Computers are useless. They can only give you answers.\"\n\n## Find Me\n[Email](mailto:zjharpoonman@gmail.com) | [Github](https://github.com/0ranga) | [Douban](https://www.douban.com/people/69104080/) | [NeteaseMusic](http://music.163.com/#/user/home?id=1352908)\n\n\n--- \n<!-- netease music -->\n<div  style=\" text-align: center;\">\n{% iframe //music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430 330 330 %}\n</div>","source":"about/index.md","raw":"---\ntitle: å³äºåç¶è­\n---\n - å­å¨å·ä¸ï¼éèå¦æ¯å¤«ï¼ä¸èæå¤ã\n - \"Computers are useless. They can only give you answers.\"\n\n## Find Me\n[Email](mailto:zjharpoonman@gmail.com) | [Github](https://github.com/0ranga) | [Douban](https://www.douban.com/people/69104080/) | [NeteaseMusic](http://music.163.com/#/user/home?id=1352908)\n\n\n--- \n<!-- netease music -->\n<div  style=\" text-align: center;\">\n{% iframe //music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430 330 330 %}\n</div>","date":"2018-08-04T11:29:33.608Z","updated":"2018-08-04T11:29:33.608Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjknq4rf500012ofn8w7jtgxw","content":"<ul>\n<li>å­å¨å·ä¸ï¼éèå¦æ¯å¤«ï¼ä¸èæå¤ã</li>\n<li>âComputers are useless. They can only give you answers.â</li>\n</ul>\n<h2 id=\"Find-Me\"><a href=\"#Find-Me\" class=\"headerlink\" title=\"Find Me\"></a>Find Me</h2><p><a href=\"mailto:zjharpoonman@gmail.com\" target=\"_blank\" rel=\"noopener\">Email</a> | <a href=\"https://github.com/0ranga\" target=\"_blank\" rel=\"noopener\">Github</a> | <a href=\"https://www.douban.com/people/69104080/\" target=\"_blank\" rel=\"noopener\">Douban</a> | <a href=\"http://music.163.com/#/user/home?id=1352908\" target=\"_blank\" rel=\"noopener\">NeteaseMusic</a></p>\n<hr>\n<!-- netease music -->\n<div style=\" text-align: center;\"><br><iframe src=\"//music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430\" width=\"330\" height=\"330\" frameborder=\"0\" allowfullscreen></iframe><br></div>","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>å­å¨å·ä¸ï¼éèå¦æ¯å¤«ï¼ä¸èæå¤ã</li>\n<li>âComputers are useless. They can only give you answers.â</li>\n</ul>\n<h2 id=\"Find-Me\"><a href=\"#Find-Me\" class=\"headerlink\" title=\"Find Me\"></a>Find Me</h2><p><a href=\"mailto:zjharpoonman@gmail.com\" target=\"_blank\" rel=\"noopener\">Email</a> | <a href=\"https://github.com/0ranga\" target=\"_blank\" rel=\"noopener\">Github</a> | <a href=\"https://www.douban.com/people/69104080/\" target=\"_blank\" rel=\"noopener\">Douban</a> | <a href=\"http://music.163.com/#/user/home?id=1352908\" target=\"_blank\" rel=\"noopener\">NeteaseMusic</a></p>\n<hr>\n<!-- netease music -->\n<div style=\" text-align: center;\"><br><iframe src=\"//music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430\" width=\"330\" height=\"330\" frameborder=\"0\" allowfullscreen></iframe><br></div>"},{"title":"tags","date":"2018-04-04T14:58:50.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-04-04 22:58:50\ntype: \"tags\"\n---\n","updated":"2018-07-17T13:21:39.049Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjknq4rf700032ofn1dqczcgt","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","source":"downloads/code/utp_header_format.html","raw":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","date":"2018-08-04T15:53:07.636Z","updated":"2018-08-04T15:53:07.636Z","path":"downloads/code/utp_header_format.html","title":"","comments":1,"layout":"page","_id":"cjknq4rgb000h2ofn0302a8ft","content":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","site":{"data":{}},"excerpt":"","more":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>"}],"Post":[{"title":"bt","_content":"","source":"_drafts/bt.md","raw":"---\ntitle: bt\ntags:\n---\n","slug":"bt","published":0,"date":"2018-08-10T08:20:45.859Z","updated":"2018-08-10T08:20:45.859Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjknq4rez00002ofng986jy0i","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"æ¢ç´¢ BlockChain","keywords":[],"date":"2018-08-04T09:00:00.000Z","_content":"Bitcoin å¸¦æ¥ç BlockChain ææ¯ä¸å¾æ åãè®¡åä»ç°å¨å¼å§è½å¤æ¯è¾ç³»ç»å°å­¦ä¹ ä¸è®°å½ç¸å³ææ¯ç¥è¯ãè¿ç¯æç« æ¯ä¸ªè¿åº¦è¡¨ä¹æ¯ä¸ä¸ªç®å½ã\n<!-- more -->\n## Bitcoin\nBitcoin çææ¡£éå¸¸ä¸°å¯ï¼ä¹åææ¯ç»å [Bitcoin Developer Reference](https://bitcoin.org/en/developer-reference) ä¸ [Bitcoin Developer Guide](https://bitcoin.org/en/developer-guide) è¿è¡å­¦ä¹ çï¼åå¾éå¸¸è¯¦ç»ï¼èä¸æ¯è¾å®¹æçè§£ã\n\n## IPFSï¼æéæä»¶ç³»ç» \n> IPFS is the Distributed Web. \n> A peer-to-peer hypermedia protocol to make the web faster, safer, and more open.\n> IPFS aims to replace HTTP and build a better web for all of us.\n\nIPFS çç®æ æ¯åä»£ HTTPï¼çä¸å»åå¾å¤ç½ç®ä¹¦é¡¹ç®ä¸æ ·çé¼è½°è½°ï¼ä½æ¯å¼åèç¡®å®å¨ä¸æ­åè¿ä¸ªç®æ æ¨è¿ãä½å¨ä¸ªäººç°å¨çè®¤è¯ä¸­ï¼IPFS æ´åæ¯ä»çå­é¢ææ **æéæä»¶ç³»ç»** æè¡¨è¾¾çä¸æ ·ï¼æ¯æ°æ®çè½½ä½ï¼èä¸æ¯å»ä¸­å¿åçãè¿å¾å®¹æè®©äººèæ³å° BitTorrentï¼èæ¥ä¸æ¥å¯¹ IPFS çæ¢ç´¢ä¹å°ä» BT å¼å§ã\n\n### åæè®¡å\n - BT\n    - BT æ¦è¿°\n    - {% post_link Âµtp %}\n    - DHT ç½ç»\n - IPFS\n    - ç½ç®ä¹¦ç¿»è¯","source":"_posts/blockchain.md","raw":"---\ntitle: æ¢ç´¢ BlockChain\nkeywords: []\ndate: 2018/08/04 17:00:00\ntags: [BlockChain]\ncategories:\n---\nBitcoin å¸¦æ¥ç BlockChain ææ¯ä¸å¾æ åãè®¡åä»ç°å¨å¼å§è½å¤æ¯è¾ç³»ç»å°å­¦ä¹ ä¸è®°å½ç¸å³ææ¯ç¥è¯ãè¿ç¯æç« æ¯ä¸ªè¿åº¦è¡¨ä¹æ¯ä¸ä¸ªç®å½ã\n<!-- more -->\n## Bitcoin\nBitcoin çææ¡£éå¸¸ä¸°å¯ï¼ä¹åææ¯ç»å [Bitcoin Developer Reference](https://bitcoin.org/en/developer-reference) ä¸ [Bitcoin Developer Guide](https://bitcoin.org/en/developer-guide) è¿è¡å­¦ä¹ çï¼åå¾éå¸¸è¯¦ç»ï¼èä¸æ¯è¾å®¹æçè§£ã\n\n## IPFSï¼æéæä»¶ç³»ç» \n> IPFS is the Distributed Web. \n> A peer-to-peer hypermedia protocol to make the web faster, safer, and more open.\n> IPFS aims to replace HTTP and build a better web for all of us.\n\nIPFS çç®æ æ¯åä»£ HTTPï¼çä¸å»åå¾å¤ç½ç®ä¹¦é¡¹ç®ä¸æ ·çé¼è½°è½°ï¼ä½æ¯å¼åèç¡®å®å¨ä¸æ­åè¿ä¸ªç®æ æ¨è¿ãä½å¨ä¸ªäººç°å¨çè®¤è¯ä¸­ï¼IPFS æ´åæ¯ä»çå­é¢ææ **æéæä»¶ç³»ç»** æè¡¨è¾¾çä¸æ ·ï¼æ¯æ°æ®çè½½ä½ï¼èä¸æ¯å»ä¸­å¿åçãè¿å¾å®¹æè®©äººèæ³å° BitTorrentï¼èæ¥ä¸æ¥å¯¹ IPFS çæ¢ç´¢ä¹å°ä» BT å¼å§ã\n\n### åæè®¡å\n - BT\n    - BT æ¦è¿°\n    - {% post_link Âµtp %}\n    - DHT ç½ç»\n - IPFS\n    - ç½ç®ä¹¦ç¿»è¯","slug":"blockchain","published":1,"updated":"2018-08-10T08:21:19.649Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjknq4rf600022ofns11gjbgw","content":"<p>Bitcoin å¸¦æ¥ç BlockChain ææ¯ä¸å¾æ åãè®¡åä»ç°å¨å¼å§è½å¤æ¯è¾ç³»ç»å°å­¦ä¹ ä¸è®°å½ç¸å³ææ¯ç¥è¯ãè¿ç¯æç« æ¯ä¸ªè¿åº¦è¡¨ä¹æ¯ä¸ä¸ªç®å½ã<br><a id=\"more\"></a></p>\n<h2 id=\"Bitcoin\"><a href=\"#Bitcoin\" class=\"headerlink\" title=\"Bitcoin\"></a>Bitcoin</h2><p>Bitcoin çææ¡£éå¸¸ä¸°å¯ï¼ä¹åææ¯ç»å <a href=\"https://bitcoin.org/en/developer-reference\" target=\"_blank\" rel=\"noopener\">Bitcoin Developer Reference</a> ä¸ <a href=\"https://bitcoin.org/en/developer-guide\" target=\"_blank\" rel=\"noopener\">Bitcoin Developer Guide</a> è¿è¡å­¦ä¹ çï¼åå¾éå¸¸è¯¦ç»ï¼èä¸æ¯è¾å®¹æçè§£ã</p>\n<h2 id=\"IPFSï¼æéæä»¶ç³»ç»\"><a href=\"#IPFSï¼æéæä»¶ç³»ç»\" class=\"headerlink\" title=\"IPFSï¼æéæä»¶ç³»ç»\"></a>IPFSï¼æéæä»¶ç³»ç»</h2><blockquote>\n<p>IPFS is the Distributed Web.<br>A peer-to-peer hypermedia protocol to make the web faster, safer, and more open.<br>IPFS aims to replace HTTP and build a better web for all of us.</p>\n</blockquote>\n<p>IPFS çç®æ æ¯åä»£ HTTPï¼çä¸å»åå¾å¤ç½ç®ä¹¦é¡¹ç®ä¸æ ·çé¼è½°è½°ï¼ä½æ¯å¼åèç¡®å®å¨ä¸æ­åè¿ä¸ªç®æ æ¨è¿ãä½å¨ä¸ªäººç°å¨çè®¤è¯ä¸­ï¼IPFS æ´åæ¯ä»çå­é¢ææ <strong>æéæä»¶ç³»ç»</strong> æè¡¨è¾¾çä¸æ ·ï¼æ¯æ°æ®çè½½ä½ï¼èä¸æ¯å»ä¸­å¿åçãè¿å¾å®¹æè®©äººèæ³å° BitTorrentï¼èæ¥ä¸æ¥å¯¹ IPFS çæ¢ç´¢ä¹å°ä» BT å¼å§ã</p>\n<h3 id=\"åæè®¡å\"><a href=\"#åæè®¡å\" class=\"headerlink\" title=\"åæè®¡å\"></a>åæè®¡å</h3><ul>\n<li>BT<ul>\n<li>BT æ¦è¿°</li>\n<li><a href=\"/2018/08/04/Âµtp/\" title=\"ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£\">ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£</a></li>\n<li>DHT ç½ç»</li>\n</ul>\n</li>\n<li>IPFS<ul>\n<li>ç½ç®ä¹¦ç¿»è¯</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>Bitcoin å¸¦æ¥ç BlockChain ææ¯ä¸å¾æ åãè®¡åä»ç°å¨å¼å§è½å¤æ¯è¾ç³»ç»å°å­¦ä¹ ä¸è®°å½ç¸å³ææ¯ç¥è¯ãè¿ç¯æç« æ¯ä¸ªè¿åº¦è¡¨ä¹æ¯ä¸ä¸ªç®å½ã<br>","more":"</p>\n<h2 id=\"Bitcoin\"><a href=\"#Bitcoin\" class=\"headerlink\" title=\"Bitcoin\"></a>Bitcoin</h2><p>Bitcoin çææ¡£éå¸¸ä¸°å¯ï¼ä¹åææ¯ç»å <a href=\"https://bitcoin.org/en/developer-reference\" target=\"_blank\" rel=\"noopener\">Bitcoin Developer Reference</a> ä¸ <a href=\"https://bitcoin.org/en/developer-guide\" target=\"_blank\" rel=\"noopener\">Bitcoin Developer Guide</a> è¿è¡å­¦ä¹ çï¼åå¾éå¸¸è¯¦ç»ï¼èä¸æ¯è¾å®¹æçè§£ã</p>\n<h2 id=\"IPFSï¼æéæä»¶ç³»ç»\"><a href=\"#IPFSï¼æéæä»¶ç³»ç»\" class=\"headerlink\" title=\"IPFSï¼æéæä»¶ç³»ç»\"></a>IPFSï¼æéæä»¶ç³»ç»</h2><blockquote>\n<p>IPFS is the Distributed Web.<br>A peer-to-peer hypermedia protocol to make the web faster, safer, and more open.<br>IPFS aims to replace HTTP and build a better web for all of us.</p>\n</blockquote>\n<p>IPFS çç®æ æ¯åä»£ HTTPï¼çä¸å»åå¾å¤ç½ç®ä¹¦é¡¹ç®ä¸æ ·çé¼è½°è½°ï¼ä½æ¯å¼åèç¡®å®å¨ä¸æ­åè¿ä¸ªç®æ æ¨è¿ãä½å¨ä¸ªäººç°å¨çè®¤è¯ä¸­ï¼IPFS æ´åæ¯ä»çå­é¢ææ <strong>æéæä»¶ç³»ç»</strong> æè¡¨è¾¾çä¸æ ·ï¼æ¯æ°æ®çè½½ä½ï¼èä¸æ¯å»ä¸­å¿åçãè¿å¾å®¹æè®©äººèæ³å° BitTorrentï¼èæ¥ä¸æ¥å¯¹ IPFS çæ¢ç´¢ä¹å°ä» BT å¼å§ã</p>\n<h3 id=\"åæè®¡å\"><a href=\"#åæè®¡å\" class=\"headerlink\" title=\"åæè®¡å\"></a>åæè®¡å</h3><ul>\n<li>BT<ul>\n<li>BT æ¦è¿°</li>\n<li><a href=\"/2018/08/04/Âµtp/\" title=\"ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£\">ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£</a></li>\n<li>DHT ç½ç»</li>\n</ul>\n</li>\n<li>IPFS<ul>\n<li>ç½ç®ä¹¦ç¿»è¯</li>\n</ul>\n</li>\n</ul>"},{"title":"é²äºå­¤é¹¤","_content":"``` java\npublic class Blog {\n    public static void main(String[] args) {\n        System.out.println(\"æ¯æ¯éå®¤ï¼æå¾å¾·é¦¨\");\n    }\n}\n```","source":"_posts/hello-world.md","raw":"---\ntitle: é²äºå­¤é¹¤\ntags:\n\t- Essay\n---\n``` java\npublic class Blog {\n    public static void main(String[] args) {\n        System.out.println(\"æ¯æ¯éå®¤ï¼æå¾å¾·é¦¨\");\n    }\n}\n```","slug":"hello-world","published":1,"date":"2018-07-17T13:21:39.049Z","updated":"2018-07-17T13:21:39.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjknq4rf800042ofnduiqlpkx","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Blog</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"æ¯æ¯éå®¤ï¼æå¾å¾·é¦¨\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Blog</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"æ¯æ¯éå®¤ï¼æå¾å¾·é¦¨\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"TCP æ¸©æç¥æ°","keywords":[],"date":"2018-07-19T16:00:00.000Z","_content":"çäº§ç¯å¢éå°äºç½ç»é®é¢ï¼ç¥å¯¹ TCP åè®®è¿æ¯æäºççï¼å¨æ­¤å¤ä¹ è®°å½ã\n<!-- more -->\n## åè®®\n### æ¥ææ®µæ ¼å¼\nTCP åè®®æ¥ææ®µä¸»è¦ç±**é¦é¨ï¼Headerï¼** ä¸**æ°æ®ï¼Dataï¼** ä¸¤é¨åç»æãå¨è®¡ç®æ ¡éªåæ¯è¿ä¼å ä¸èæçä¼ªé¦é¨ãæ­¤å¤ä¸»è¦è¯´æé¦é¨çç»æã\n![å¾ 1 TCP Header (From: WikiPedia)](tcp_header.png)\nTCP å¨ç½ç»æ¨¡åä¸­å±äºè¿è¾å±ï¼ç¨äºæä¾è¿ç¨ä¸è¿ç¨é´çå­èæµéä¿¡æå¡ï¼å æ­¤éè¦**æº / ç®ç«¯å£ï¼Source / Destination portï¼** ä»¥ç¡®å®éä¿¡åæ¹è¿ç¨ãä½¿ç¨**åºå·ï¼Sequence numberï¼seqï¼** è¡¨ææ¬æ¥ææ®µç¬¬ä¸ä¸ªæ°æ®å­èçç¼å·ï¼åå§åºå·ç±åæ¹å¨ TCP è¿æ¥å»ºç«æ¶éæºçæãä½¿ç¨**ç¡®è®¤å·ï¼Acknowledgment numberï¼ackï¼** è¡¨ç¤ºæ¥åæ¹ææä»åéæ¹æ¥åçå­èç¼å·ã**æ°æ®åç§»éï¼Data Offsetï¼** é¡¾åæä¹æ¥ææ®µæ°æ®å¼å§å­èå¤çåç§»éï¼å³ TCP header çé¿åº¦ï¼ç±äºéé¡¹çå­å¨ï¼é¦é¨é¿åº¦çèå´æ¯ 20ï½60 Bytesï¼ä½æ¯è¯¥å­æ®µåªæ 4 Bitsï¼å æ­¤è¯¥å­æ®µæåºé¦é¨é¿åº¦æå¤å°ä¸ª 4 Bytesãæ¥ä¸æ¥ç 3 Bits è¢«**ä¿çï¼Reservedï¼** ãéåä¼è®¨è®º 9 ä¸ª**æ å¿ä½ï¼Flagsï¼**ã**çªå£å¤§å°ï¼Window Sizeï¼** å®ä¹äºæ¥åæ¹çæ¥åçªå£å¤§å°ï¼ç±æ¥åæ¹å³å®ï¼ç¶ååç¥åéæ¹ãå¨è®¡ç®**æ ¡éªåï¼Checksumï¼** æ¶éè¦å ä¸ä¼ªé¦é¨ï¼ä¼ªé¦é¨çåå®¹åæ¬æºç® IP å°åï¼TCP æ¥ææ®µé¿åº¦ç­ãå¦æ URG æ å¿ä½è¢«è®¾å®äºï¼é£**ç´§æ¥æéï¼Urgent pointerï¼** ç¨äºæç¤ºç´§æ¥æ°æ®æåä¸ä¸ªå­èå¨æ¥ææ®µæ°æ®é¨åä¸­çåç§»éãæåç 40 Bytes çç»**éé¡¹ï¼Optionsï¼**ã\n### Flags\n - **URG**ï¼ä¸º 1 è¡¨ç¤ºæ°æ®ä¸­æç´§æ¥æ°æ®ãè¿ä¸ªæ è®°æ¯è¾å°è§ï¼å¯ä»¥æ¾å°çä¸äºåºç¨æï¼[FTP](https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag)ï¼[Telnet](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼\n - **ACK**ï¼ä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­æ®µææï¼\n - **PSH**ï¼ä¸º 1 è¡¨ç¤ºææ¨éæ°æ®ï¼è¿ä¸ªå­æ®µä¸»è¦å®æ[ä¸¤ä¸ªåè½](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼åéæ¹åºç¨å±æé TCP éè¦ç«å³åéæ°æ®ï¼æ¥åæ¹ TCP éè¦å°æ¶å°çæ°æ®ç«å³æäº¤ç»åºç¨å±ï¼\n - **RST**ï¼ä¸º 1 è¡¨ç¤ºåºç°ä¸¥éå·®éãå¯è½éè¦éç°åå»º TCP è¿æ¥ãè¿å¯ä»¥ç¨äºæç»éæ³çæ¥ææ®µåæç»è¿æ¥è¯·æ±ï¼\n - **SYN**ï¼ä¸º 1 è¡¨ç¤ºè¿æ¯è¿æ¥è¯·æ±ææ¯è¿æ¥æ¥åè¯·æ±ï¼ç¨äºåå»ºè¿æ¥åä½¿é¡ºåºå·åæ­¥ï¼\n - **FIN**ï¼ä¸º 1 è¡¨ç¤ºåéæ¹æ²¡ææ°æ®è¦ä¼ è¾äºï¼è¦æ±éæ¾è¿æ¥ï¼\n\n## é¶æ®µ\nTCP è¿æ¥å¯ä»¥åä¸ºä¸ä¸ªé¶æ®µï¼å»ºç«è¿æ¥ï¼ä¼ è¾æ°æ®ï¼ç»æ­¢è¿æ¥ãå¯ä»¥ç¨ä¸ä¸ªæéç¶ææºè¡¨ç¤ºï¼\n![å¾ 2 TCP è¿æ¥ (From: Computer Networks)<br>å¾ä¸­ï¼A/Bï¼è¿æ ·çæå­è¡¨ç¤ºâæ¶å°Aåæ§è¡Bï¼Aä¸Bå¯ä»¥æ¯æ å¿ä½æèæä»¤â<br>æ·±å®çº¿è¡¨ç¤º Client çè¡ä¸ºï¼æ·±èçº¿è¡¨ç¤º Server çè¡ä¸ºï¼æµè²çº¿è¡¨ç¤ºç¹æ®è¡ä¸º](tcp_connection.png)\nä¸é¢ç»åä¸ä¸ªç¨ Rust åç Echo Server ä¸æåå·¥å· Wireshark æ¥æ¼ç¤ºè¿ä¸ä¸ªè¿ç¨ãä»£ç å¦ä¸ï¼\n{% include_code Echo Server lang:Rust echo_server.rs %}\nEcho Server å¯å¨ä¹åä½¿ç¨ telnet å·¥å·è¿æ¥è³æå¡å¨ï¼ä¸æå¡å¨äº¤äºä¸¤æ¬¡ï¼å³åæ¾ä¸¤æ¬¡å­ç¬¦ä¸²ï¼ç¶åä»éåº telnetãæå°çåæªå¾å¦ä¸ï¼\n![å¾ 3 Wireshark æå](wireshark.png)\n\nå¨ä¸é¢çè¡¨è¿°ä¸­ï¼å®¢æ·ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µååèµ·è¯·æ±çä¸æ¹ï¼æå¡ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µåæ¥åè¯·æ±çä¸æ¹ãå¨ TCP ä¸­ï¼æå¡ç«¯åå®¢æ·ç«¯ä¹é´å¯ä»¥è¿è¡ååéä¿¡ï¼ä»ä»¬å¯ä»¥çè§£ä¸ºå¯¹ç­çï¼å¨è¿æ¥å»ºç«åï¼å®éä¸æ²¡ææå¡ç«¯åå®¢æ·ç«¯çåºå«ã\n### å»ºç«è¿æ¥\nåä¸ä¸ªåä»£è¡¨äºå»ºç«è¿æ¥çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼å¤§å¤æ°æåµä¸å°±å¦åæåæç¤ºï¼ç§°ä¸º**ä¸æ¬¡æ¡æï¼3-way handshakeï¼**ãå¾ 2 ä¸­è¿ç»åºäºåæ¹åæ¶æå¼è¿æ¥ä¸è¿æ¥å¤ä½è¿ä¸¤ç§æ¯è¾å°è§çææ¯ã\n1. å®¢æ·ç«¯åéç»æå¡ç«¯ä¸ä¸ª **SYN** æ¥æï¼ç¨ä»¥åç¥æå¡ç«¯åå§åºå·ä¸º 0ï¼æ­¤å¤ç Seq ç»è¿ Wireshark çå¤çï¼åæäºç¸å¯¹å¼ï¼ï¼ç¶åå®¢æ·ç«¯è¿å¥ ***SYN_SENT*** ç¶æã\n2. æå¡å¨æ¶å° 1 ä¸­æ¥æåï¼åç»å®¢æ·ç«¯ä¸ä¸ª **SYN + ACK** æ¥æï¼åç¥å®¢æ·ç«¯åå§åºå·ä¸º 0ï¼ä¸æ¥ä¸æ¥ææä»å®¢æ·ç«¯æ¶å°çåºå· Ack ä¸º 1ãæå¡ç«¯è¿å¥ ***SYN_RCVD*** ç¶æãå¯è§ **SYN æ¥ææ¶èäºä¸ä¸ªåºå·**ã\n3. å®¢æ·ç«¯ç»æå¡ç«¯åå¤ **ACK** æ¥æï¼è¿å¥ ***ESTABLISHED*** ç¶æï¼æå¡ç«¯å¨æ¶å°è¿ä¸ªæ¥æè¿æ¥å»ºç«å®æãå¯è§ **ACK æ¥æå¨ä¸æºå¸¦æ°æ®çæåµä¸ä¸æ¶èåºå·**ã\n\n### ä¼ è¾æ°æ®\nå¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åå«å±ç¤ºäºä¸¤æ¬¡äº¤äºè¿ç¨ãä»¥ç¬¬äºæ¬¡äº¤äºä¸ºä¾ï¼\n1. P72 ä¸­ï¼å®¢æ·ç«¯å°æ³è¦åæ¾å­ç¬¦ä¸²åéç»æå¡ç«¯ï¼åç¥æå¡å¨è¿ä¸ªæ¥ææ®µçæ°æ®é¦å­èåºå·ä¸º 8ï¼å¹¶ä¸å¸æä»æå¡ç«¯æ¶å°çä¸ä¸ä¸ªåºå·æ¯ 8ã\n2. æå¡ç«¯å°åæ¾çå­ç¬¦ä¸²ä¸å¯¹ P72 çç¡®è®¤ä¸èµ·åéç»å®¢æ·ç«¯ãP72 çé¿åº¦ä¸º 9ï¼å æ­¤æ¥ææ®µä¸­æ°æ®çåºå·èå´ä¸º [8,17)ï¼å æ­¤å¨ P73 ä¸­ Ack ä¸º 17ã\n3. å®¢æ·ç«¯ç¡®è®¤ P73ã\n\néè¦æ³¨æçæ¯ï¼è¿ä¸¤æ¬¡äº¤äºææåºå«ï¼ç¬¬ä¸æ¬¡äº¤äºæ¶ï¼æå¡ç«¯åè¿åäºä¸ä¸ªç¡®è®¤ç»å®¢æ·ç«¯ï¼ç¶ååé¢å¤åéä¸æ¡æºå¸¦åæ¾åå®¹çæ¥ææ®µãä½æ¯ç¬¬äºæ¬¡äº¤äºæ¶çç¥äºåç¬çç¡®è®¤ã\n### ç»æ­¢è¿æ¥\næ ¹æ®âå¹¿å¤§åä¸»âåä½çæç« ä¸[é®ç­ç½ç«çè®¨è®º](https://www.zhihu.com/question/50646354)ä»¥ååç§é¢ç»ï¼åºæ¬ä¸è´è®¤ä¸ºï¼ç»æ­¢è¿æ¥éå¸¸è¢«æä¸º**åæ¬¡æ¥æï¼4-way terminationï¼**ï¼å³éä¿¡åæ¹ä¼æåæ¬¡äº¤äºï¼ä½æ¯å¦å¾ 2 æç¤ºï¼ä¹å­å¨**ä¸æ¬¡æ¥æ**çå¯è½æ§ï¼ä¸ææ¬å°çå¤æ¬¡æåä¹å¦å¾ 3 ä¸è´ââåä¸ºä¸æ¬¡æ¥æï¼ä¸æ ä¸ä¾å¤ãä¸é¢å¯¹åæ¬¡æ¥æè¿è¡åæï¼ä¸æ¬¡æ¥æå¯ä»¥è¢«å¶æ¦æ¬ï¼\n1. å®¢æ·ç«¯åèµ·ç»æ­¢è¿æ¥ï¼ååºä¸ä¸ª **FIN** æ¥æç»æå¡ç«¯ï¼åè®¾è¯¥æ¥æç Seq ä¸º Xï¼Ack ä¸º Yãç¶åå®¢æ·ç«¯è¿å¥ ***FIN_WAIT1*** ç¶æï¼é¤éä¼  FIN æ¥æä¸åé ACK ç¡®è®¤ä¹å¤ï¼ä¸ååéåºç¨æ°æ®ç»æå¡ç«¯ã\n2. æå¡ç«¯æ¶å° FIN æ¥ææ®µåååå¤ä¸ä¸ª **ACK** æ¥æï¼è¿å¥ ***CLOSE_WAIT*** ç¶æï¼è¯¥æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã\n3. å®¢æ·ç«¯å¨æ¶å° FIN ç ACK ä¹åè¿å¥ ***FIN_WAIT2*** ç¶æãæ­¤æ¶æå¡ç«¯è¿å¯ä»¥ç»§ç»­å°æªåéå®çåºç¨æ°æ®åéç»å®¢æ·ç«¯ã\n4. æå¡ç«¯åéå®æ°æ®ååéä¸æ¡ **FIN** æ¥æï¼è¿å¥ ***LAST_ACK*** ç¶æï¼è¯¥æ¥æç Seq ä¸º Y+Kï¼Ack ä¸º X+1ã\n5. å®¢æ·ç«¯æ¶å°æå¡ç«¯ç FIN åï¼åéæåç **ACK** æ¥æç»æå¡å¨ï¼ç¶åè¿å¥ ***TIME_WAIT*** ç¶æãå¦æå¨ 2MSLï¼æå¤§æ¥ææ®µå¯¿å½ï¼éå¸¸ä¸º30ï½60sï¼åå®¢æ·ç«¯æ²¡åæ¬¡æ¶å° FIN æ¥æï¼åè¿å¥ ***CLOSED*** ç¶æï¼å¦åéå ACK æ¥æè¿è¡éè¯ã\n6. æå¡ç«¯å¨æ¶å° ACK æ¥æåè¿å¥ ***CLOSED*** ç¶æã\n\nä¸æ¬¡æ¥æè¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åå¹¶ä¸ºä¸æ­¥ï¼å³åæ¶åéå¯¹å®¢æ·ç«¯ FIN ç ACK æ¥æä¸ æå¡ç«¯èªå·±ç FIN æ¥æãè¿æ¡ **FIN+ACK** æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã\n\nè³äºå¨ä»ä¹ææ¯ä¸åºç°ä¸æ¬¡æ¡ææèåæ¬¡æ¡æï¼å¤§å¤æ°çè§ç¹è®¤ä¸ºåæ¶å° FIN æ¥æçä¸æ¹è¿éè¦åä¸å±åºç¨è¯¢é®æ¯å¦ä»ç¶ææ°æ®éè¦åéï¼å ä¸ºè¦ç­å¾ä¸å±çåå¤ï¼æä»¥âä¸ºä½ä¸æ©ç¹æå¯¹ FIN ç ACK ååºå»å¢ï¼ï¼âèä¸ç«å³ Ack è½é²æ­¢å¯¹æ¹éä¼  FINãä½æ¯ææ²¡æå­å¨ä¸éè¦è¯¢é®ä¸å±æèä¸éè¦ç«å³åå¤ Ack çå¯è½ï¼å°±å¦åä¼ è¾æ°æ®åºç°çæåµä¸æ ·ï¼è¿äºåºè¯¥ä¸ TCP çå·ä½å®ç°ç¸å³ï¼ç®åè½åä¸ç²¾åæéï¼è¿æå¾å¯¹ [Linux TCP å®ç°æºç ](https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c)è¿è¡éè¯»ã\n## æ»å¨çªå£\næ»å¨çªå£æ¯ TCP ä¸­ç¨äºå®ç°è¯¸å¦ ACK ç¡®è®¤ãæµéæ§å¶ãæ¥å¡æ§å¶çæ¿è½½ç»æãå¦å¾æç¤º:\n![å¾ 4 æ»å¨çªå£](sliding_window.png)\nåå° TCP çä½æ¯ç®åçååéä¿¡ï¼ååéæ¹æä¸ä¸ªåéçªå£ï¼æ¥æ¶æ¹æä¸ä¸ªæ¥æ¶çªå£ãæ­£å¦å¾ä¸­æç¤ºï¼ä¼ è¾çæ¯æ¥ææ®µï¼çªå£å¤§å°çåä½æ¯å­èãä¸¤ä¸ªçªå£ä¸­**ç½è²åºå**ä¸ºç©ºç½ä½ç½®ï¼ç­å¾è¢«åºç¨å±æèç½ç»å±å¡«æ»¡ï¼**ç°è²åºå**æ¯å·²ç»åéä½æ¯è¿æ²¡ææ¥åå°ç¡®è®¤çå­èï¼**ç²è²åºå**å¨åéçªå£ä¸­è¡¨ç¤ºç­å¾è¢«åéçå­èï¼å¨æ¥æ¶çªå£æ±æ»è¡¨ç¤ºç­å¾äº¤ä»çå­èã\nåéçªå£çå¤§å°ä¸ºæ¥åæ¹éè¿é¦é¨ä¸­çªå£å¤§å°å­æ®µåç¥çæ¥æ¶çªå£å¤§å° rwnd åä¹åä¼è®²å°çæ¥å¡çªå£çå¤§å° cwnd ä¸¤èä¸­çè¾å°å¼ï¼å³ `min(rwnd , cwnd)`ãæ¥æ¶çªå£å¤§å°æ¯æ¥æ¶æ¹å¯ç¨ç¼å­ç©ºé´å¤§å°ï¼ä¸º `rwnd = ç¼å­å¤§å° - åå¤äº¤ä»çå­èæ°`ã\n\n## æµéæ§å¶\næµéæ§å¶ç¨äºå¹³è¡¡çäº§èäº§çæ°æ®ä¸æ¶è´¹èæ¶èæ°æ®çéåº¦ãTCP ä¸­çæµéæ§å¶å®ç°çä¸»è¦éå¾æ¯ä¸æ­è°æ´åéçªå£çå¤§å°å®ç°ãåé TCP ä¸æ¦åç°åéåéçªå£æ»¡äºå°±ä¼å¯¹åéè¿ç¨è¿è¡åé¦ãæ¥åæ¹æ ¹æ®ä¹åä»åéæ¹æ¶å°çæ°æ®éåæå¡å¨å·²ç»æ¶èçæ°æ®éå¾å°èªèº«æ¥æ¶çªå£çå¤§å°ï¼å°è¿ä¸ªå¼åç¥åéæ¹ï¼åéæ¹æ ¹æ®æ¶å°ççªå£å¤§å°è°æ´èªèº«çªå£å¤§å°ã\nè¿ææ­£å¯¹éä¿¡åæ¹äº§çæ°æ®å°æèæ¶è´¹æ°æ®æ¢äº§çç³æ¶çªå£ç»¼åå¾æ¶ï¼æå¶ä»æ¹é¢çæµéæ§å¶ãå½åéæ¹æ°æ®éç¸å¯¹äºé¦é¨å°å¾å¤çæ¥æå¾å¤æ¶ï¼å¯ä»¥ä½¿ç¨ **Nagle ç®æ³**åå°è¿ç§å°æ¥æéãå½æ¥åæ¹æ¶èæ°æ®å¾æ¢æ¶ï¼æ¯æ¬¡åç¥åéæ¹ççªå£å¤§å°ä¼æ¯è¾å°ï¼ä¹å¯è½äº§çå¾å¤å°æ¥æï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ **Clark è§£å³æ¹æ³**æèè¿è¡**æ¨è¿ç¡®è®¤**ãå³äºè¿å ç§æ¹æ¡çåæåå·ä½çä½¿ç¨ææ¯å¯ä»¥åè dog520 å¤§ç¥çè¿ç¯æç« ââ[åæ¬¡è°è° TCP ç Nagle ç®æ³ä¸ TCP_CORK éé¡¹](https://blog.csdn.net/dog250/article/details/21303679)ã\n## å·®éæ§å¶\nå·®éæ§å¶ç¨äºæè¿° TCP å¨åéæèæ¥åå°æ¥ææ®µåçå¼å¸¸æ¶çè¡ä¸ºï¼å¶ä¸»è¦è¡¨ç°å¨å¦ä¸å ä¸ªæ¹é¢ï¼\n1. **æ ¡éªå**ï¼å¨æ¥åæ¹ï¼å¦ææ¶å°çæ¥ææ®µæªéè¿æ ¡éªåæ ¡éªï¼åç«å³ä¸¢å¼ï¼åä¹ï¼åéè¿**ç¡®è®¤è§å**ï¼ä¸é¢é©¬ä¸æåï¼è¿è¡ç¡®è®¤ï¼\n2. **éä¼ **ï¼å¨åéæ¹ï¼å¦æä¸ä¸ªæ¥ææ®µéä¼ è¶æ¶è®¡æ¶å¨ï¼RTOï¼è¶æ¶ï¼å³å¨ RTO æ¶é´ä¹åä»ç¶æªæ¶å° ACKï¼åç«å³éä¼ æªè¢«ç¡®è®¤çæå°çæ¥ææ®µï¼å¦ææ¶å°åä¸ªç¸åçç ACK ï¼åç«å³éä¼ ä¸ä¸ä¸ªæ¥ææ®µï¼\n\n### ç¡®è®¤è§å\n1. å½æ¥åæ¹ååéæ¹åéæ°æ®æ¥ææ®µæ¶ï¼å¿é¡»**æå¸¦** ACKï¼\n2. å½æ¥åæ¹æ²¡ææ°æ®è¦åéæ¶ï¼ä½æ¯æ¶å°ä¸ä¸ª**æåºå°è¾¾**çæ¥æï¼åæ¶åä¸ä¸ªæ¥ææ®µä¹å·²ç»ç¡®è®¤è¿äºï¼é£ä¹æ¥æ¶æ¹å°±æ¨è¿åéç¡®è®¤æ¥ææ®µï¼ç´å°å¦ä¸ä¸ªæ¥ææ®µå°è¾¾æèå»¶è¿ä¸æ®µæ¶é´ä»¥åå° ACK æ¥æéï¼\n3. å½æææçæ¥ææ®µå°è¾¾ï¼ä¸åä¸ä¸ª**æåºå°è¾¾**çæ¥æè¿æªè¢«ç¡®è®¤ï¼åç«å³ ACKï¼ACK çåºå·ä»ç¶æ¯ä¸ä¸ä¸ªæ­£å¸¸ææçåºå·ï¼ä¸åï¼ï¼\n4. å½åºå·æ¯ææçå¤§çæ¥ææ®µï¼**å¤±åº**æ¥ææ®µï¼å°è¾¾ï¼åç«å³ ACKï¼ä¸å­å¨è¯¥æ¥ææ®µï¼\n5. å½**ä¸¢å¤±**çæ¥ææ®µå°è¾¾æ¶ï¼åç«å³ ACKï¼\n6. å½**éå¤**çæ¥ææ®µå°è¾¾æ¶ï¼åä¸¢å¼ï¼ä¸ç«å³ ACKï¼\n\n## æ¥å¡æ§å¶\næ¥å¡æ§å¶æ¯ä¸ºäºé¿åå ä¸ºç½ç»åéå¯¼è´ç½ç»ä¸è½æç§åéæ¹äº§ççæ°æ®çéåº¦å°æ¥ææ®µäº¤ä»ç»æ¥åæ¹ãä¸æµéæ§å¶èå¯çå¯¹è±¡æ¯éä¿¡åæ¹ä¸åï¼æ¥å¡æ§å¶çèå¯å¯¹è±¡æ¯éä¿¡åæ¹é´çç½ç»ãæ¥å¡æ§å¶çæ¹å¼è¡¨ç°å¨åéæ¹çæ¥å¡çªå£çååï¼ä»èæ§å¶åéæ¹çæ°æ®åéå¿«æ¢ãTCP æåä½¿ç¨çæ¥å¡ç­ç¥ç§°ä¸º **TCP Tahoe and Reno**ã\n### Tahoe and Reno\nè¿ä¸ªæ¥å¡ç­ç¥ä¸»è¦åä¸ºæ¢å¯å¨ãæ¥å¡é¿åãæ¥å¡æ£æµä¸ä¸ªé¶æ®µã\n#### æ¢å¯å¨\nåè®¾æ¥æ¶çªå£å¤§å°è¿å¤§äºæ¥å¡çªå£ï¼ä¸ä¸èèå»¶è¿ç¡®è®¤ãæ¥å¡çªå£å¤§å°ä»ä¸ä¸ªæå¤§æ¥æé¿åº¦ MSS ï¼è¿æ¥å»ºç«æ¶éè¿ TCP éé¡¹åç¥ï¼å¼å§ï¼ä¹åæ¯å½æä¸ä¸ªæ¥ææ®µè¢«ç¡®è®¤ï¼æ¥å¡çªå£å°±å¢å¤§ä¸ä¸ª MSSãå¨è¿æ ·çç­ç¥ä¸ï¼æ¢å¯å¨é¶æ®µçæ¥å¡çªå£å¤§å°åææ°å¢é¿ãå³ä» `1 -> 2 -> 4 -> 8`ãå½å°è¾¾æ¢å¯å¨é¨éæ¶ï¼å°±è¿å¥æ¥å¡é¿åé¶æ®µã\n#### æ¥å¡é¿å\næ¥å¡é¿åé¶æ®µæ¥å¡çªå£å¤§å°ç»§ç»­å¢å ï¼ä½æ¯éåº¦æ¾æ¢ï¼æ¹æå½æ´ä¸ªçªå£å¤§å°çæ¥ææ®µé½è¢«ç¡®è®¤åï¼çªå£å¤§å°æå¢å ä¸ä¸ª MSSãè¡¨ç°ä¸º `8 -> 9 -> 10 -> 11`ï¼åç°çº¿æ§å¢é¿ã\n#### æ¥å¡æ£æµ\nå¦ææ¥å¡åçäºï¼å ä¸ºåçå¨ç½ç»ä¸­è·¯ç±å¨åºç°ä¸¢åç°è±¡ï¼å¨æ¥åæ¹å¤çè¡¨ç°ä¸ºåºç°ä»¥ä¸ä¸¤ç§æåµï¼å¹¶ååºå¯¹åºçååºï¼\n1. RTO è®¡æ¶å¨è¶æ¶ãè¿è¯´æç½ç»æ¥å¡çå¯è½æ§è¾å¤§ï¼TCP ååºè¾å¼ºççååºï¼\n    a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼\n    b. æ cwnd éæ°è®¾ç½®ä¸º 1 MSSï¼\n    c. éæ°è¿å¥æ¢å¯å¨é¶æ®µï¼\n\n2. æ¶å°åä¸ªç¸åç ACKï¼è¯´æåºç°æ¥å¡çå¯è½æ§è¾å°ï¼ä½æ¯åºç°äºä¸¢åï¼TCP ååºè¾å¼±çååºï¼Reno ç®æ³è¡¨ç°ä¸ºå¿«æ¢å¤ï¼Fast recoveryï¼ï¼\n    a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼\n    b. æ cwnd éæ°è®¾ç½®ä¸ºæ¢å¯å¨é¨éå¼ï¼\n    c. éæ°è¿å¥æ¥å¡é¿åé¶æ®µï¼\n\nå¾ç¤ºå¦ä¸ï¼\n![æ¥å¡æ§å¶ç¤ºä¾](congestion_control_example.png)\nTahoe ç®æ³ä¸ Reno ï¼Tahoe çæ¹è¿çæ¬ï¼çåºå«å¨äºæ¶å°åä¸ªç¸å ACK æ¶ï¼Tahoe ç®æ³çç­ç¥å RTO è®¡æ¶å¨è¶æ¶æ¶ä¸è´ã\n### å¶ä»æ¥å¡ç­ç¥\næ¥å¡æ§å¶ç­ç¥åªéè¦å¨åéæ¹å®ç°å³å¯ï¼ä¸éè¦æ¥åæ¹çåä¸ï¼å æ­¤å¯ä»¥ä»å¨åéæ¹é¨ç½²ä¸å¥ç®æ³ãç°å¨ TCP ç½ç»ä¸çç®æ³ä¹å¨ä¸æ­[æ¹è¿](https://en.wikipedia.org/wiki/TCP_congestion_control)ï¼æ¶ç°åºè¯¸å¦ [**TCP CUBIC**](http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf)ã[**TCP BBR**](https://ai.google/research/pubs/pub45646) è¿æ ·çç®æ³ã\n\n## TCP ä¸­çè®¡æ¶å¨\n### éä¼ è®¡æ¶å¨\néä¼ è®¡æ¶å¨çè¶æ¶æ¶é´ä¸º RTOï¼RTO ä¸»è¦æ ¹æ®æµéæå¾çæ¥ææ®µå¾è¿æ¶é´ RTTmè®¡ç®èæ¥ï¼è®¡ç®è¿ç¨å¦ä¸ï¼\n\né¦åè®¡ç®å¹³æ» RTTï¼å³RTTsï¼\n```\nRTTs = RTTm // ç¬¬ä¸æ¬¡æµé\nRTTs = (1 - Î±)RTTs + Î±RTTm // éåçæµé\n```\nç¶åè®¡ç® RTT çåå·® RTTdï¼\n```\nRTTd = RTTm / 2 // ç¬¬ä¸æ¬¡æµé\nRTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éåçæµé\n```\néä¼ è¶æ¶ RTO çè®¡ç®å¦ä¸ï¼\n```\nRTO = 6s // åå§å¼\nRTO = RTTs + 4RTTd // ç¬¬ä¸æ¬¡æµéå\n```\nä»»ææ¶å»åªæä¸ä¸ª RTT å¨è¿è¡æµéï¼å½éä¼ åçæ¶ä¼å½±å RTT çæµéï¼æ ¹æ® **Karn ç®æ³**ï¼TCP å¿½ç¥éä¼ æ¥æç RTTï¼èå¯¹äºéä¼ çæ¥æï¼RTO å¼ä¸ºåæ¥æçä¸¤åï¼å¦æåçç¬¬äºæ¬¡éä¼ ï¼åä¸ºååï¼ä»¥æ­¤ç±»æ¨ã\n### æç»­è®¡æ¶å¨\nå½æ¥åæ¹åéçªå£å¼ä¸º 0 çæ¥ææ®µä¹åï¼åæ¥å ä¸ºæ¥æ¶çªå£å¢å éè¦éåæ¥çªå£ä¸ºé 0ï¼ä½æ¯éåç ACK ä¸¢å¤±ï¼è¿ä¼å¯¼è´åéæ¹ä¸ç´ç­å¾é 0 çªå£éåï¼å¯¼è´æ­»éãæç»­è®¡æ¶å¨å°±æ¯æ¥åæ¹å¨æ¶å° 0 çªå£éååå¯ç¨ï¼å¦æè¶æ¶ååéæ¢æµæ¥æï¼ä¿ä½¿æ¥åæ¹éä¼  ACKã\n### Keep-Alive è®¡æ¶å¨\nKeep-Alive è®¡æ¶å¨ç¨äºé²æ­¢ TCP è¿æ¥é¿æ¶é´ç©ºé²ï¼æ¯å½æ¶å°å¯¹æ¹çæ¥ææ®µï¼è¿ä¸ªè®¡æ¶å¨å°±å¤ä½ãè¿ä¸ªè®¡æ¶å¨çè¶æ¶æ¶é´éå¸¸å¯ä»¥éè¿æ¥å£è¿è¡è®¾å®ã\n### Time-Wait è®¡æ¶å¨\nTime-Wait è®¡æ¶å¨å¯¹æåç FIN è¿è¡ç¡®è®¤æ¶å¯å¨çè¶æ¶è®¡æ¶å¨ãå¦æå¨æ¶å¸¸ä¸º 2MSL çè®¡æ¶å¨è¶æ¶ååæ¬¡æ¶å° FINï¼åéä¼  ACKï¼å¦åè¿æ¥å½»åºå³é­ã\n\n## ä¼ è¾å±ç[æªæ¥](https://blog.apnic.net/2017/12/12/internet-protocols-changing/)\n[QIUC](https://www.chromium.org/quic) äºè§£ä¸ä¸ä¸ï¼\n\n## åèèµæ\n1. [TCP/IP åè®®æ ç¬¬åç](https://book.douban.com/subject/5386194/)\n2. [Andrew S.Tanenbaum - Computer Networks 5th](https://book.douban.com/subject/5344443/)\n3. [WikiPedia - Transmission Control Protocol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)\n4. [WikiPedia - TCP congestion control](https://en.wikipedia.org/wiki/TCP_congestion_contro)\n5. [TCP Flags: PSH and URG](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)\n6. [KTH - Internetworking Lecture 4](https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf)\n7. [ä¸ä¸ª TCP FIN_WAIT2 ç¶æç»èå¼åçææ¨](https://blog.csdn.net/dog250/article/details/81256550)","source":"_posts/tcp.md","raw":"---\ntitle: TCP æ¸©æç¥æ°\nkeywords: []\ndate: 2018/7/20\ntags: [Network]\ncategories:\n---\nçäº§ç¯å¢éå°äºç½ç»é®é¢ï¼ç¥å¯¹ TCP åè®®è¿æ¯æäºççï¼å¨æ­¤å¤ä¹ è®°å½ã\n<!-- more -->\n## åè®®\n### æ¥ææ®µæ ¼å¼\nTCP åè®®æ¥ææ®µä¸»è¦ç±**é¦é¨ï¼Headerï¼** ä¸**æ°æ®ï¼Dataï¼** ä¸¤é¨åç»æãå¨è®¡ç®æ ¡éªåæ¯è¿ä¼å ä¸èæçä¼ªé¦é¨ãæ­¤å¤ä¸»è¦è¯´æé¦é¨çç»æã\n![å¾ 1 TCP Header (From: WikiPedia)](tcp_header.png)\nTCP å¨ç½ç»æ¨¡åä¸­å±äºè¿è¾å±ï¼ç¨äºæä¾è¿ç¨ä¸è¿ç¨é´çå­èæµéä¿¡æå¡ï¼å æ­¤éè¦**æº / ç®ç«¯å£ï¼Source / Destination portï¼** ä»¥ç¡®å®éä¿¡åæ¹è¿ç¨ãä½¿ç¨**åºå·ï¼Sequence numberï¼seqï¼** è¡¨ææ¬æ¥ææ®µç¬¬ä¸ä¸ªæ°æ®å­èçç¼å·ï¼åå§åºå·ç±åæ¹å¨ TCP è¿æ¥å»ºç«æ¶éæºçæãä½¿ç¨**ç¡®è®¤å·ï¼Acknowledgment numberï¼ackï¼** è¡¨ç¤ºæ¥åæ¹ææä»åéæ¹æ¥åçå­èç¼å·ã**æ°æ®åç§»éï¼Data Offsetï¼** é¡¾åæä¹æ¥ææ®µæ°æ®å¼å§å­èå¤çåç§»éï¼å³ TCP header çé¿åº¦ï¼ç±äºéé¡¹çå­å¨ï¼é¦é¨é¿åº¦çèå´æ¯ 20ï½60 Bytesï¼ä½æ¯è¯¥å­æ®µåªæ 4 Bitsï¼å æ­¤è¯¥å­æ®µæåºé¦é¨é¿åº¦æå¤å°ä¸ª 4 Bytesãæ¥ä¸æ¥ç 3 Bits è¢«**ä¿çï¼Reservedï¼** ãéåä¼è®¨è®º 9 ä¸ª**æ å¿ä½ï¼Flagsï¼**ã**çªå£å¤§å°ï¼Window Sizeï¼** å®ä¹äºæ¥åæ¹çæ¥åçªå£å¤§å°ï¼ç±æ¥åæ¹å³å®ï¼ç¶ååç¥åéæ¹ãå¨è®¡ç®**æ ¡éªåï¼Checksumï¼** æ¶éè¦å ä¸ä¼ªé¦é¨ï¼ä¼ªé¦é¨çåå®¹åæ¬æºç® IP å°åï¼TCP æ¥ææ®µé¿åº¦ç­ãå¦æ URG æ å¿ä½è¢«è®¾å®äºï¼é£**ç´§æ¥æéï¼Urgent pointerï¼** ç¨äºæç¤ºç´§æ¥æ°æ®æåä¸ä¸ªå­èå¨æ¥ææ®µæ°æ®é¨åä¸­çåç§»éãæåç 40 Bytes çç»**éé¡¹ï¼Optionsï¼**ã\n### Flags\n - **URG**ï¼ä¸º 1 è¡¨ç¤ºæ°æ®ä¸­æç´§æ¥æ°æ®ãè¿ä¸ªæ è®°æ¯è¾å°è§ï¼å¯ä»¥æ¾å°çä¸äºåºç¨æï¼[FTP](https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag)ï¼[Telnet](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼\n - **ACK**ï¼ä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­æ®µææï¼\n - **PSH**ï¼ä¸º 1 è¡¨ç¤ºææ¨éæ°æ®ï¼è¿ä¸ªå­æ®µä¸»è¦å®æ[ä¸¤ä¸ªåè½](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼åéæ¹åºç¨å±æé TCP éè¦ç«å³åéæ°æ®ï¼æ¥åæ¹ TCP éè¦å°æ¶å°çæ°æ®ç«å³æäº¤ç»åºç¨å±ï¼\n - **RST**ï¼ä¸º 1 è¡¨ç¤ºåºç°ä¸¥éå·®éãå¯è½éè¦éç°åå»º TCP è¿æ¥ãè¿å¯ä»¥ç¨äºæç»éæ³çæ¥ææ®µåæç»è¿æ¥è¯·æ±ï¼\n - **SYN**ï¼ä¸º 1 è¡¨ç¤ºè¿æ¯è¿æ¥è¯·æ±ææ¯è¿æ¥æ¥åè¯·æ±ï¼ç¨äºåå»ºè¿æ¥åä½¿é¡ºåºå·åæ­¥ï¼\n - **FIN**ï¼ä¸º 1 è¡¨ç¤ºåéæ¹æ²¡ææ°æ®è¦ä¼ è¾äºï¼è¦æ±éæ¾è¿æ¥ï¼\n\n## é¶æ®µ\nTCP è¿æ¥å¯ä»¥åä¸ºä¸ä¸ªé¶æ®µï¼å»ºç«è¿æ¥ï¼ä¼ è¾æ°æ®ï¼ç»æ­¢è¿æ¥ãå¯ä»¥ç¨ä¸ä¸ªæéç¶ææºè¡¨ç¤ºï¼\n![å¾ 2 TCP è¿æ¥ (From: Computer Networks)<br>å¾ä¸­ï¼A/Bï¼è¿æ ·çæå­è¡¨ç¤ºâæ¶å°Aåæ§è¡Bï¼Aä¸Bå¯ä»¥æ¯æ å¿ä½æèæä»¤â<br>æ·±å®çº¿è¡¨ç¤º Client çè¡ä¸ºï¼æ·±èçº¿è¡¨ç¤º Server çè¡ä¸ºï¼æµè²çº¿è¡¨ç¤ºç¹æ®è¡ä¸º](tcp_connection.png)\nä¸é¢ç»åä¸ä¸ªç¨ Rust åç Echo Server ä¸æåå·¥å· Wireshark æ¥æ¼ç¤ºè¿ä¸ä¸ªè¿ç¨ãä»£ç å¦ä¸ï¼\n{% include_code Echo Server lang:Rust echo_server.rs %}\nEcho Server å¯å¨ä¹åä½¿ç¨ telnet å·¥å·è¿æ¥è³æå¡å¨ï¼ä¸æå¡å¨äº¤äºä¸¤æ¬¡ï¼å³åæ¾ä¸¤æ¬¡å­ç¬¦ä¸²ï¼ç¶åä»éåº telnetãæå°çåæªå¾å¦ä¸ï¼\n![å¾ 3 Wireshark æå](wireshark.png)\n\nå¨ä¸é¢çè¡¨è¿°ä¸­ï¼å®¢æ·ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µååèµ·è¯·æ±çä¸æ¹ï¼æå¡ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µåæ¥åè¯·æ±çä¸æ¹ãå¨ TCP ä¸­ï¼æå¡ç«¯åå®¢æ·ç«¯ä¹é´å¯ä»¥è¿è¡ååéä¿¡ï¼ä»ä»¬å¯ä»¥çè§£ä¸ºå¯¹ç­çï¼å¨è¿æ¥å»ºç«åï¼å®éä¸æ²¡ææå¡ç«¯åå®¢æ·ç«¯çåºå«ã\n### å»ºç«è¿æ¥\nåä¸ä¸ªåä»£è¡¨äºå»ºç«è¿æ¥çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼å¤§å¤æ°æåµä¸å°±å¦åæåæç¤ºï¼ç§°ä¸º**ä¸æ¬¡æ¡æï¼3-way handshakeï¼**ãå¾ 2 ä¸­è¿ç»åºäºåæ¹åæ¶æå¼è¿æ¥ä¸è¿æ¥å¤ä½è¿ä¸¤ç§æ¯è¾å°è§çææ¯ã\n1. å®¢æ·ç«¯åéç»æå¡ç«¯ä¸ä¸ª **SYN** æ¥æï¼ç¨ä»¥åç¥æå¡ç«¯åå§åºå·ä¸º 0ï¼æ­¤å¤ç Seq ç»è¿ Wireshark çå¤çï¼åæäºç¸å¯¹å¼ï¼ï¼ç¶åå®¢æ·ç«¯è¿å¥ ***SYN_SENT*** ç¶æã\n2. æå¡å¨æ¶å° 1 ä¸­æ¥æåï¼åç»å®¢æ·ç«¯ä¸ä¸ª **SYN + ACK** æ¥æï¼åç¥å®¢æ·ç«¯åå§åºå·ä¸º 0ï¼ä¸æ¥ä¸æ¥ææä»å®¢æ·ç«¯æ¶å°çåºå· Ack ä¸º 1ãæå¡ç«¯è¿å¥ ***SYN_RCVD*** ç¶æãå¯è§ **SYN æ¥ææ¶èäºä¸ä¸ªåºå·**ã\n3. å®¢æ·ç«¯ç»æå¡ç«¯åå¤ **ACK** æ¥æï¼è¿å¥ ***ESTABLISHED*** ç¶æï¼æå¡ç«¯å¨æ¶å°è¿ä¸ªæ¥æè¿æ¥å»ºç«å®æãå¯è§ **ACK æ¥æå¨ä¸æºå¸¦æ°æ®çæåµä¸ä¸æ¶èåºå·**ã\n\n### ä¼ è¾æ°æ®\nå¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åå«å±ç¤ºäºä¸¤æ¬¡äº¤äºè¿ç¨ãä»¥ç¬¬äºæ¬¡äº¤äºä¸ºä¾ï¼\n1. P72 ä¸­ï¼å®¢æ·ç«¯å°æ³è¦åæ¾å­ç¬¦ä¸²åéç»æå¡ç«¯ï¼åç¥æå¡å¨è¿ä¸ªæ¥ææ®µçæ°æ®é¦å­èåºå·ä¸º 8ï¼å¹¶ä¸å¸æä»æå¡ç«¯æ¶å°çä¸ä¸ä¸ªåºå·æ¯ 8ã\n2. æå¡ç«¯å°åæ¾çå­ç¬¦ä¸²ä¸å¯¹ P72 çç¡®è®¤ä¸èµ·åéç»å®¢æ·ç«¯ãP72 çé¿åº¦ä¸º 9ï¼å æ­¤æ¥ææ®µä¸­æ°æ®çåºå·èå´ä¸º [8,17)ï¼å æ­¤å¨ P73 ä¸­ Ack ä¸º 17ã\n3. å®¢æ·ç«¯ç¡®è®¤ P73ã\n\néè¦æ³¨æçæ¯ï¼è¿ä¸¤æ¬¡äº¤äºææåºå«ï¼ç¬¬ä¸æ¬¡äº¤äºæ¶ï¼æå¡ç«¯åè¿åäºä¸ä¸ªç¡®è®¤ç»å®¢æ·ç«¯ï¼ç¶ååé¢å¤åéä¸æ¡æºå¸¦åæ¾åå®¹çæ¥ææ®µãä½æ¯ç¬¬äºæ¬¡äº¤äºæ¶çç¥äºåç¬çç¡®è®¤ã\n### ç»æ­¢è¿æ¥\næ ¹æ®âå¹¿å¤§åä¸»âåä½çæç« ä¸[é®ç­ç½ç«çè®¨è®º](https://www.zhihu.com/question/50646354)ä»¥ååç§é¢ç»ï¼åºæ¬ä¸è´è®¤ä¸ºï¼ç»æ­¢è¿æ¥éå¸¸è¢«æä¸º**åæ¬¡æ¥æï¼4-way terminationï¼**ï¼å³éä¿¡åæ¹ä¼æåæ¬¡äº¤äºï¼ä½æ¯å¦å¾ 2 æç¤ºï¼ä¹å­å¨**ä¸æ¬¡æ¥æ**çå¯è½æ§ï¼ä¸ææ¬å°çå¤æ¬¡æåä¹å¦å¾ 3 ä¸è´ââåä¸ºä¸æ¬¡æ¥æï¼ä¸æ ä¸ä¾å¤ãä¸é¢å¯¹åæ¬¡æ¥æè¿è¡åæï¼ä¸æ¬¡æ¥æå¯ä»¥è¢«å¶æ¦æ¬ï¼\n1. å®¢æ·ç«¯åèµ·ç»æ­¢è¿æ¥ï¼ååºä¸ä¸ª **FIN** æ¥æç»æå¡ç«¯ï¼åè®¾è¯¥æ¥æç Seq ä¸º Xï¼Ack ä¸º Yãç¶åå®¢æ·ç«¯è¿å¥ ***FIN_WAIT1*** ç¶æï¼é¤éä¼  FIN æ¥æä¸åé ACK ç¡®è®¤ä¹å¤ï¼ä¸ååéåºç¨æ°æ®ç»æå¡ç«¯ã\n2. æå¡ç«¯æ¶å° FIN æ¥ææ®µåååå¤ä¸ä¸ª **ACK** æ¥æï¼è¿å¥ ***CLOSE_WAIT*** ç¶æï¼è¯¥æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã\n3. å®¢æ·ç«¯å¨æ¶å° FIN ç ACK ä¹åè¿å¥ ***FIN_WAIT2*** ç¶æãæ­¤æ¶æå¡ç«¯è¿å¯ä»¥ç»§ç»­å°æªåéå®çåºç¨æ°æ®åéç»å®¢æ·ç«¯ã\n4. æå¡ç«¯åéå®æ°æ®ååéä¸æ¡ **FIN** æ¥æï¼è¿å¥ ***LAST_ACK*** ç¶æï¼è¯¥æ¥æç Seq ä¸º Y+Kï¼Ack ä¸º X+1ã\n5. å®¢æ·ç«¯æ¶å°æå¡ç«¯ç FIN åï¼åéæåç **ACK** æ¥æç»æå¡å¨ï¼ç¶åè¿å¥ ***TIME_WAIT*** ç¶æãå¦æå¨ 2MSLï¼æå¤§æ¥ææ®µå¯¿å½ï¼éå¸¸ä¸º30ï½60sï¼åå®¢æ·ç«¯æ²¡åæ¬¡æ¶å° FIN æ¥æï¼åè¿å¥ ***CLOSED*** ç¶æï¼å¦åéå ACK æ¥æè¿è¡éè¯ã\n6. æå¡ç«¯å¨æ¶å° ACK æ¥æåè¿å¥ ***CLOSED*** ç¶æã\n\nä¸æ¬¡æ¥æè¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åå¹¶ä¸ºä¸æ­¥ï¼å³åæ¶åéå¯¹å®¢æ·ç«¯ FIN ç ACK æ¥æä¸ æå¡ç«¯èªå·±ç FIN æ¥æãè¿æ¡ **FIN+ACK** æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã\n\nè³äºå¨ä»ä¹ææ¯ä¸åºç°ä¸æ¬¡æ¡ææèåæ¬¡æ¡æï¼å¤§å¤æ°çè§ç¹è®¤ä¸ºåæ¶å° FIN æ¥æçä¸æ¹è¿éè¦åä¸å±åºç¨è¯¢é®æ¯å¦ä»ç¶ææ°æ®éè¦åéï¼å ä¸ºè¦ç­å¾ä¸å±çåå¤ï¼æä»¥âä¸ºä½ä¸æ©ç¹æå¯¹ FIN ç ACK ååºå»å¢ï¼ï¼âèä¸ç«å³ Ack è½é²æ­¢å¯¹æ¹éä¼  FINãä½æ¯ææ²¡æå­å¨ä¸éè¦è¯¢é®ä¸å±æèä¸éè¦ç«å³åå¤ Ack çå¯è½ï¼å°±å¦åä¼ è¾æ°æ®åºç°çæåµä¸æ ·ï¼è¿äºåºè¯¥ä¸ TCP çå·ä½å®ç°ç¸å³ï¼ç®åè½åä¸ç²¾åæéï¼è¿æå¾å¯¹ [Linux TCP å®ç°æºç ](https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c)è¿è¡éè¯»ã\n## æ»å¨çªå£\næ»å¨çªå£æ¯ TCP ä¸­ç¨äºå®ç°è¯¸å¦ ACK ç¡®è®¤ãæµéæ§å¶ãæ¥å¡æ§å¶çæ¿è½½ç»æãå¦å¾æç¤º:\n![å¾ 4 æ»å¨çªå£](sliding_window.png)\nåå° TCP çä½æ¯ç®åçååéä¿¡ï¼ååéæ¹æä¸ä¸ªåéçªå£ï¼æ¥æ¶æ¹æä¸ä¸ªæ¥æ¶çªå£ãæ­£å¦å¾ä¸­æç¤ºï¼ä¼ è¾çæ¯æ¥ææ®µï¼çªå£å¤§å°çåä½æ¯å­èãä¸¤ä¸ªçªå£ä¸­**ç½è²åºå**ä¸ºç©ºç½ä½ç½®ï¼ç­å¾è¢«åºç¨å±æèç½ç»å±å¡«æ»¡ï¼**ç°è²åºå**æ¯å·²ç»åéä½æ¯è¿æ²¡ææ¥åå°ç¡®è®¤çå­èï¼**ç²è²åºå**å¨åéçªå£ä¸­è¡¨ç¤ºç­å¾è¢«åéçå­èï¼å¨æ¥æ¶çªå£æ±æ»è¡¨ç¤ºç­å¾äº¤ä»çå­èã\nåéçªå£çå¤§å°ä¸ºæ¥åæ¹éè¿é¦é¨ä¸­çªå£å¤§å°å­æ®µåç¥çæ¥æ¶çªå£å¤§å° rwnd åä¹åä¼è®²å°çæ¥å¡çªå£çå¤§å° cwnd ä¸¤èä¸­çè¾å°å¼ï¼å³ `min(rwnd , cwnd)`ãæ¥æ¶çªå£å¤§å°æ¯æ¥æ¶æ¹å¯ç¨ç¼å­ç©ºé´å¤§å°ï¼ä¸º `rwnd = ç¼å­å¤§å° - åå¤äº¤ä»çå­èæ°`ã\n\n## æµéæ§å¶\næµéæ§å¶ç¨äºå¹³è¡¡çäº§èäº§çæ°æ®ä¸æ¶è´¹èæ¶èæ°æ®çéåº¦ãTCP ä¸­çæµéæ§å¶å®ç°çä¸»è¦éå¾æ¯ä¸æ­è°æ´åéçªå£çå¤§å°å®ç°ãåé TCP ä¸æ¦åç°åéåéçªå£æ»¡äºå°±ä¼å¯¹åéè¿ç¨è¿è¡åé¦ãæ¥åæ¹æ ¹æ®ä¹åä»åéæ¹æ¶å°çæ°æ®éåæå¡å¨å·²ç»æ¶èçæ°æ®éå¾å°èªèº«æ¥æ¶çªå£çå¤§å°ï¼å°è¿ä¸ªå¼åç¥åéæ¹ï¼åéæ¹æ ¹æ®æ¶å°ççªå£å¤§å°è°æ´èªèº«çªå£å¤§å°ã\nè¿ææ­£å¯¹éä¿¡åæ¹äº§çæ°æ®å°æèæ¶è´¹æ°æ®æ¢äº§çç³æ¶çªå£ç»¼åå¾æ¶ï¼æå¶ä»æ¹é¢çæµéæ§å¶ãå½åéæ¹æ°æ®éç¸å¯¹äºé¦é¨å°å¾å¤çæ¥æå¾å¤æ¶ï¼å¯ä»¥ä½¿ç¨ **Nagle ç®æ³**åå°è¿ç§å°æ¥æéãå½æ¥åæ¹æ¶èæ°æ®å¾æ¢æ¶ï¼æ¯æ¬¡åç¥åéæ¹ççªå£å¤§å°ä¼æ¯è¾å°ï¼ä¹å¯è½äº§çå¾å¤å°æ¥æï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ **Clark è§£å³æ¹æ³**æèè¿è¡**æ¨è¿ç¡®è®¤**ãå³äºè¿å ç§æ¹æ¡çåæåå·ä½çä½¿ç¨ææ¯å¯ä»¥åè dog520 å¤§ç¥çè¿ç¯æç« ââ[åæ¬¡è°è° TCP ç Nagle ç®æ³ä¸ TCP_CORK éé¡¹](https://blog.csdn.net/dog250/article/details/21303679)ã\n## å·®éæ§å¶\nå·®éæ§å¶ç¨äºæè¿° TCP å¨åéæèæ¥åå°æ¥ææ®µåçå¼å¸¸æ¶çè¡ä¸ºï¼å¶ä¸»è¦è¡¨ç°å¨å¦ä¸å ä¸ªæ¹é¢ï¼\n1. **æ ¡éªå**ï¼å¨æ¥åæ¹ï¼å¦ææ¶å°çæ¥ææ®µæªéè¿æ ¡éªåæ ¡éªï¼åç«å³ä¸¢å¼ï¼åä¹ï¼åéè¿**ç¡®è®¤è§å**ï¼ä¸é¢é©¬ä¸æåï¼è¿è¡ç¡®è®¤ï¼\n2. **éä¼ **ï¼å¨åéæ¹ï¼å¦æä¸ä¸ªæ¥ææ®µéä¼ è¶æ¶è®¡æ¶å¨ï¼RTOï¼è¶æ¶ï¼å³å¨ RTO æ¶é´ä¹åä»ç¶æªæ¶å° ACKï¼åç«å³éä¼ æªè¢«ç¡®è®¤çæå°çæ¥ææ®µï¼å¦ææ¶å°åä¸ªç¸åçç ACK ï¼åç«å³éä¼ ä¸ä¸ä¸ªæ¥ææ®µï¼\n\n### ç¡®è®¤è§å\n1. å½æ¥åæ¹ååéæ¹åéæ°æ®æ¥ææ®µæ¶ï¼å¿é¡»**æå¸¦** ACKï¼\n2. å½æ¥åæ¹æ²¡ææ°æ®è¦åéæ¶ï¼ä½æ¯æ¶å°ä¸ä¸ª**æåºå°è¾¾**çæ¥æï¼åæ¶åä¸ä¸ªæ¥ææ®µä¹å·²ç»ç¡®è®¤è¿äºï¼é£ä¹æ¥æ¶æ¹å°±æ¨è¿åéç¡®è®¤æ¥ææ®µï¼ç´å°å¦ä¸ä¸ªæ¥ææ®µå°è¾¾æèå»¶è¿ä¸æ®µæ¶é´ä»¥åå° ACK æ¥æéï¼\n3. å½æææçæ¥ææ®µå°è¾¾ï¼ä¸åä¸ä¸ª**æåºå°è¾¾**çæ¥æè¿æªè¢«ç¡®è®¤ï¼åç«å³ ACKï¼ACK çåºå·ä»ç¶æ¯ä¸ä¸ä¸ªæ­£å¸¸ææçåºå·ï¼ä¸åï¼ï¼\n4. å½åºå·æ¯ææçå¤§çæ¥ææ®µï¼**å¤±åº**æ¥ææ®µï¼å°è¾¾ï¼åç«å³ ACKï¼ä¸å­å¨è¯¥æ¥ææ®µï¼\n5. å½**ä¸¢å¤±**çæ¥ææ®µå°è¾¾æ¶ï¼åç«å³ ACKï¼\n6. å½**éå¤**çæ¥ææ®µå°è¾¾æ¶ï¼åä¸¢å¼ï¼ä¸ç«å³ ACKï¼\n\n## æ¥å¡æ§å¶\næ¥å¡æ§å¶æ¯ä¸ºäºé¿åå ä¸ºç½ç»åéå¯¼è´ç½ç»ä¸è½æç§åéæ¹äº§ççæ°æ®çéåº¦å°æ¥ææ®µäº¤ä»ç»æ¥åæ¹ãä¸æµéæ§å¶èå¯çå¯¹è±¡æ¯éä¿¡åæ¹ä¸åï¼æ¥å¡æ§å¶çèå¯å¯¹è±¡æ¯éä¿¡åæ¹é´çç½ç»ãæ¥å¡æ§å¶çæ¹å¼è¡¨ç°å¨åéæ¹çæ¥å¡çªå£çååï¼ä»èæ§å¶åéæ¹çæ°æ®åéå¿«æ¢ãTCP æåä½¿ç¨çæ¥å¡ç­ç¥ç§°ä¸º **TCP Tahoe and Reno**ã\n### Tahoe and Reno\nè¿ä¸ªæ¥å¡ç­ç¥ä¸»è¦åä¸ºæ¢å¯å¨ãæ¥å¡é¿åãæ¥å¡æ£æµä¸ä¸ªé¶æ®µã\n#### æ¢å¯å¨\nåè®¾æ¥æ¶çªå£å¤§å°è¿å¤§äºæ¥å¡çªå£ï¼ä¸ä¸èèå»¶è¿ç¡®è®¤ãæ¥å¡çªå£å¤§å°ä»ä¸ä¸ªæå¤§æ¥æé¿åº¦ MSS ï¼è¿æ¥å»ºç«æ¶éè¿ TCP éé¡¹åç¥ï¼å¼å§ï¼ä¹åæ¯å½æä¸ä¸ªæ¥ææ®µè¢«ç¡®è®¤ï¼æ¥å¡çªå£å°±å¢å¤§ä¸ä¸ª MSSãå¨è¿æ ·çç­ç¥ä¸ï¼æ¢å¯å¨é¶æ®µçæ¥å¡çªå£å¤§å°åææ°å¢é¿ãå³ä» `1 -> 2 -> 4 -> 8`ãå½å°è¾¾æ¢å¯å¨é¨éæ¶ï¼å°±è¿å¥æ¥å¡é¿åé¶æ®µã\n#### æ¥å¡é¿å\næ¥å¡é¿åé¶æ®µæ¥å¡çªå£å¤§å°ç»§ç»­å¢å ï¼ä½æ¯éåº¦æ¾æ¢ï¼æ¹æå½æ´ä¸ªçªå£å¤§å°çæ¥ææ®µé½è¢«ç¡®è®¤åï¼çªå£å¤§å°æå¢å ä¸ä¸ª MSSãè¡¨ç°ä¸º `8 -> 9 -> 10 -> 11`ï¼åç°çº¿æ§å¢é¿ã\n#### æ¥å¡æ£æµ\nå¦ææ¥å¡åçäºï¼å ä¸ºåçå¨ç½ç»ä¸­è·¯ç±å¨åºç°ä¸¢åç°è±¡ï¼å¨æ¥åæ¹å¤çè¡¨ç°ä¸ºåºç°ä»¥ä¸ä¸¤ç§æåµï¼å¹¶ååºå¯¹åºçååºï¼\n1. RTO è®¡æ¶å¨è¶æ¶ãè¿è¯´æç½ç»æ¥å¡çå¯è½æ§è¾å¤§ï¼TCP ååºè¾å¼ºççååºï¼\n    a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼\n    b. æ cwnd éæ°è®¾ç½®ä¸º 1 MSSï¼\n    c. éæ°è¿å¥æ¢å¯å¨é¶æ®µï¼\n\n2. æ¶å°åä¸ªç¸åç ACKï¼è¯´æåºç°æ¥å¡çå¯è½æ§è¾å°ï¼ä½æ¯åºç°äºä¸¢åï¼TCP ååºè¾å¼±çååºï¼Reno ç®æ³è¡¨ç°ä¸ºå¿«æ¢å¤ï¼Fast recoveryï¼ï¼\n    a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼\n    b. æ cwnd éæ°è®¾ç½®ä¸ºæ¢å¯å¨é¨éå¼ï¼\n    c. éæ°è¿å¥æ¥å¡é¿åé¶æ®µï¼\n\nå¾ç¤ºå¦ä¸ï¼\n![æ¥å¡æ§å¶ç¤ºä¾](congestion_control_example.png)\nTahoe ç®æ³ä¸ Reno ï¼Tahoe çæ¹è¿çæ¬ï¼çåºå«å¨äºæ¶å°åä¸ªç¸å ACK æ¶ï¼Tahoe ç®æ³çç­ç¥å RTO è®¡æ¶å¨è¶æ¶æ¶ä¸è´ã\n### å¶ä»æ¥å¡ç­ç¥\næ¥å¡æ§å¶ç­ç¥åªéè¦å¨åéæ¹å®ç°å³å¯ï¼ä¸éè¦æ¥åæ¹çåä¸ï¼å æ­¤å¯ä»¥ä»å¨åéæ¹é¨ç½²ä¸å¥ç®æ³ãç°å¨ TCP ç½ç»ä¸çç®æ³ä¹å¨ä¸æ­[æ¹è¿](https://en.wikipedia.org/wiki/TCP_congestion_control)ï¼æ¶ç°åºè¯¸å¦ [**TCP CUBIC**](http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf)ã[**TCP BBR**](https://ai.google/research/pubs/pub45646) è¿æ ·çç®æ³ã\n\n## TCP ä¸­çè®¡æ¶å¨\n### éä¼ è®¡æ¶å¨\néä¼ è®¡æ¶å¨çè¶æ¶æ¶é´ä¸º RTOï¼RTO ä¸»è¦æ ¹æ®æµéæå¾çæ¥ææ®µå¾è¿æ¶é´ RTTmè®¡ç®èæ¥ï¼è®¡ç®è¿ç¨å¦ä¸ï¼\n\né¦åè®¡ç®å¹³æ» RTTï¼å³RTTsï¼\n```\nRTTs = RTTm // ç¬¬ä¸æ¬¡æµé\nRTTs = (1 - Î±)RTTs + Î±RTTm // éåçæµé\n```\nç¶åè®¡ç® RTT çåå·® RTTdï¼\n```\nRTTd = RTTm / 2 // ç¬¬ä¸æ¬¡æµé\nRTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éåçæµé\n```\néä¼ è¶æ¶ RTO çè®¡ç®å¦ä¸ï¼\n```\nRTO = 6s // åå§å¼\nRTO = RTTs + 4RTTd // ç¬¬ä¸æ¬¡æµéå\n```\nä»»ææ¶å»åªæä¸ä¸ª RTT å¨è¿è¡æµéï¼å½éä¼ åçæ¶ä¼å½±å RTT çæµéï¼æ ¹æ® **Karn ç®æ³**ï¼TCP å¿½ç¥éä¼ æ¥æç RTTï¼èå¯¹äºéä¼ çæ¥æï¼RTO å¼ä¸ºåæ¥æçä¸¤åï¼å¦æåçç¬¬äºæ¬¡éä¼ ï¼åä¸ºååï¼ä»¥æ­¤ç±»æ¨ã\n### æç»­è®¡æ¶å¨\nå½æ¥åæ¹åéçªå£å¼ä¸º 0 çæ¥ææ®µä¹åï¼åæ¥å ä¸ºæ¥æ¶çªå£å¢å éè¦éåæ¥çªå£ä¸ºé 0ï¼ä½æ¯éåç ACK ä¸¢å¤±ï¼è¿ä¼å¯¼è´åéæ¹ä¸ç´ç­å¾é 0 çªå£éåï¼å¯¼è´æ­»éãæç»­è®¡æ¶å¨å°±æ¯æ¥åæ¹å¨æ¶å° 0 çªå£éååå¯ç¨ï¼å¦æè¶æ¶ååéæ¢æµæ¥æï¼ä¿ä½¿æ¥åæ¹éä¼  ACKã\n### Keep-Alive è®¡æ¶å¨\nKeep-Alive è®¡æ¶å¨ç¨äºé²æ­¢ TCP è¿æ¥é¿æ¶é´ç©ºé²ï¼æ¯å½æ¶å°å¯¹æ¹çæ¥ææ®µï¼è¿ä¸ªè®¡æ¶å¨å°±å¤ä½ãè¿ä¸ªè®¡æ¶å¨çè¶æ¶æ¶é´éå¸¸å¯ä»¥éè¿æ¥å£è¿è¡è®¾å®ã\n### Time-Wait è®¡æ¶å¨\nTime-Wait è®¡æ¶å¨å¯¹æåç FIN è¿è¡ç¡®è®¤æ¶å¯å¨çè¶æ¶è®¡æ¶å¨ãå¦æå¨æ¶å¸¸ä¸º 2MSL çè®¡æ¶å¨è¶æ¶ååæ¬¡æ¶å° FINï¼åéä¼  ACKï¼å¦åè¿æ¥å½»åºå³é­ã\n\n## ä¼ è¾å±ç[æªæ¥](https://blog.apnic.net/2017/12/12/internet-protocols-changing/)\n[QIUC](https://www.chromium.org/quic) äºè§£ä¸ä¸ä¸ï¼\n\n## åèèµæ\n1. [TCP/IP åè®®æ ç¬¬åç](https://book.douban.com/subject/5386194/)\n2. [Andrew S.Tanenbaum - Computer Networks 5th](https://book.douban.com/subject/5344443/)\n3. [WikiPedia - Transmission Control Protocol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)\n4. [WikiPedia - TCP congestion control](https://en.wikipedia.org/wiki/TCP_congestion_contro)\n5. [TCP Flags: PSH and URG](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)\n6. [KTH - Internetworking Lecture 4](https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf)\n7. [ä¸ä¸ª TCP FIN_WAIT2 ç¶æç»èå¼åçææ¨](https://blog.csdn.net/dog250/article/details/81256550)","slug":"tcp","published":1,"updated":"2018-08-10T08:22:40.596Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjknq4rfq00092ofnwap3aifd","content":"<p>çäº§ç¯å¢éå°äºç½ç»é®é¢ï¼ç¥å¯¹ TCP åè®®è¿æ¯æäºççï¼å¨æ­¤å¤ä¹ è®°å½ã<br><a id=\"more\"></a></p>\n<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><h3 id=\"æ¥ææ®µæ ¼å¼\"><a href=\"#æ¥ææ®µæ ¼å¼\" class=\"headerlink\" title=\"æ¥ææ®µæ ¼å¼\"></a>æ¥ææ®µæ ¼å¼</h3><p>TCP åè®®æ¥ææ®µä¸»è¦ç±<strong>é¦é¨ï¼Headerï¼</strong> ä¸<strong>æ°æ®ï¼Dataï¼</strong> ä¸¤é¨åç»æãå¨è®¡ç®æ ¡éªåæ¯è¿ä¼å ä¸èæçä¼ªé¦é¨ãæ­¤å¤ä¸»è¦è¯´æé¦é¨çç»æã<br><img src=\"tcp_header.png\" alt=\"å¾ 1 TCP Header (From: WikiPedia)\"><br>TCP å¨ç½ç»æ¨¡åä¸­å±äºè¿è¾å±ï¼ç¨äºæä¾è¿ç¨ä¸è¿ç¨é´çå­èæµéä¿¡æå¡ï¼å æ­¤éè¦<strong>æº / ç®ç«¯å£ï¼Source / Destination portï¼</strong> ä»¥ç¡®å®éä¿¡åæ¹è¿ç¨ãä½¿ç¨<strong>åºå·ï¼Sequence numberï¼seqï¼</strong> è¡¨ææ¬æ¥ææ®µç¬¬ä¸ä¸ªæ°æ®å­èçç¼å·ï¼åå§åºå·ç±åæ¹å¨ TCP è¿æ¥å»ºç«æ¶éæºçæãä½¿ç¨<strong>ç¡®è®¤å·ï¼Acknowledgment numberï¼ackï¼</strong> è¡¨ç¤ºæ¥åæ¹ææä»åéæ¹æ¥åçå­èç¼å·ã<strong>æ°æ®åç§»éï¼Data Offsetï¼</strong> é¡¾åæä¹æ¥ææ®µæ°æ®å¼å§å­èå¤çåç§»éï¼å³ TCP header çé¿åº¦ï¼ç±äºéé¡¹çå­å¨ï¼é¦é¨é¿åº¦çèå´æ¯ 20ï½60 Bytesï¼ä½æ¯è¯¥å­æ®µåªæ 4 Bitsï¼å æ­¤è¯¥å­æ®µæåºé¦é¨é¿åº¦æå¤å°ä¸ª 4 Bytesãæ¥ä¸æ¥ç 3 Bits è¢«<strong>ä¿çï¼Reservedï¼</strong> ãéåä¼è®¨è®º 9 ä¸ª<strong>æ å¿ä½ï¼Flagsï¼</strong>ã<strong>çªå£å¤§å°ï¼Window Sizeï¼</strong> å®ä¹äºæ¥åæ¹çæ¥åçªå£å¤§å°ï¼ç±æ¥åæ¹å³å®ï¼ç¶ååç¥åéæ¹ãå¨è®¡ç®<strong>æ ¡éªåï¼Checksumï¼</strong> æ¶éè¦å ä¸ä¼ªé¦é¨ï¼ä¼ªé¦é¨çåå®¹åæ¬æºç® IP å°åï¼TCP æ¥ææ®µé¿åº¦ç­ãå¦æ URG æ å¿ä½è¢«è®¾å®äºï¼é£<strong>ç´§æ¥æéï¼Urgent pointerï¼</strong> ç¨äºæç¤ºç´§æ¥æ°æ®æåä¸ä¸ªå­èå¨æ¥ææ®µæ°æ®é¨åä¸­çåç§»éãæåç 40 Bytes çç»<strong>éé¡¹ï¼Optionsï¼</strong>ã</p>\n<h3 id=\"Flags\"><a href=\"#Flags\" class=\"headerlink\" title=\"Flags\"></a>Flags</h3><ul>\n<li><strong>URG</strong>ï¼ä¸º 1 è¡¨ç¤ºæ°æ®ä¸­æç´§æ¥æ°æ®ãè¿ä¸ªæ è®°æ¯è¾å°è§ï¼å¯ä»¥æ¾å°çä¸äºåºç¨æï¼<a href=\"https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag\" target=\"_blank\" rel=\"noopener\">FTP</a>ï¼<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">Telnet</a>ï¼</li>\n<li><strong>ACK</strong>ï¼ä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­æ®µææï¼</li>\n<li><strong>PSH</strong>ï¼ä¸º 1 è¡¨ç¤ºææ¨éæ°æ®ï¼è¿ä¸ªå­æ®µä¸»è¦å®æ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">ä¸¤ä¸ªåè½</a>ï¼åéæ¹åºç¨å±æé TCP éè¦ç«å³åéæ°æ®ï¼æ¥åæ¹ TCP éè¦å°æ¶å°çæ°æ®ç«å³æäº¤ç»åºç¨å±ï¼</li>\n<li><strong>RST</strong>ï¼ä¸º 1 è¡¨ç¤ºåºç°ä¸¥éå·®éãå¯è½éè¦éç°åå»º TCP è¿æ¥ãè¿å¯ä»¥ç¨äºæç»éæ³çæ¥ææ®µåæç»è¿æ¥è¯·æ±ï¼</li>\n<li><strong>SYN</strong>ï¼ä¸º 1 è¡¨ç¤ºè¿æ¯è¿æ¥è¯·æ±ææ¯è¿æ¥æ¥åè¯·æ±ï¼ç¨äºåå»ºè¿æ¥åä½¿é¡ºåºå·åæ­¥ï¼</li>\n<li><strong>FIN</strong>ï¼ä¸º 1 è¡¨ç¤ºåéæ¹æ²¡ææ°æ®è¦ä¼ è¾äºï¼è¦æ±éæ¾è¿æ¥ï¼</li>\n</ul>\n<h2 id=\"é¶æ®µ\"><a href=\"#é¶æ®µ\" class=\"headerlink\" title=\"é¶æ®µ\"></a>é¶æ®µ</h2><p>TCP è¿æ¥å¯ä»¥åä¸ºä¸ä¸ªé¶æ®µï¼å»ºç«è¿æ¥ï¼ä¼ è¾æ°æ®ï¼ç»æ­¢è¿æ¥ãå¯ä»¥ç¨ä¸ä¸ªæéç¶ææºè¡¨ç¤ºï¼<br><img src=\"tcp_connection.png\" alt=\"å¾ 2 TCP è¿æ¥ (From: Computer Networks)&lt;br&gt;å¾ä¸­ï¼A/Bï¼è¿æ ·çæå­è¡¨ç¤ºâæ¶å°Aåæ§è¡Bï¼Aä¸Bå¯ä»¥æ¯æ å¿ä½æèæä»¤â&lt;br&gt;æ·±å®çº¿è¡¨ç¤º Client çè¡ä¸ºï¼æ·±èçº¿è¡¨ç¤º Server çè¡ä¸ºï¼æµè²çº¿è¡¨ç¤ºç¹æ®è¡ä¸º\"><br>ä¸é¢ç»åä¸ä¸ªç¨ Rust åç Echo Server ä¸æåå·¥å· Wireshark æ¥æ¼ç¤ºè¿ä¸ä¸ªè¿ç¨ãä»£ç å¦ä¸ï¼<br><figure class=\"highlight rust\"><figcaption><span>Echo Server</span><a href=\"/downloads/code/echo_server.rs\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::net::{TcpListener, TcpStream};</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::thread;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Write;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> listener = TcpListener::bind(<span class=\"string\">\"::1:9999\"</span>).unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> stream <span class=\"keyword\">in</span> listener.incoming() {</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(stream) =&gt; {</span><br><span class=\"line\">                thread::spawn(|| {</span><br><span class=\"line\">                    handle_client(stream);</span><br><span class=\"line\">                });</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(_) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">\"Error\"</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">handle_client</span></span>(<span class=\"keyword\">mut</span> stream: TcpStream) {</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> read = [<span class=\"number\">0</span>; <span class=\"number\">1024</span>];</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream.read(&amp;<span class=\"keyword\">mut</span> read) {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(n) =&gt; {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> n == <span class=\"number\">0</span> {</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                stream.write(&amp;read[<span class=\"number\">0</span>..n]).unwrap();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(err) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(err);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure><br>Echo Server å¯å¨ä¹åä½¿ç¨ telnet å·¥å·è¿æ¥è³æå¡å¨ï¼ä¸æå¡å¨äº¤äºä¸¤æ¬¡ï¼å³åæ¾ä¸¤æ¬¡å­ç¬¦ä¸²ï¼ç¶åä»éåº telnetãæå°çåæªå¾å¦ä¸ï¼<br><img src=\"wireshark.png\" alt=\"å¾ 3 Wireshark æå\"></p>\n<p>å¨ä¸é¢çè¡¨è¿°ä¸­ï¼å®¢æ·ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µååèµ·è¯·æ±çä¸æ¹ï¼æå¡ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µåæ¥åè¯·æ±çä¸æ¹ãå¨ TCP ä¸­ï¼æå¡ç«¯åå®¢æ·ç«¯ä¹é´å¯ä»¥è¿è¡ååéä¿¡ï¼ä»ä»¬å¯ä»¥çè§£ä¸ºå¯¹ç­çï¼å¨è¿æ¥å»ºç«åï¼å®éä¸æ²¡ææå¡ç«¯åå®¢æ·ç«¯çåºå«ã</p>\n<h3 id=\"å»ºç«è¿æ¥\"><a href=\"#å»ºç«è¿æ¥\" class=\"headerlink\" title=\"å»ºç«è¿æ¥\"></a>å»ºç«è¿æ¥</h3><p>åä¸ä¸ªåä»£è¡¨äºå»ºç«è¿æ¥çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼å¤§å¤æ°æåµä¸å°±å¦åæåæç¤ºï¼ç§°ä¸º<strong>ä¸æ¬¡æ¡æï¼3-way handshakeï¼</strong>ãå¾ 2 ä¸­è¿ç»åºäºåæ¹åæ¶æå¼è¿æ¥ä¸è¿æ¥å¤ä½è¿ä¸¤ç§æ¯è¾å°è§çææ¯ã</p>\n<ol>\n<li>å®¢æ·ç«¯åéç»æå¡ç«¯ä¸ä¸ª <strong>SYN</strong> æ¥æï¼ç¨ä»¥åç¥æå¡ç«¯åå§åºå·ä¸º 0ï¼æ­¤å¤ç Seq ç»è¿ Wireshark çå¤çï¼åæäºç¸å¯¹å¼ï¼ï¼ç¶åå®¢æ·ç«¯è¿å¥ <strong><em>SYN_SENT</em></strong> ç¶æã</li>\n<li>æå¡å¨æ¶å° 1 ä¸­æ¥æåï¼åç»å®¢æ·ç«¯ä¸ä¸ª <strong>SYN + ACK</strong> æ¥æï¼åç¥å®¢æ·ç«¯åå§åºå·ä¸º 0ï¼ä¸æ¥ä¸æ¥ææä»å®¢æ·ç«¯æ¶å°çåºå· Ack ä¸º 1ãæå¡ç«¯è¿å¥ <strong><em>SYN_RCVD</em></strong> ç¶æãå¯è§ <strong>SYN æ¥ææ¶èäºä¸ä¸ªåºå·</strong>ã</li>\n<li>å®¢æ·ç«¯ç»æå¡ç«¯åå¤ <strong>ACK</strong> æ¥æï¼è¿å¥ <strong><em>ESTABLISHED</em></strong> ç¶æï¼æå¡ç«¯å¨æ¶å°è¿ä¸ªæ¥æè¿æ¥å»ºç«å®æãå¯è§ <strong>ACK æ¥æå¨ä¸æºå¸¦æ°æ®çæåµä¸ä¸æ¶èåºå·</strong>ã</li>\n</ol>\n<h3 id=\"ä¼ è¾æ°æ®\"><a href=\"#ä¼ è¾æ°æ®\" class=\"headerlink\" title=\"ä¼ è¾æ°æ®\"></a>ä¼ è¾æ°æ®</h3><p>å¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åå«å±ç¤ºäºä¸¤æ¬¡äº¤äºè¿ç¨ãä»¥ç¬¬äºæ¬¡äº¤äºä¸ºä¾ï¼</p>\n<ol>\n<li>P72 ä¸­ï¼å®¢æ·ç«¯å°æ³è¦åæ¾å­ç¬¦ä¸²åéç»æå¡ç«¯ï¼åç¥æå¡å¨è¿ä¸ªæ¥ææ®µçæ°æ®é¦å­èåºå·ä¸º 8ï¼å¹¶ä¸å¸æä»æå¡ç«¯æ¶å°çä¸ä¸ä¸ªåºå·æ¯ 8ã</li>\n<li>æå¡ç«¯å°åæ¾çå­ç¬¦ä¸²ä¸å¯¹ P72 çç¡®è®¤ä¸èµ·åéç»å®¢æ·ç«¯ãP72 çé¿åº¦ä¸º 9ï¼å æ­¤æ¥ææ®µä¸­æ°æ®çåºå·èå´ä¸º [8,17)ï¼å æ­¤å¨ P73 ä¸­ Ack ä¸º 17ã</li>\n<li>å®¢æ·ç«¯ç¡®è®¤ P73ã</li>\n</ol>\n<p>éè¦æ³¨æçæ¯ï¼è¿ä¸¤æ¬¡äº¤äºææåºå«ï¼ç¬¬ä¸æ¬¡äº¤äºæ¶ï¼æå¡ç«¯åè¿åäºä¸ä¸ªç¡®è®¤ç»å®¢æ·ç«¯ï¼ç¶ååé¢å¤åéä¸æ¡æºå¸¦åæ¾åå®¹çæ¥ææ®µãä½æ¯ç¬¬äºæ¬¡äº¤äºæ¶çç¥äºåç¬çç¡®è®¤ã</p>\n<h3 id=\"ç»æ­¢è¿æ¥\"><a href=\"#ç»æ­¢è¿æ¥\" class=\"headerlink\" title=\"ç»æ­¢è¿æ¥\"></a>ç»æ­¢è¿æ¥</h3><p>æ ¹æ®âå¹¿å¤§åä¸»âåä½çæç« ä¸<a href=\"https://www.zhihu.com/question/50646354\" target=\"_blank\" rel=\"noopener\">é®ç­ç½ç«çè®¨è®º</a>ä»¥ååç§é¢ç»ï¼åºæ¬ä¸è´è®¤ä¸ºï¼ç»æ­¢è¿æ¥éå¸¸è¢«æä¸º<strong>åæ¬¡æ¥æï¼4-way terminationï¼</strong>ï¼å³éä¿¡åæ¹ä¼æåæ¬¡äº¤äºï¼ä½æ¯å¦å¾ 2 æç¤ºï¼ä¹å­å¨<strong>ä¸æ¬¡æ¥æ</strong>çå¯è½æ§ï¼ä¸ææ¬å°çå¤æ¬¡æåä¹å¦å¾ 3 ä¸è´ââåä¸ºä¸æ¬¡æ¥æï¼ä¸æ ä¸ä¾å¤ãä¸é¢å¯¹åæ¬¡æ¥æè¿è¡åæï¼ä¸æ¬¡æ¥æå¯ä»¥è¢«å¶æ¦æ¬ï¼</p>\n<ol>\n<li>å®¢æ·ç«¯åèµ·ç»æ­¢è¿æ¥ï¼ååºä¸ä¸ª <strong>FIN</strong> æ¥æç»æå¡ç«¯ï¼åè®¾è¯¥æ¥æç Seq ä¸º Xï¼Ack ä¸º Yãç¶åå®¢æ·ç«¯è¿å¥ <strong><em>FIN_WAIT1</em></strong> ç¶æï¼é¤éä¼  FIN æ¥æä¸åé ACK ç¡®è®¤ä¹å¤ï¼ä¸ååéåºç¨æ°æ®ç»æå¡ç«¯ã</li>\n<li>æå¡ç«¯æ¶å° FIN æ¥ææ®µåååå¤ä¸ä¸ª <strong>ACK</strong> æ¥æï¼è¿å¥ <strong><em>CLOSE_WAIT</em></strong> ç¶æï¼è¯¥æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã</li>\n<li>å®¢æ·ç«¯å¨æ¶å° FIN ç ACK ä¹åè¿å¥ <strong><em>FIN_WAIT2</em></strong> ç¶æãæ­¤æ¶æå¡ç«¯è¿å¯ä»¥ç»§ç»­å°æªåéå®çåºç¨æ°æ®åéç»å®¢æ·ç«¯ã</li>\n<li>æå¡ç«¯åéå®æ°æ®ååéä¸æ¡ <strong>FIN</strong> æ¥æï¼è¿å¥ <strong><em>LAST_ACK</em></strong> ç¶æï¼è¯¥æ¥æç Seq ä¸º Y+Kï¼Ack ä¸º X+1ã</li>\n<li>å®¢æ·ç«¯æ¶å°æå¡ç«¯ç FIN åï¼åéæåç <strong>ACK</strong> æ¥æç»æå¡å¨ï¼ç¶åè¿å¥ <strong><em>TIME_WAIT</em></strong> ç¶æãå¦æå¨ 2MSLï¼æå¤§æ¥ææ®µå¯¿å½ï¼éå¸¸ä¸º30ï½60sï¼åå®¢æ·ç«¯æ²¡åæ¬¡æ¶å° FIN æ¥æï¼åè¿å¥ <strong><em>CLOSED</em></strong> ç¶æï¼å¦åéå ACK æ¥æè¿è¡éè¯ã</li>\n<li>æå¡ç«¯å¨æ¶å° ACK æ¥æåè¿å¥ <strong><em>CLOSED</em></strong> ç¶æã</li>\n</ol>\n<p>ä¸æ¬¡æ¥æè¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åå¹¶ä¸ºä¸æ­¥ï¼å³åæ¶åéå¯¹å®¢æ·ç«¯ FIN ç ACK æ¥æä¸ æå¡ç«¯èªå·±ç FIN æ¥æãè¿æ¡ <strong>FIN+ACK</strong> æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã</p>\n<p>è³äºå¨ä»ä¹ææ¯ä¸åºç°ä¸æ¬¡æ¡ææèåæ¬¡æ¡æï¼å¤§å¤æ°çè§ç¹è®¤ä¸ºåæ¶å° FIN æ¥æçä¸æ¹è¿éè¦åä¸å±åºç¨è¯¢é®æ¯å¦ä»ç¶ææ°æ®éè¦åéï¼å ä¸ºè¦ç­å¾ä¸å±çåå¤ï¼æä»¥âä¸ºä½ä¸æ©ç¹æå¯¹ FIN ç ACK ååºå»å¢ï¼ï¼âèä¸ç«å³ Ack è½é²æ­¢å¯¹æ¹éä¼  FINãä½æ¯ææ²¡æå­å¨ä¸éè¦è¯¢é®ä¸å±æèä¸éè¦ç«å³åå¤ Ack çå¯è½ï¼å°±å¦åä¼ è¾æ°æ®åºç°çæåµä¸æ ·ï¼è¿äºåºè¯¥ä¸ TCP çå·ä½å®ç°ç¸å³ï¼ç®åè½åä¸ç²¾åæéï¼è¿æå¾å¯¹ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c\" target=\"_blank\" rel=\"noopener\">Linux TCP å®ç°æºç </a>è¿è¡éè¯»ã</p>\n<h2 id=\"æ»å¨çªå£\"><a href=\"#æ»å¨çªå£\" class=\"headerlink\" title=\"æ»å¨çªå£\"></a>æ»å¨çªå£</h2><p>æ»å¨çªå£æ¯ TCP ä¸­ç¨äºå®ç°è¯¸å¦ ACK ç¡®è®¤ãæµéæ§å¶ãæ¥å¡æ§å¶çæ¿è½½ç»æãå¦å¾æç¤º:<br><img src=\"sliding_window.png\" alt=\"å¾ 4 æ»å¨çªå£\"><br>åå° TCP çä½æ¯ç®åçååéä¿¡ï¼ååéæ¹æä¸ä¸ªåéçªå£ï¼æ¥æ¶æ¹æä¸ä¸ªæ¥æ¶çªå£ãæ­£å¦å¾ä¸­æç¤ºï¼ä¼ è¾çæ¯æ¥ææ®µï¼çªå£å¤§å°çåä½æ¯å­èãä¸¤ä¸ªçªå£ä¸­<strong>ç½è²åºå</strong>ä¸ºç©ºç½ä½ç½®ï¼ç­å¾è¢«åºç¨å±æèç½ç»å±å¡«æ»¡ï¼<strong>ç°è²åºå</strong>æ¯å·²ç»åéä½æ¯è¿æ²¡ææ¥åå°ç¡®è®¤çå­èï¼<strong>ç²è²åºå</strong>å¨åéçªå£ä¸­è¡¨ç¤ºç­å¾è¢«åéçå­èï¼å¨æ¥æ¶çªå£æ±æ»è¡¨ç¤ºç­å¾äº¤ä»çå­èã<br>åéçªå£çå¤§å°ä¸ºæ¥åæ¹éè¿é¦é¨ä¸­çªå£å¤§å°å­æ®µåç¥çæ¥æ¶çªå£å¤§å° rwnd åä¹åä¼è®²å°çæ¥å¡çªå£çå¤§å° cwnd ä¸¤èä¸­çè¾å°å¼ï¼å³ <code>min(rwnd , cwnd)</code>ãæ¥æ¶çªå£å¤§å°æ¯æ¥æ¶æ¹å¯ç¨ç¼å­ç©ºé´å¤§å°ï¼ä¸º <code>rwnd = ç¼å­å¤§å° - åå¤äº¤ä»çå­èæ°</code>ã</p>\n<h2 id=\"æµéæ§å¶\"><a href=\"#æµéæ§å¶\" class=\"headerlink\" title=\"æµéæ§å¶\"></a>æµéæ§å¶</h2><p>æµéæ§å¶ç¨äºå¹³è¡¡çäº§èäº§çæ°æ®ä¸æ¶è´¹èæ¶èæ°æ®çéåº¦ãTCP ä¸­çæµéæ§å¶å®ç°çä¸»è¦éå¾æ¯ä¸æ­è°æ´åéçªå£çå¤§å°å®ç°ãåé TCP ä¸æ¦åç°åéåéçªå£æ»¡äºå°±ä¼å¯¹åéè¿ç¨è¿è¡åé¦ãæ¥åæ¹æ ¹æ®ä¹åä»åéæ¹æ¶å°çæ°æ®éåæå¡å¨å·²ç»æ¶èçæ°æ®éå¾å°èªèº«æ¥æ¶çªå£çå¤§å°ï¼å°è¿ä¸ªå¼åç¥åéæ¹ï¼åéæ¹æ ¹æ®æ¶å°ççªå£å¤§å°è°æ´èªèº«çªå£å¤§å°ã<br>è¿ææ­£å¯¹éä¿¡åæ¹äº§çæ°æ®å°æèæ¶è´¹æ°æ®æ¢äº§çç³æ¶çªå£ç»¼åå¾æ¶ï¼æå¶ä»æ¹é¢çæµéæ§å¶ãå½åéæ¹æ°æ®éç¸å¯¹äºé¦é¨å°å¾å¤çæ¥æå¾å¤æ¶ï¼å¯ä»¥ä½¿ç¨ <strong>Nagle ç®æ³</strong>åå°è¿ç§å°æ¥æéãå½æ¥åæ¹æ¶èæ°æ®å¾æ¢æ¶ï¼æ¯æ¬¡åç¥åéæ¹ççªå£å¤§å°ä¼æ¯è¾å°ï¼ä¹å¯è½äº§çå¾å¤å°æ¥æï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ <strong>Clark è§£å³æ¹æ³</strong>æèè¿è¡<strong>æ¨è¿ç¡®è®¤</strong>ãå³äºè¿å ç§æ¹æ¡çåæåå·ä½çä½¿ç¨ææ¯å¯ä»¥åè dog520 å¤§ç¥çè¿ç¯æç« ââ<a href=\"https://blog.csdn.net/dog250/article/details/21303679\" target=\"_blank\" rel=\"noopener\">åæ¬¡è°è° TCP ç Nagle ç®æ³ä¸ TCP_CORK éé¡¹</a>ã</p>\n<h2 id=\"å·®éæ§å¶\"><a href=\"#å·®éæ§å¶\" class=\"headerlink\" title=\"å·®éæ§å¶\"></a>å·®éæ§å¶</h2><p>å·®éæ§å¶ç¨äºæè¿° TCP å¨åéæèæ¥åå°æ¥ææ®µåçå¼å¸¸æ¶çè¡ä¸ºï¼å¶ä¸»è¦è¡¨ç°å¨å¦ä¸å ä¸ªæ¹é¢ï¼</p>\n<ol>\n<li><strong>æ ¡éªå</strong>ï¼å¨æ¥åæ¹ï¼å¦ææ¶å°çæ¥ææ®µæªéè¿æ ¡éªåæ ¡éªï¼åç«å³ä¸¢å¼ï¼åä¹ï¼åéè¿<strong>ç¡®è®¤è§å</strong>ï¼ä¸é¢é©¬ä¸æåï¼è¿è¡ç¡®è®¤ï¼</li>\n<li><strong>éä¼ </strong>ï¼å¨åéæ¹ï¼å¦æä¸ä¸ªæ¥ææ®µéä¼ è¶æ¶è®¡æ¶å¨ï¼RTOï¼è¶æ¶ï¼å³å¨ RTO æ¶é´ä¹åä»ç¶æªæ¶å° ACKï¼åç«å³éä¼ æªè¢«ç¡®è®¤çæå°çæ¥ææ®µï¼å¦ææ¶å°åä¸ªç¸åçç ACK ï¼åç«å³éä¼ ä¸ä¸ä¸ªæ¥ææ®µï¼</li>\n</ol>\n<h3 id=\"ç¡®è®¤è§å\"><a href=\"#ç¡®è®¤è§å\" class=\"headerlink\" title=\"ç¡®è®¤è§å\"></a>ç¡®è®¤è§å</h3><ol>\n<li>å½æ¥åæ¹ååéæ¹åéæ°æ®æ¥ææ®µæ¶ï¼å¿é¡»<strong>æå¸¦</strong> ACKï¼</li>\n<li>å½æ¥åæ¹æ²¡ææ°æ®è¦åéæ¶ï¼ä½æ¯æ¶å°ä¸ä¸ª<strong>æåºå°è¾¾</strong>çæ¥æï¼åæ¶åä¸ä¸ªæ¥ææ®µä¹å·²ç»ç¡®è®¤è¿äºï¼é£ä¹æ¥æ¶æ¹å°±æ¨è¿åéç¡®è®¤æ¥ææ®µï¼ç´å°å¦ä¸ä¸ªæ¥ææ®µå°è¾¾æèå»¶è¿ä¸æ®µæ¶é´ä»¥åå° ACK æ¥æéï¼</li>\n<li>å½æææçæ¥ææ®µå°è¾¾ï¼ä¸åä¸ä¸ª<strong>æåºå°è¾¾</strong>çæ¥æè¿æªè¢«ç¡®è®¤ï¼åç«å³ ACKï¼ACK çåºå·ä»ç¶æ¯ä¸ä¸ä¸ªæ­£å¸¸ææçåºå·ï¼ä¸åï¼ï¼</li>\n<li>å½åºå·æ¯ææçå¤§çæ¥ææ®µï¼<strong>å¤±åº</strong>æ¥ææ®µï¼å°è¾¾ï¼åç«å³ ACKï¼ä¸å­å¨è¯¥æ¥ææ®µï¼</li>\n<li>å½<strong>ä¸¢å¤±</strong>çæ¥ææ®µå°è¾¾æ¶ï¼åç«å³ ACKï¼</li>\n<li>å½<strong>éå¤</strong>çæ¥ææ®µå°è¾¾æ¶ï¼åä¸¢å¼ï¼ä¸ç«å³ ACKï¼</li>\n</ol>\n<h2 id=\"æ¥å¡æ§å¶\"><a href=\"#æ¥å¡æ§å¶\" class=\"headerlink\" title=\"æ¥å¡æ§å¶\"></a>æ¥å¡æ§å¶</h2><p>æ¥å¡æ§å¶æ¯ä¸ºäºé¿åå ä¸ºç½ç»åéå¯¼è´ç½ç»ä¸è½æç§åéæ¹äº§ççæ°æ®çéåº¦å°æ¥ææ®µäº¤ä»ç»æ¥åæ¹ãä¸æµéæ§å¶èå¯çå¯¹è±¡æ¯éä¿¡åæ¹ä¸åï¼æ¥å¡æ§å¶çèå¯å¯¹è±¡æ¯éä¿¡åæ¹é´çç½ç»ãæ¥å¡æ§å¶çæ¹å¼è¡¨ç°å¨åéæ¹çæ¥å¡çªå£çååï¼ä»èæ§å¶åéæ¹çæ°æ®åéå¿«æ¢ãTCP æåä½¿ç¨çæ¥å¡ç­ç¥ç§°ä¸º <strong>TCP Tahoe and Reno</strong>ã</p>\n<h3 id=\"Tahoe-and-Reno\"><a href=\"#Tahoe-and-Reno\" class=\"headerlink\" title=\"Tahoe and Reno\"></a>Tahoe and Reno</h3><p>è¿ä¸ªæ¥å¡ç­ç¥ä¸»è¦åä¸ºæ¢å¯å¨ãæ¥å¡é¿åãæ¥å¡æ£æµä¸ä¸ªé¶æ®µã</p>\n<h4 id=\"æ¢å¯å¨\"><a href=\"#æ¢å¯å¨\" class=\"headerlink\" title=\"æ¢å¯å¨\"></a>æ¢å¯å¨</h4><p>åè®¾æ¥æ¶çªå£å¤§å°è¿å¤§äºæ¥å¡çªå£ï¼ä¸ä¸èèå»¶è¿ç¡®è®¤ãæ¥å¡çªå£å¤§å°ä»ä¸ä¸ªæå¤§æ¥æé¿åº¦ MSS ï¼è¿æ¥å»ºç«æ¶éè¿ TCP éé¡¹åç¥ï¼å¼å§ï¼ä¹åæ¯å½æä¸ä¸ªæ¥ææ®µè¢«ç¡®è®¤ï¼æ¥å¡çªå£å°±å¢å¤§ä¸ä¸ª MSSãå¨è¿æ ·çç­ç¥ä¸ï¼æ¢å¯å¨é¶æ®µçæ¥å¡çªå£å¤§å°åææ°å¢é¿ãå³ä» <code>1 -&gt; 2 -&gt; 4 -&gt; 8</code>ãå½å°è¾¾æ¢å¯å¨é¨éæ¶ï¼å°±è¿å¥æ¥å¡é¿åé¶æ®µã</p>\n<h4 id=\"æ¥å¡é¿å\"><a href=\"#æ¥å¡é¿å\" class=\"headerlink\" title=\"æ¥å¡é¿å\"></a>æ¥å¡é¿å</h4><p>æ¥å¡é¿åé¶æ®µæ¥å¡çªå£å¤§å°ç»§ç»­å¢å ï¼ä½æ¯éåº¦æ¾æ¢ï¼æ¹æå½æ´ä¸ªçªå£å¤§å°çæ¥ææ®µé½è¢«ç¡®è®¤åï¼çªå£å¤§å°æå¢å ä¸ä¸ª MSSãè¡¨ç°ä¸º <code>8 -&gt; 9 -&gt; 10 -&gt; 11</code>ï¼åç°çº¿æ§å¢é¿ã</p>\n<h4 id=\"æ¥å¡æ£æµ\"><a href=\"#æ¥å¡æ£æµ\" class=\"headerlink\" title=\"æ¥å¡æ£æµ\"></a>æ¥å¡æ£æµ</h4><p>å¦ææ¥å¡åçäºï¼å ä¸ºåçå¨ç½ç»ä¸­è·¯ç±å¨åºç°ä¸¢åç°è±¡ï¼å¨æ¥åæ¹å¤çè¡¨ç°ä¸ºåºç°ä»¥ä¸ä¸¤ç§æåµï¼å¹¶ååºå¯¹åºçååºï¼</p>\n<ol>\n<li><p>RTO è®¡æ¶å¨è¶æ¶ãè¿è¯´æç½ç»æ¥å¡çå¯è½æ§è¾å¤§ï¼TCP ååºè¾å¼ºççååºï¼<br> a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼<br> b. æ cwnd éæ°è®¾ç½®ä¸º 1 MSSï¼<br> c. éæ°è¿å¥æ¢å¯å¨é¶æ®µï¼</p>\n</li>\n<li><p>æ¶å°åä¸ªç¸åç ACKï¼è¯´æåºç°æ¥å¡çå¯è½æ§è¾å°ï¼ä½æ¯åºç°äºä¸¢åï¼TCP ååºè¾å¼±çååºï¼Reno ç®æ³è¡¨ç°ä¸ºå¿«æ¢å¤ï¼Fast recoveryï¼ï¼<br> a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼<br> b. æ cwnd éæ°è®¾ç½®ä¸ºæ¢å¯å¨é¨éå¼ï¼<br> c. éæ°è¿å¥æ¥å¡é¿åé¶æ®µï¼</p>\n</li>\n</ol>\n<p>å¾ç¤ºå¦ä¸ï¼<br><img src=\"congestion_control_example.png\" alt=\"æ¥å¡æ§å¶ç¤ºä¾\"><br>Tahoe ç®æ³ä¸ Reno ï¼Tahoe çæ¹è¿çæ¬ï¼çåºå«å¨äºæ¶å°åä¸ªç¸å ACK æ¶ï¼Tahoe ç®æ³çç­ç¥å RTO è®¡æ¶å¨è¶æ¶æ¶ä¸è´ã</p>\n<h3 id=\"å¶ä»æ¥å¡ç­ç¥\"><a href=\"#å¶ä»æ¥å¡ç­ç¥\" class=\"headerlink\" title=\"å¶ä»æ¥å¡ç­ç¥\"></a>å¶ä»æ¥å¡ç­ç¥</h3><p>æ¥å¡æ§å¶ç­ç¥åªéè¦å¨åéæ¹å®ç°å³å¯ï¼ä¸éè¦æ¥åæ¹çåä¸ï¼å æ­¤å¯ä»¥ä»å¨åéæ¹é¨ç½²ä¸å¥ç®æ³ãç°å¨ TCP ç½ç»ä¸çç®æ³ä¹å¨ä¸æ­<a href=\"https://en.wikipedia.org/wiki/TCP_congestion_control\" target=\"_blank\" rel=\"noopener\">æ¹è¿</a>ï¼æ¶ç°åºè¯¸å¦ <a href=\"http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf\" target=\"_blank\" rel=\"noopener\"><strong>TCP CUBIC</strong></a>ã<a href=\"https://ai.google/research/pubs/pub45646\" target=\"_blank\" rel=\"noopener\"><strong>TCP BBR</strong></a> è¿æ ·çç®æ³ã</p>\n<h2 id=\"TCP-ä¸­çè®¡æ¶å¨\"><a href=\"#TCP-ä¸­çè®¡æ¶å¨\" class=\"headerlink\" title=\"TCP ä¸­çè®¡æ¶å¨\"></a>TCP ä¸­çè®¡æ¶å¨</h2><h3 id=\"éä¼ è®¡æ¶å¨\"><a href=\"#éä¼ è®¡æ¶å¨\" class=\"headerlink\" title=\"éä¼ è®¡æ¶å¨\"></a>éä¼ è®¡æ¶å¨</h3><p>éä¼ è®¡æ¶å¨çè¶æ¶æ¶é´ä¸º RTOï¼RTO ä¸»è¦æ ¹æ®æµéæå¾çæ¥ææ®µå¾è¿æ¶é´ RTTmè®¡ç®èæ¥ï¼è®¡ç®è¿ç¨å¦ä¸ï¼</p>\n<p>é¦åè®¡ç®å¹³æ» RTTï¼å³RTTsï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTs = RTTm // ç¬¬ä¸æ¬¡æµé</span><br><span class=\"line\">RTTs = (1 - Î±)RTTs + Î±RTTm // éåçæµé</span><br></pre></td></tr></table></figure></p>\n<p>ç¶åè®¡ç® RTT çåå·® RTTdï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTd = RTTm / 2 // ç¬¬ä¸æ¬¡æµé</span><br><span class=\"line\">RTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éåçæµé</span><br></pre></td></tr></table></figure></p>\n<p>éä¼ è¶æ¶ RTO çè®¡ç®å¦ä¸ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTO = 6s // åå§å¼</span><br><span class=\"line\">RTO = RTTs + 4RTTd // ç¬¬ä¸æ¬¡æµéå</span><br></pre></td></tr></table></figure></p>\n<p>ä»»ææ¶å»åªæä¸ä¸ª RTT å¨è¿è¡æµéï¼å½éä¼ åçæ¶ä¼å½±å RTT çæµéï¼æ ¹æ® <strong>Karn ç®æ³</strong>ï¼TCP å¿½ç¥éä¼ æ¥æç RTTï¼èå¯¹äºéä¼ çæ¥æï¼RTO å¼ä¸ºåæ¥æçä¸¤åï¼å¦æåçç¬¬äºæ¬¡éä¼ ï¼åä¸ºååï¼ä»¥æ­¤ç±»æ¨ã</p>\n<h3 id=\"æç»­è®¡æ¶å¨\"><a href=\"#æç»­è®¡æ¶å¨\" class=\"headerlink\" title=\"æç»­è®¡æ¶å¨\"></a>æç»­è®¡æ¶å¨</h3><p>å½æ¥åæ¹åéçªå£å¼ä¸º 0 çæ¥ææ®µä¹åï¼åæ¥å ä¸ºæ¥æ¶çªå£å¢å éè¦éåæ¥çªå£ä¸ºé 0ï¼ä½æ¯éåç ACK ä¸¢å¤±ï¼è¿ä¼å¯¼è´åéæ¹ä¸ç´ç­å¾é 0 çªå£éåï¼å¯¼è´æ­»éãæç»­è®¡æ¶å¨å°±æ¯æ¥åæ¹å¨æ¶å° 0 çªå£éååå¯ç¨ï¼å¦æè¶æ¶ååéæ¢æµæ¥æï¼ä¿ä½¿æ¥åæ¹éä¼  ACKã</p>\n<h3 id=\"Keep-Alive-è®¡æ¶å¨\"><a href=\"#Keep-Alive-è®¡æ¶å¨\" class=\"headerlink\" title=\"Keep-Alive è®¡æ¶å¨\"></a>Keep-Alive è®¡æ¶å¨</h3><p>Keep-Alive è®¡æ¶å¨ç¨äºé²æ­¢ TCP è¿æ¥é¿æ¶é´ç©ºé²ï¼æ¯å½æ¶å°å¯¹æ¹çæ¥ææ®µï¼è¿ä¸ªè®¡æ¶å¨å°±å¤ä½ãè¿ä¸ªè®¡æ¶å¨çè¶æ¶æ¶é´éå¸¸å¯ä»¥éè¿æ¥å£è¿è¡è®¾å®ã</p>\n<h3 id=\"Time-Wait-è®¡æ¶å¨\"><a href=\"#Time-Wait-è®¡æ¶å¨\" class=\"headerlink\" title=\"Time-Wait è®¡æ¶å¨\"></a>Time-Wait è®¡æ¶å¨</h3><p>Time-Wait è®¡æ¶å¨å¯¹æåç FIN è¿è¡ç¡®è®¤æ¶å¯å¨çè¶æ¶è®¡æ¶å¨ãå¦æå¨æ¶å¸¸ä¸º 2MSL çè®¡æ¶å¨è¶æ¶ååæ¬¡æ¶å° FINï¼åéä¼  ACKï¼å¦åè¿æ¥å½»åºå³é­ã</p>\n<h2 id=\"ä¼ è¾å±çæªæ¥\"><a href=\"#ä¼ è¾å±çæªæ¥\" class=\"headerlink\" title=\"ä¼ è¾å±çæªæ¥\"></a>ä¼ è¾å±ç<a href=\"https://blog.apnic.net/2017/12/12/internet-protocols-changing/\" target=\"_blank\" rel=\"noopener\">æªæ¥</a></h2><p><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"noopener\">QIUC</a> äºè§£ä¸ä¸ä¸ï¼</p>\n<h2 id=\"åèèµæ\"><a href=\"#åèèµæ\" class=\"headerlink\" title=\"åèèµæ\"></a>åèèµæ</h2><ol>\n<li><a href=\"https://book.douban.com/subject/5386194/\" target=\"_blank\" rel=\"noopener\">TCP/IP åè®®æ ç¬¬åç</a></li>\n<li><a href=\"https://book.douban.com/subject/5344443/\" target=\"_blank\" rel=\"noopener\">Andrew S.Tanenbaum - Computer Networks 5th</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\" target=\"_blank\" rel=\"noopener\">WikiPedia - Transmission Control Protocol</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/TCP_congestion_contro\" target=\"_blank\" rel=\"noopener\">WikiPedia - TCP congestion control</a></li>\n<li><a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">TCP Flags: PSH and URG</a></li>\n<li><a href=\"https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf\" target=\"_blank\" rel=\"noopener\">KTH - Internetworking Lecture 4</a></li>\n<li><a href=\"https://blog.csdn.net/dog250/article/details/81256550\" target=\"_blank\" rel=\"noopener\">ä¸ä¸ª TCP FIN_WAIT2 ç¶æç»èå¼åçææ¨</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>çäº§ç¯å¢éå°äºç½ç»é®é¢ï¼ç¥å¯¹ TCP åè®®è¿æ¯æäºççï¼å¨æ­¤å¤ä¹ è®°å½ã<br>","more":"</p>\n<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><h3 id=\"æ¥ææ®µæ ¼å¼\"><a href=\"#æ¥ææ®µæ ¼å¼\" class=\"headerlink\" title=\"æ¥ææ®µæ ¼å¼\"></a>æ¥ææ®µæ ¼å¼</h3><p>TCP åè®®æ¥ææ®µä¸»è¦ç±<strong>é¦é¨ï¼Headerï¼</strong> ä¸<strong>æ°æ®ï¼Dataï¼</strong> ä¸¤é¨åç»æãå¨è®¡ç®æ ¡éªåæ¯è¿ä¼å ä¸èæçä¼ªé¦é¨ãæ­¤å¤ä¸»è¦è¯´æé¦é¨çç»æã<br><img src=\"tcp_header.png\" alt=\"å¾ 1 TCP Header (From: WikiPedia)\"><br>TCP å¨ç½ç»æ¨¡åä¸­å±äºè¿è¾å±ï¼ç¨äºæä¾è¿ç¨ä¸è¿ç¨é´çå­èæµéä¿¡æå¡ï¼å æ­¤éè¦<strong>æº / ç®ç«¯å£ï¼Source / Destination portï¼</strong> ä»¥ç¡®å®éä¿¡åæ¹è¿ç¨ãä½¿ç¨<strong>åºå·ï¼Sequence numberï¼seqï¼</strong> è¡¨ææ¬æ¥ææ®µç¬¬ä¸ä¸ªæ°æ®å­èçç¼å·ï¼åå§åºå·ç±åæ¹å¨ TCP è¿æ¥å»ºç«æ¶éæºçæãä½¿ç¨<strong>ç¡®è®¤å·ï¼Acknowledgment numberï¼ackï¼</strong> è¡¨ç¤ºæ¥åæ¹ææä»åéæ¹æ¥åçå­èç¼å·ã<strong>æ°æ®åç§»éï¼Data Offsetï¼</strong> é¡¾åæä¹æ¥ææ®µæ°æ®å¼å§å­èå¤çåç§»éï¼å³ TCP header çé¿åº¦ï¼ç±äºéé¡¹çå­å¨ï¼é¦é¨é¿åº¦çèå´æ¯ 20ï½60 Bytesï¼ä½æ¯è¯¥å­æ®µåªæ 4 Bitsï¼å æ­¤è¯¥å­æ®µæåºé¦é¨é¿åº¦æå¤å°ä¸ª 4 Bytesãæ¥ä¸æ¥ç 3 Bits è¢«<strong>ä¿çï¼Reservedï¼</strong> ãéåä¼è®¨è®º 9 ä¸ª<strong>æ å¿ä½ï¼Flagsï¼</strong>ã<strong>çªå£å¤§å°ï¼Window Sizeï¼</strong> å®ä¹äºæ¥åæ¹çæ¥åçªå£å¤§å°ï¼ç±æ¥åæ¹å³å®ï¼ç¶ååç¥åéæ¹ãå¨è®¡ç®<strong>æ ¡éªåï¼Checksumï¼</strong> æ¶éè¦å ä¸ä¼ªé¦é¨ï¼ä¼ªé¦é¨çåå®¹åæ¬æºç® IP å°åï¼TCP æ¥ææ®µé¿åº¦ç­ãå¦æ URG æ å¿ä½è¢«è®¾å®äºï¼é£<strong>ç´§æ¥æéï¼Urgent pointerï¼</strong> ç¨äºæç¤ºç´§æ¥æ°æ®æåä¸ä¸ªå­èå¨æ¥ææ®µæ°æ®é¨åä¸­çåç§»éãæåç 40 Bytes çç»<strong>éé¡¹ï¼Optionsï¼</strong>ã</p>\n<h3 id=\"Flags\"><a href=\"#Flags\" class=\"headerlink\" title=\"Flags\"></a>Flags</h3><ul>\n<li><strong>URG</strong>ï¼ä¸º 1 è¡¨ç¤ºæ°æ®ä¸­æç´§æ¥æ°æ®ãè¿ä¸ªæ è®°æ¯è¾å°è§ï¼å¯ä»¥æ¾å°çä¸äºåºç¨æï¼<a href=\"https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag\" target=\"_blank\" rel=\"noopener\">FTP</a>ï¼<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">Telnet</a>ï¼</li>\n<li><strong>ACK</strong>ï¼ä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­æ®µææï¼</li>\n<li><strong>PSH</strong>ï¼ä¸º 1 è¡¨ç¤ºææ¨éæ°æ®ï¼è¿ä¸ªå­æ®µä¸»è¦å®æ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">ä¸¤ä¸ªåè½</a>ï¼åéæ¹åºç¨å±æé TCP éè¦ç«å³åéæ°æ®ï¼æ¥åæ¹ TCP éè¦å°æ¶å°çæ°æ®ç«å³æäº¤ç»åºç¨å±ï¼</li>\n<li><strong>RST</strong>ï¼ä¸º 1 è¡¨ç¤ºåºç°ä¸¥éå·®éãå¯è½éè¦éç°åå»º TCP è¿æ¥ãè¿å¯ä»¥ç¨äºæç»éæ³çæ¥ææ®µåæç»è¿æ¥è¯·æ±ï¼</li>\n<li><strong>SYN</strong>ï¼ä¸º 1 è¡¨ç¤ºè¿æ¯è¿æ¥è¯·æ±ææ¯è¿æ¥æ¥åè¯·æ±ï¼ç¨äºåå»ºè¿æ¥åä½¿é¡ºåºå·åæ­¥ï¼</li>\n<li><strong>FIN</strong>ï¼ä¸º 1 è¡¨ç¤ºåéæ¹æ²¡ææ°æ®è¦ä¼ è¾äºï¼è¦æ±éæ¾è¿æ¥ï¼</li>\n</ul>\n<h2 id=\"é¶æ®µ\"><a href=\"#é¶æ®µ\" class=\"headerlink\" title=\"é¶æ®µ\"></a>é¶æ®µ</h2><p>TCP è¿æ¥å¯ä»¥åä¸ºä¸ä¸ªé¶æ®µï¼å»ºç«è¿æ¥ï¼ä¼ è¾æ°æ®ï¼ç»æ­¢è¿æ¥ãå¯ä»¥ç¨ä¸ä¸ªæéç¶ææºè¡¨ç¤ºï¼<br><img src=\"tcp_connection.png\" alt=\"å¾ 2 TCP è¿æ¥ (From: Computer Networks)&lt;br&gt;å¾ä¸­ï¼A/Bï¼è¿æ ·çæå­è¡¨ç¤ºâæ¶å°Aåæ§è¡Bï¼Aä¸Bå¯ä»¥æ¯æ å¿ä½æèæä»¤â&lt;br&gt;æ·±å®çº¿è¡¨ç¤º Client çè¡ä¸ºï¼æ·±èçº¿è¡¨ç¤º Server çè¡ä¸ºï¼æµè²çº¿è¡¨ç¤ºç¹æ®è¡ä¸º\"><br>ä¸é¢ç»åä¸ä¸ªç¨ Rust åç Echo Server ä¸æåå·¥å· Wireshark æ¥æ¼ç¤ºè¿ä¸ä¸ªè¿ç¨ãä»£ç å¦ä¸ï¼<br><figure class=\"highlight rust\"><figcaption><span>Echo Server</span><a href=\"/downloads/code/echo_server.rs\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::net::{TcpListener, TcpStream};</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::thread;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Write;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> listener = TcpListener::bind(<span class=\"string\">\"::1:9999\"</span>).unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> stream <span class=\"keyword\">in</span> listener.incoming() {</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(stream) =&gt; {</span><br><span class=\"line\">                thread::spawn(|| {</span><br><span class=\"line\">                    handle_client(stream);</span><br><span class=\"line\">                });</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(_) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">\"Error\"</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">handle_client</span></span>(<span class=\"keyword\">mut</span> stream: TcpStream) {</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> read = [<span class=\"number\">0</span>; <span class=\"number\">1024</span>];</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream.read(&amp;<span class=\"keyword\">mut</span> read) {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(n) =&gt; {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> n == <span class=\"number\">0</span> {</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                stream.write(&amp;read[<span class=\"number\">0</span>..n]).unwrap();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(err) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(err);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure><br>Echo Server å¯å¨ä¹åä½¿ç¨ telnet å·¥å·è¿æ¥è³æå¡å¨ï¼ä¸æå¡å¨äº¤äºä¸¤æ¬¡ï¼å³åæ¾ä¸¤æ¬¡å­ç¬¦ä¸²ï¼ç¶åä»éåº telnetãæå°çåæªå¾å¦ä¸ï¼<br><img src=\"wireshark.png\" alt=\"å¾ 3 Wireshark æå\"></p>\n<p>å¨ä¸é¢çè¡¨è¿°ä¸­ï¼å®¢æ·ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µååèµ·è¯·æ±çä¸æ¹ï¼æå¡ç«¯è¡¨ç¤ºå¨è¿ä¸é¶æ®µåæ¥åè¯·æ±çä¸æ¹ãå¨ TCP ä¸­ï¼æå¡ç«¯åå®¢æ·ç«¯ä¹é´å¯ä»¥è¿è¡ååéä¿¡ï¼ä»ä»¬å¯ä»¥çè§£ä¸ºå¯¹ç­çï¼å¨è¿æ¥å»ºç«åï¼å®éä¸æ²¡ææå¡ç«¯åå®¢æ·ç«¯çåºå«ã</p>\n<h3 id=\"å»ºç«è¿æ¥\"><a href=\"#å»ºç«è¿æ¥\" class=\"headerlink\" title=\"å»ºç«è¿æ¥\"></a>å»ºç«è¿æ¥</h3><p>åä¸ä¸ªåä»£è¡¨äºå»ºç«è¿æ¥çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼å¤§å¤æ°æåµä¸å°±å¦åæåæç¤ºï¼ç§°ä¸º<strong>ä¸æ¬¡æ¡æï¼3-way handshakeï¼</strong>ãå¾ 2 ä¸­è¿ç»åºäºåæ¹åæ¶æå¼è¿æ¥ä¸è¿æ¥å¤ä½è¿ä¸¤ç§æ¯è¾å°è§çææ¯ã</p>\n<ol>\n<li>å®¢æ·ç«¯åéç»æå¡ç«¯ä¸ä¸ª <strong>SYN</strong> æ¥æï¼ç¨ä»¥åç¥æå¡ç«¯åå§åºå·ä¸º 0ï¼æ­¤å¤ç Seq ç»è¿ Wireshark çå¤çï¼åæäºç¸å¯¹å¼ï¼ï¼ç¶åå®¢æ·ç«¯è¿å¥ <strong><em>SYN_SENT</em></strong> ç¶æã</li>\n<li>æå¡å¨æ¶å° 1 ä¸­æ¥æåï¼åç»å®¢æ·ç«¯ä¸ä¸ª <strong>SYN + ACK</strong> æ¥æï¼åç¥å®¢æ·ç«¯åå§åºå·ä¸º 0ï¼ä¸æ¥ä¸æ¥ææä»å®¢æ·ç«¯æ¶å°çåºå· Ack ä¸º 1ãæå¡ç«¯è¿å¥ <strong><em>SYN_RCVD</em></strong> ç¶æãå¯è§ <strong>SYN æ¥ææ¶èäºä¸ä¸ªåºå·</strong>ã</li>\n<li>å®¢æ·ç«¯ç»æå¡ç«¯åå¤ <strong>ACK</strong> æ¥æï¼è¿å¥ <strong><em>ESTABLISHED</em></strong> ç¶æï¼æå¡ç«¯å¨æ¶å°è¿ä¸ªæ¥æè¿æ¥å»ºç«å®æãå¯è§ <strong>ACK æ¥æå¨ä¸æºå¸¦æ°æ®çæåµä¸ä¸æ¶èåºå·</strong>ã</li>\n</ol>\n<h3 id=\"ä¼ è¾æ°æ®\"><a href=\"#ä¼ è¾æ°æ®\" class=\"headerlink\" title=\"ä¼ è¾æ°æ®\"></a>ä¼ è¾æ°æ®</h3><p>å¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åå«å±ç¤ºäºä¸¤æ¬¡äº¤äºè¿ç¨ãä»¥ç¬¬äºæ¬¡äº¤äºä¸ºä¾ï¼</p>\n<ol>\n<li>P72 ä¸­ï¼å®¢æ·ç«¯å°æ³è¦åæ¾å­ç¬¦ä¸²åéç»æå¡ç«¯ï¼åç¥æå¡å¨è¿ä¸ªæ¥ææ®µçæ°æ®é¦å­èåºå·ä¸º 8ï¼å¹¶ä¸å¸æä»æå¡ç«¯æ¶å°çä¸ä¸ä¸ªåºå·æ¯ 8ã</li>\n<li>æå¡ç«¯å°åæ¾çå­ç¬¦ä¸²ä¸å¯¹ P72 çç¡®è®¤ä¸èµ·åéç»å®¢æ·ç«¯ãP72 çé¿åº¦ä¸º 9ï¼å æ­¤æ¥ææ®µä¸­æ°æ®çåºå·èå´ä¸º [8,17)ï¼å æ­¤å¨ P73 ä¸­ Ack ä¸º 17ã</li>\n<li>å®¢æ·ç«¯ç¡®è®¤ P73ã</li>\n</ol>\n<p>éè¦æ³¨æçæ¯ï¼è¿ä¸¤æ¬¡äº¤äºææåºå«ï¼ç¬¬ä¸æ¬¡äº¤äºæ¶ï¼æå¡ç«¯åè¿åäºä¸ä¸ªç¡®è®¤ç»å®¢æ·ç«¯ï¼ç¶ååé¢å¤åéä¸æ¡æºå¸¦åæ¾åå®¹çæ¥ææ®µãä½æ¯ç¬¬äºæ¬¡äº¤äºæ¶çç¥äºåç¬çç¡®è®¤ã</p>\n<h3 id=\"ç»æ­¢è¿æ¥\"><a href=\"#ç»æ­¢è¿æ¥\" class=\"headerlink\" title=\"ç»æ­¢è¿æ¥\"></a>ç»æ­¢è¿æ¥</h3><p>æ ¹æ®âå¹¿å¤§åä¸»âåä½çæç« ä¸<a href=\"https://www.zhihu.com/question/50646354\" target=\"_blank\" rel=\"noopener\">é®ç­ç½ç«çè®¨è®º</a>ä»¥ååç§é¢ç»ï¼åºæ¬ä¸è´è®¤ä¸ºï¼ç»æ­¢è¿æ¥éå¸¸è¢«æä¸º<strong>åæ¬¡æ¥æï¼4-way terminationï¼</strong>ï¼å³éä¿¡åæ¹ä¼æåæ¬¡äº¤äºï¼ä½æ¯å¦å¾ 2 æç¤ºï¼ä¹å­å¨<strong>ä¸æ¬¡æ¥æ</strong>çå¯è½æ§ï¼ä¸ææ¬å°çå¤æ¬¡æåä¹å¦å¾ 3 ä¸è´ââåä¸ºä¸æ¬¡æ¥æï¼ä¸æ ä¸ä¾å¤ãä¸é¢å¯¹åæ¬¡æ¥æè¿è¡åæï¼ä¸æ¬¡æ¥æå¯ä»¥è¢«å¶æ¦æ¬ï¼</p>\n<ol>\n<li>å®¢æ·ç«¯åèµ·ç»æ­¢è¿æ¥ï¼ååºä¸ä¸ª <strong>FIN</strong> æ¥æç»æå¡ç«¯ï¼åè®¾è¯¥æ¥æç Seq ä¸º Xï¼Ack ä¸º Yãç¶åå®¢æ·ç«¯è¿å¥ <strong><em>FIN_WAIT1</em></strong> ç¶æï¼é¤éä¼  FIN æ¥æä¸åé ACK ç¡®è®¤ä¹å¤ï¼ä¸ååéåºç¨æ°æ®ç»æå¡ç«¯ã</li>\n<li>æå¡ç«¯æ¶å° FIN æ¥ææ®µåååå¤ä¸ä¸ª <strong>ACK</strong> æ¥æï¼è¿å¥ <strong><em>CLOSE_WAIT</em></strong> ç¶æï¼è¯¥æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã</li>\n<li>å®¢æ·ç«¯å¨æ¶å° FIN ç ACK ä¹åè¿å¥ <strong><em>FIN_WAIT2</em></strong> ç¶æãæ­¤æ¶æå¡ç«¯è¿å¯ä»¥ç»§ç»­å°æªåéå®çåºç¨æ°æ®åéç»å®¢æ·ç«¯ã</li>\n<li>æå¡ç«¯åéå®æ°æ®ååéä¸æ¡ <strong>FIN</strong> æ¥æï¼è¿å¥ <strong><em>LAST_ACK</em></strong> ç¶æï¼è¯¥æ¥æç Seq ä¸º Y+Kï¼Ack ä¸º X+1ã</li>\n<li>å®¢æ·ç«¯æ¶å°æå¡ç«¯ç FIN åï¼åéæåç <strong>ACK</strong> æ¥æç»æå¡å¨ï¼ç¶åè¿å¥ <strong><em>TIME_WAIT</em></strong> ç¶æãå¦æå¨ 2MSLï¼æå¤§æ¥ææ®µå¯¿å½ï¼éå¸¸ä¸º30ï½60sï¼åå®¢æ·ç«¯æ²¡åæ¬¡æ¶å° FIN æ¥æï¼åè¿å¥ <strong><em>CLOSED</em></strong> ç¶æï¼å¦åéå ACK æ¥æè¿è¡éè¯ã</li>\n<li>æå¡ç«¯å¨æ¶å° ACK æ¥æåè¿å¥ <strong><em>CLOSED</em></strong> ç¶æã</li>\n</ol>\n<p>ä¸æ¬¡æ¥æè¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åå¹¶ä¸ºä¸æ­¥ï¼å³åæ¶åéå¯¹å®¢æ·ç«¯ FIN ç ACK æ¥æä¸ æå¡ç«¯èªå·±ç FIN æ¥æãè¿æ¡ <strong>FIN+ACK</strong> æ¥æç Seq ä¸º Yï¼Ack ä¸º X+1ã</p>\n<p>è³äºå¨ä»ä¹ææ¯ä¸åºç°ä¸æ¬¡æ¡ææèåæ¬¡æ¡æï¼å¤§å¤æ°çè§ç¹è®¤ä¸ºåæ¶å° FIN æ¥æçä¸æ¹è¿éè¦åä¸å±åºç¨è¯¢é®æ¯å¦ä»ç¶ææ°æ®éè¦åéï¼å ä¸ºè¦ç­å¾ä¸å±çåå¤ï¼æä»¥âä¸ºä½ä¸æ©ç¹æå¯¹ FIN ç ACK ååºå»å¢ï¼ï¼âèä¸ç«å³ Ack è½é²æ­¢å¯¹æ¹éä¼  FINãä½æ¯ææ²¡æå­å¨ä¸éè¦è¯¢é®ä¸å±æèä¸éè¦ç«å³åå¤ Ack çå¯è½ï¼å°±å¦åä¼ è¾æ°æ®åºç°çæåµä¸æ ·ï¼è¿äºåºè¯¥ä¸ TCP çå·ä½å®ç°ç¸å³ï¼ç®åè½åä¸ç²¾åæéï¼è¿æå¾å¯¹ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c\" target=\"_blank\" rel=\"noopener\">Linux TCP å®ç°æºç </a>è¿è¡éè¯»ã</p>\n<h2 id=\"æ»å¨çªå£\"><a href=\"#æ»å¨çªå£\" class=\"headerlink\" title=\"æ»å¨çªå£\"></a>æ»å¨çªå£</h2><p>æ»å¨çªå£æ¯ TCP ä¸­ç¨äºå®ç°è¯¸å¦ ACK ç¡®è®¤ãæµéæ§å¶ãæ¥å¡æ§å¶çæ¿è½½ç»æãå¦å¾æç¤º:<br><img src=\"sliding_window.png\" alt=\"å¾ 4 æ»å¨çªå£\"><br>åå° TCP çä½æ¯ç®åçååéä¿¡ï¼ååéæ¹æä¸ä¸ªåéçªå£ï¼æ¥æ¶æ¹æä¸ä¸ªæ¥æ¶çªå£ãæ­£å¦å¾ä¸­æç¤ºï¼ä¼ è¾çæ¯æ¥ææ®µï¼çªå£å¤§å°çåä½æ¯å­èãä¸¤ä¸ªçªå£ä¸­<strong>ç½è²åºå</strong>ä¸ºç©ºç½ä½ç½®ï¼ç­å¾è¢«åºç¨å±æèç½ç»å±å¡«æ»¡ï¼<strong>ç°è²åºå</strong>æ¯å·²ç»åéä½æ¯è¿æ²¡ææ¥åå°ç¡®è®¤çå­èï¼<strong>ç²è²åºå</strong>å¨åéçªå£ä¸­è¡¨ç¤ºç­å¾è¢«åéçå­èï¼å¨æ¥æ¶çªå£æ±æ»è¡¨ç¤ºç­å¾äº¤ä»çå­èã<br>åéçªå£çå¤§å°ä¸ºæ¥åæ¹éè¿é¦é¨ä¸­çªå£å¤§å°å­æ®µåç¥çæ¥æ¶çªå£å¤§å° rwnd åä¹åä¼è®²å°çæ¥å¡çªå£çå¤§å° cwnd ä¸¤èä¸­çè¾å°å¼ï¼å³ <code>min(rwnd , cwnd)</code>ãæ¥æ¶çªå£å¤§å°æ¯æ¥æ¶æ¹å¯ç¨ç¼å­ç©ºé´å¤§å°ï¼ä¸º <code>rwnd = ç¼å­å¤§å° - åå¤äº¤ä»çå­èæ°</code>ã</p>\n<h2 id=\"æµéæ§å¶\"><a href=\"#æµéæ§å¶\" class=\"headerlink\" title=\"æµéæ§å¶\"></a>æµéæ§å¶</h2><p>æµéæ§å¶ç¨äºå¹³è¡¡çäº§èäº§çæ°æ®ä¸æ¶è´¹èæ¶èæ°æ®çéåº¦ãTCP ä¸­çæµéæ§å¶å®ç°çä¸»è¦éå¾æ¯ä¸æ­è°æ´åéçªå£çå¤§å°å®ç°ãåé TCP ä¸æ¦åç°åéåéçªå£æ»¡äºå°±ä¼å¯¹åéè¿ç¨è¿è¡åé¦ãæ¥åæ¹æ ¹æ®ä¹åä»åéæ¹æ¶å°çæ°æ®éåæå¡å¨å·²ç»æ¶èçæ°æ®éå¾å°èªèº«æ¥æ¶çªå£çå¤§å°ï¼å°è¿ä¸ªå¼åç¥åéæ¹ï¼åéæ¹æ ¹æ®æ¶å°ççªå£å¤§å°è°æ´èªèº«çªå£å¤§å°ã<br>è¿ææ­£å¯¹éä¿¡åæ¹äº§çæ°æ®å°æèæ¶è´¹æ°æ®æ¢äº§çç³æ¶çªå£ç»¼åå¾æ¶ï¼æå¶ä»æ¹é¢çæµéæ§å¶ãå½åéæ¹æ°æ®éç¸å¯¹äºé¦é¨å°å¾å¤çæ¥æå¾å¤æ¶ï¼å¯ä»¥ä½¿ç¨ <strong>Nagle ç®æ³</strong>åå°è¿ç§å°æ¥æéãå½æ¥åæ¹æ¶èæ°æ®å¾æ¢æ¶ï¼æ¯æ¬¡åç¥åéæ¹ççªå£å¤§å°ä¼æ¯è¾å°ï¼ä¹å¯è½äº§çå¾å¤å°æ¥æï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ <strong>Clark è§£å³æ¹æ³</strong>æèè¿è¡<strong>æ¨è¿ç¡®è®¤</strong>ãå³äºè¿å ç§æ¹æ¡çåæåå·ä½çä½¿ç¨ææ¯å¯ä»¥åè dog520 å¤§ç¥çè¿ç¯æç« ââ<a href=\"https://blog.csdn.net/dog250/article/details/21303679\" target=\"_blank\" rel=\"noopener\">åæ¬¡è°è° TCP ç Nagle ç®æ³ä¸ TCP_CORK éé¡¹</a>ã</p>\n<h2 id=\"å·®éæ§å¶\"><a href=\"#å·®éæ§å¶\" class=\"headerlink\" title=\"å·®éæ§å¶\"></a>å·®éæ§å¶</h2><p>å·®éæ§å¶ç¨äºæè¿° TCP å¨åéæèæ¥åå°æ¥ææ®µåçå¼å¸¸æ¶çè¡ä¸ºï¼å¶ä¸»è¦è¡¨ç°å¨å¦ä¸å ä¸ªæ¹é¢ï¼</p>\n<ol>\n<li><strong>æ ¡éªå</strong>ï¼å¨æ¥åæ¹ï¼å¦ææ¶å°çæ¥ææ®µæªéè¿æ ¡éªåæ ¡éªï¼åç«å³ä¸¢å¼ï¼åä¹ï¼åéè¿<strong>ç¡®è®¤è§å</strong>ï¼ä¸é¢é©¬ä¸æåï¼è¿è¡ç¡®è®¤ï¼</li>\n<li><strong>éä¼ </strong>ï¼å¨åéæ¹ï¼å¦æä¸ä¸ªæ¥ææ®µéä¼ è¶æ¶è®¡æ¶å¨ï¼RTOï¼è¶æ¶ï¼å³å¨ RTO æ¶é´ä¹åä»ç¶æªæ¶å° ACKï¼åç«å³éä¼ æªè¢«ç¡®è®¤çæå°çæ¥ææ®µï¼å¦ææ¶å°åä¸ªç¸åçç ACK ï¼åç«å³éä¼ ä¸ä¸ä¸ªæ¥ææ®µï¼</li>\n</ol>\n<h3 id=\"ç¡®è®¤è§å\"><a href=\"#ç¡®è®¤è§å\" class=\"headerlink\" title=\"ç¡®è®¤è§å\"></a>ç¡®è®¤è§å</h3><ol>\n<li>å½æ¥åæ¹ååéæ¹åéæ°æ®æ¥ææ®µæ¶ï¼å¿é¡»<strong>æå¸¦</strong> ACKï¼</li>\n<li>å½æ¥åæ¹æ²¡ææ°æ®è¦åéæ¶ï¼ä½æ¯æ¶å°ä¸ä¸ª<strong>æåºå°è¾¾</strong>çæ¥æï¼åæ¶åä¸ä¸ªæ¥ææ®µä¹å·²ç»ç¡®è®¤è¿äºï¼é£ä¹æ¥æ¶æ¹å°±æ¨è¿åéç¡®è®¤æ¥ææ®µï¼ç´å°å¦ä¸ä¸ªæ¥ææ®µå°è¾¾æèå»¶è¿ä¸æ®µæ¶é´ä»¥åå° ACK æ¥æéï¼</li>\n<li>å½æææçæ¥ææ®µå°è¾¾ï¼ä¸åä¸ä¸ª<strong>æåºå°è¾¾</strong>çæ¥æè¿æªè¢«ç¡®è®¤ï¼åç«å³ ACKï¼ACK çåºå·ä»ç¶æ¯ä¸ä¸ä¸ªæ­£å¸¸ææçåºå·ï¼ä¸åï¼ï¼</li>\n<li>å½åºå·æ¯ææçå¤§çæ¥ææ®µï¼<strong>å¤±åº</strong>æ¥ææ®µï¼å°è¾¾ï¼åç«å³ ACKï¼ä¸å­å¨è¯¥æ¥ææ®µï¼</li>\n<li>å½<strong>ä¸¢å¤±</strong>çæ¥ææ®µå°è¾¾æ¶ï¼åç«å³ ACKï¼</li>\n<li>å½<strong>éå¤</strong>çæ¥ææ®µå°è¾¾æ¶ï¼åä¸¢å¼ï¼ä¸ç«å³ ACKï¼</li>\n</ol>\n<h2 id=\"æ¥å¡æ§å¶\"><a href=\"#æ¥å¡æ§å¶\" class=\"headerlink\" title=\"æ¥å¡æ§å¶\"></a>æ¥å¡æ§å¶</h2><p>æ¥å¡æ§å¶æ¯ä¸ºäºé¿åå ä¸ºç½ç»åéå¯¼è´ç½ç»ä¸è½æç§åéæ¹äº§ççæ°æ®çéåº¦å°æ¥ææ®µäº¤ä»ç»æ¥åæ¹ãä¸æµéæ§å¶èå¯çå¯¹è±¡æ¯éä¿¡åæ¹ä¸åï¼æ¥å¡æ§å¶çèå¯å¯¹è±¡æ¯éä¿¡åæ¹é´çç½ç»ãæ¥å¡æ§å¶çæ¹å¼è¡¨ç°å¨åéæ¹çæ¥å¡çªå£çååï¼ä»èæ§å¶åéæ¹çæ°æ®åéå¿«æ¢ãTCP æåä½¿ç¨çæ¥å¡ç­ç¥ç§°ä¸º <strong>TCP Tahoe and Reno</strong>ã</p>\n<h3 id=\"Tahoe-and-Reno\"><a href=\"#Tahoe-and-Reno\" class=\"headerlink\" title=\"Tahoe and Reno\"></a>Tahoe and Reno</h3><p>è¿ä¸ªæ¥å¡ç­ç¥ä¸»è¦åä¸ºæ¢å¯å¨ãæ¥å¡é¿åãæ¥å¡æ£æµä¸ä¸ªé¶æ®µã</p>\n<h4 id=\"æ¢å¯å¨\"><a href=\"#æ¢å¯å¨\" class=\"headerlink\" title=\"æ¢å¯å¨\"></a>æ¢å¯å¨</h4><p>åè®¾æ¥æ¶çªå£å¤§å°è¿å¤§äºæ¥å¡çªå£ï¼ä¸ä¸èèå»¶è¿ç¡®è®¤ãæ¥å¡çªå£å¤§å°ä»ä¸ä¸ªæå¤§æ¥æé¿åº¦ MSS ï¼è¿æ¥å»ºç«æ¶éè¿ TCP éé¡¹åç¥ï¼å¼å§ï¼ä¹åæ¯å½æä¸ä¸ªæ¥ææ®µè¢«ç¡®è®¤ï¼æ¥å¡çªå£å°±å¢å¤§ä¸ä¸ª MSSãå¨è¿æ ·çç­ç¥ä¸ï¼æ¢å¯å¨é¶æ®µçæ¥å¡çªå£å¤§å°åææ°å¢é¿ãå³ä» <code>1 -&gt; 2 -&gt; 4 -&gt; 8</code>ãå½å°è¾¾æ¢å¯å¨é¨éæ¶ï¼å°±è¿å¥æ¥å¡é¿åé¶æ®µã</p>\n<h4 id=\"æ¥å¡é¿å\"><a href=\"#æ¥å¡é¿å\" class=\"headerlink\" title=\"æ¥å¡é¿å\"></a>æ¥å¡é¿å</h4><p>æ¥å¡é¿åé¶æ®µæ¥å¡çªå£å¤§å°ç»§ç»­å¢å ï¼ä½æ¯éåº¦æ¾æ¢ï¼æ¹æå½æ´ä¸ªçªå£å¤§å°çæ¥ææ®µé½è¢«ç¡®è®¤åï¼çªå£å¤§å°æå¢å ä¸ä¸ª MSSãè¡¨ç°ä¸º <code>8 -&gt; 9 -&gt; 10 -&gt; 11</code>ï¼åç°çº¿æ§å¢é¿ã</p>\n<h4 id=\"æ¥å¡æ£æµ\"><a href=\"#æ¥å¡æ£æµ\" class=\"headerlink\" title=\"æ¥å¡æ£æµ\"></a>æ¥å¡æ£æµ</h4><p>å¦ææ¥å¡åçäºï¼å ä¸ºåçå¨ç½ç»ä¸­è·¯ç±å¨åºç°ä¸¢åç°è±¡ï¼å¨æ¥åæ¹å¤çè¡¨ç°ä¸ºåºç°ä»¥ä¸ä¸¤ç§æåµï¼å¹¶ååºå¯¹åºçååºï¼</p>\n<ol>\n<li><p>RTO è®¡æ¶å¨è¶æ¶ãè¿è¯´æç½ç»æ¥å¡çå¯è½æ§è¾å¤§ï¼TCP ååºè¾å¼ºççååºï¼<br> a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼<br> b. æ cwnd éæ°è®¾ç½®ä¸º 1 MSSï¼<br> c. éæ°è¿å¥æ¢å¯å¨é¶æ®µï¼</p>\n</li>\n<li><p>æ¶å°åä¸ªç¸åç ACKï¼è¯´æåºç°æ¥å¡çå¯è½æ§è¾å°ï¼ä½æ¯åºç°äºä¸¢åï¼TCP ååºè¾å¼±çååºï¼Reno ç®æ³è¡¨ç°ä¸ºå¿«æ¢å¤ï¼Fast recoveryï¼ï¼<br> a. ææ¢å¯å¨é¨éå¼è°æ´ä¸ºå½åçªå£å¤§å°çä¸åï¼<br> b. æ cwnd éæ°è®¾ç½®ä¸ºæ¢å¯å¨é¨éå¼ï¼<br> c. éæ°è¿å¥æ¥å¡é¿åé¶æ®µï¼</p>\n</li>\n</ol>\n<p>å¾ç¤ºå¦ä¸ï¼<br><img src=\"congestion_control_example.png\" alt=\"æ¥å¡æ§å¶ç¤ºä¾\"><br>Tahoe ç®æ³ä¸ Reno ï¼Tahoe çæ¹è¿çæ¬ï¼çåºå«å¨äºæ¶å°åä¸ªç¸å ACK æ¶ï¼Tahoe ç®æ³çç­ç¥å RTO è®¡æ¶å¨è¶æ¶æ¶ä¸è´ã</p>\n<h3 id=\"å¶ä»æ¥å¡ç­ç¥\"><a href=\"#å¶ä»æ¥å¡ç­ç¥\" class=\"headerlink\" title=\"å¶ä»æ¥å¡ç­ç¥\"></a>å¶ä»æ¥å¡ç­ç¥</h3><p>æ¥å¡æ§å¶ç­ç¥åªéè¦å¨åéæ¹å®ç°å³å¯ï¼ä¸éè¦æ¥åæ¹çåä¸ï¼å æ­¤å¯ä»¥ä»å¨åéæ¹é¨ç½²ä¸å¥ç®æ³ãç°å¨ TCP ç½ç»ä¸çç®æ³ä¹å¨ä¸æ­<a href=\"https://en.wikipedia.org/wiki/TCP_congestion_control\" target=\"_blank\" rel=\"noopener\">æ¹è¿</a>ï¼æ¶ç°åºè¯¸å¦ <a href=\"http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf\" target=\"_blank\" rel=\"noopener\"><strong>TCP CUBIC</strong></a>ã<a href=\"https://ai.google/research/pubs/pub45646\" target=\"_blank\" rel=\"noopener\"><strong>TCP BBR</strong></a> è¿æ ·çç®æ³ã</p>\n<h2 id=\"TCP-ä¸­çè®¡æ¶å¨\"><a href=\"#TCP-ä¸­çè®¡æ¶å¨\" class=\"headerlink\" title=\"TCP ä¸­çè®¡æ¶å¨\"></a>TCP ä¸­çè®¡æ¶å¨</h2><h3 id=\"éä¼ è®¡æ¶å¨\"><a href=\"#éä¼ è®¡æ¶å¨\" class=\"headerlink\" title=\"éä¼ è®¡æ¶å¨\"></a>éä¼ è®¡æ¶å¨</h3><p>éä¼ è®¡æ¶å¨çè¶æ¶æ¶é´ä¸º RTOï¼RTO ä¸»è¦æ ¹æ®æµéæå¾çæ¥ææ®µå¾è¿æ¶é´ RTTmè®¡ç®èæ¥ï¼è®¡ç®è¿ç¨å¦ä¸ï¼</p>\n<p>é¦åè®¡ç®å¹³æ» RTTï¼å³RTTsï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTs = RTTm // ç¬¬ä¸æ¬¡æµé</span><br><span class=\"line\">RTTs = (1 - Î±)RTTs + Î±RTTm // éåçæµé</span><br></pre></td></tr></table></figure></p>\n<p>ç¶åè®¡ç® RTT çåå·® RTTdï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTd = RTTm / 2 // ç¬¬ä¸æ¬¡æµé</span><br><span class=\"line\">RTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éåçæµé</span><br></pre></td></tr></table></figure></p>\n<p>éä¼ è¶æ¶ RTO çè®¡ç®å¦ä¸ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTO = 6s // åå§å¼</span><br><span class=\"line\">RTO = RTTs + 4RTTd // ç¬¬ä¸æ¬¡æµéå</span><br></pre></td></tr></table></figure></p>\n<p>ä»»ææ¶å»åªæä¸ä¸ª RTT å¨è¿è¡æµéï¼å½éä¼ åçæ¶ä¼å½±å RTT çæµéï¼æ ¹æ® <strong>Karn ç®æ³</strong>ï¼TCP å¿½ç¥éä¼ æ¥æç RTTï¼èå¯¹äºéä¼ çæ¥æï¼RTO å¼ä¸ºåæ¥æçä¸¤åï¼å¦æåçç¬¬äºæ¬¡éä¼ ï¼åä¸ºååï¼ä»¥æ­¤ç±»æ¨ã</p>\n<h3 id=\"æç»­è®¡æ¶å¨\"><a href=\"#æç»­è®¡æ¶å¨\" class=\"headerlink\" title=\"æç»­è®¡æ¶å¨\"></a>æç»­è®¡æ¶å¨</h3><p>å½æ¥åæ¹åéçªå£å¼ä¸º 0 çæ¥ææ®µä¹åï¼åæ¥å ä¸ºæ¥æ¶çªå£å¢å éè¦éåæ¥çªå£ä¸ºé 0ï¼ä½æ¯éåç ACK ä¸¢å¤±ï¼è¿ä¼å¯¼è´åéæ¹ä¸ç´ç­å¾é 0 çªå£éåï¼å¯¼è´æ­»éãæç»­è®¡æ¶å¨å°±æ¯æ¥åæ¹å¨æ¶å° 0 çªå£éååå¯ç¨ï¼å¦æè¶æ¶ååéæ¢æµæ¥æï¼ä¿ä½¿æ¥åæ¹éä¼  ACKã</p>\n<h3 id=\"Keep-Alive-è®¡æ¶å¨\"><a href=\"#Keep-Alive-è®¡æ¶å¨\" class=\"headerlink\" title=\"Keep-Alive è®¡æ¶å¨\"></a>Keep-Alive è®¡æ¶å¨</h3><p>Keep-Alive è®¡æ¶å¨ç¨äºé²æ­¢ TCP è¿æ¥é¿æ¶é´ç©ºé²ï¼æ¯å½æ¶å°å¯¹æ¹çæ¥ææ®µï¼è¿ä¸ªè®¡æ¶å¨å°±å¤ä½ãè¿ä¸ªè®¡æ¶å¨çè¶æ¶æ¶é´éå¸¸å¯ä»¥éè¿æ¥å£è¿è¡è®¾å®ã</p>\n<h3 id=\"Time-Wait-è®¡æ¶å¨\"><a href=\"#Time-Wait-è®¡æ¶å¨\" class=\"headerlink\" title=\"Time-Wait è®¡æ¶å¨\"></a>Time-Wait è®¡æ¶å¨</h3><p>Time-Wait è®¡æ¶å¨å¯¹æåç FIN è¿è¡ç¡®è®¤æ¶å¯å¨çè¶æ¶è®¡æ¶å¨ãå¦æå¨æ¶å¸¸ä¸º 2MSL çè®¡æ¶å¨è¶æ¶ååæ¬¡æ¶å° FINï¼åéä¼  ACKï¼å¦åè¿æ¥å½»åºå³é­ã</p>\n<h2 id=\"ä¼ è¾å±çæªæ¥\"><a href=\"#ä¼ è¾å±çæªæ¥\" class=\"headerlink\" title=\"ä¼ è¾å±çæªæ¥\"></a>ä¼ è¾å±ç<a href=\"https://blog.apnic.net/2017/12/12/internet-protocols-changing/\" target=\"_blank\" rel=\"noopener\">æªæ¥</a></h2><p><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"noopener\">QIUC</a> äºè§£ä¸ä¸ä¸ï¼</p>\n<h2 id=\"åèèµæ\"><a href=\"#åèèµæ\" class=\"headerlink\" title=\"åèèµæ\"></a>åèèµæ</h2><ol>\n<li><a href=\"https://book.douban.com/subject/5386194/\" target=\"_blank\" rel=\"noopener\">TCP/IP åè®®æ ç¬¬åç</a></li>\n<li><a href=\"https://book.douban.com/subject/5344443/\" target=\"_blank\" rel=\"noopener\">Andrew S.Tanenbaum - Computer Networks 5th</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\" target=\"_blank\" rel=\"noopener\">WikiPedia - Transmission Control Protocol</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/TCP_congestion_contro\" target=\"_blank\" rel=\"noopener\">WikiPedia - TCP congestion control</a></li>\n<li><a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">TCP Flags: PSH and URG</a></li>\n<li><a href=\"https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf\" target=\"_blank\" rel=\"noopener\">KTH - Internetworking Lecture 4</a></li>\n<li><a href=\"https://blog.csdn.net/dog250/article/details/81256550\" target=\"_blank\" rel=\"noopener\">ä¸ä¸ª TCP FIN_WAIT2 ç¶æç»èå¼åçææ¨</a></li>\n</ol>"},{"title":"ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£","keywords":[],"date":"2018-08-04T09:05:00.000Z","_content":"å¨ {% post_link tcp %}ä¸­åé¡¾äº TCPï¼èè¿ç¯æç« ä¸»è¦è®²ç¨äº BT ç½ç»çåºäº UDP çè¿è¾å±åè®® ÂµTPï¼åæ¶é¡ºä¾¿åé¡¾ UDPãä¸é¢çåå®¹æ´å¤æ¯åºäºå¯¹ [BEP29](http://www.bittorrent.org/beps/bep_0029.html) ï¼BitTorrent ç 29 å·ææ¡ï¼æèç´ç¿»ä¸ºå¢å¼ºå»ºè®®ï¼ç±»ä¼¼çæ JEPï¼PEPï¼ççè§£ã\n## åå­æ¢ç©¶\nââÂµTP çä¸»è¦ææ¡£ BEP29 çåå»ºäº 2009 å¹´ï¼å§ä¸è®¤ä¸ºè¿ä¹æ¯è®¾è®¡å®æçå¤§è´æ¶é´ï¼ÂµTP å¨ uTorrent ç 1.8 ä¸­é¦æ¬¡å å¥ï¼2009 å¹´ï¼è¿ä¸ªäºå®ä¹ä½è¯äºè¿ç¹ãå®çè®¾è®¡èåæ¬ï¼\n - [Ludvig Strigeus](https://en.wikipedia.org/wiki/Ludvig_Strigeus)ï¼Î¼Torrent ä½èï¼BitTorrent å¬å¸ 2006 å¹´æ¶è´­ Î¼Torrentï¼ç®åå¨ Spotify å·¥ä½ï¼\n - Greg Hazel\n - [Stanislav Shalunov](https://www.linkedin.com/in/shalunov)ï¼ÂµTP ä¸­çæ¥å¡ç®æ³ [LEDBAT](https://tools.ietf.org/html/rfc6817) ä¸»è¦ä½èï¼åæ¥è¿åé äºå¯ä»¥è±ç¦»ç°æèçªç½ç»ä½¿ç¨ç IM åºç¨ [FireChat](https://www.opengarden.com/firechat.html) ââ å®è¢«å¤æ¬¡ç¨å°âå ä¸­âè¿æ ·çå¬æ°è¿å¨ä¸­ï¼\n - Arvid Norbergï¼libtorrent å¼åèï¼ç®åå¨ [Blockstream](https://blockstream.com/) å·¥ä½ï¼\n - Bram Cohenï¼BitTorrent ä½èï¼\n\n## è®¾è®¡åå \nââå¨è¿å»å¤å¹´åï¼å¦æä½¿ç¨ BT è¿è¡ä¸è½½ç­é¨èµæºçè¯å¯ä»¥æåå°å°éåº¦é£å¿«ï¼ä½æ¯åæ¶å¸¦æ¥çé®é¢å°±æ¯å¦ææ³è¦åæ¶çå¨çº¿è§é¢å°±ä¼å¸¦æ¥å¡é¡¿ãé®é¢å¨äº DSL å modem çå¾å¾æä¸ä¸ªåå®ä»¬çåééçä¸ææ¯ä¾çåéç¼å²åºï¼ä¸ææ¯ä¾å°å¯ä»¥å®¹çº³å ç§éçæ°æ®éãè BT å¾å¾ä¼ä¸è®¸å¤ peer å»ºç« TCP è¿æ¥ï¼å¨ TCP å°å¸¦å®½ååå°åéå°æ¯ä¸ªè¿æ¥çåæä¸ï¼BT å°±å ç¨äºè¾å¤çå¸¦å®½ï¼ä½æ¯å¶ä»è¯¸å¦æµè§ç½é¡µãå³æ¶éè®¯è¿äºåºæ¯çä¼åçº§å®éä¸åºè¯¥è¦æ¯ BT ä¼ è¾æ´é«äºï¼ä½æ¯å ä¸º BT å ç©çå±çè¿ç§ç¹æ§å¯¼è´äºå¶ä»æå¡æå»¶è¿ï¼å½±åäºä½¿ç¨ BT æ¶å¶ä»æå¡çä½éªã\nââÂµTP éè¿å° modem çç¼å²éåçå¤§å°ä½ä¸ºä¸ä¸ªæ§å¶å å­æ¥è°æ´åééçï¼å½éåè¿å¤§æ¶ï¼å°ä¼æ¾æ¢åééåº¦ãè¿ç§ç­ç¥ä½¿å¾ BT å¨æ²¡æç«äºçæåµä¸å¯ä»¥ååå©ç¨ä¸ä¼ å¸¦å®½ï¼å¨æå¤§éå¶ä»æµéçæåµä¸åæ¾æ¢åééçã\nââä¸è¿°æ¶ Bittorrent ææ¡£ä¸­çè¯´æ³ï¼ä½æ¯å®éä¸ ÂµTP æ¯åºäºåçå»¶æ¶çï¼èä¸æ¯åºäºéåå¤§å°çãèä¸ ÂµTP å·ä½å¯¹æ¥å¡ç®æ³ LEDBAT çå®ç°æä¸å¨ IETF äºèç½èæ¡ [RFC 6817](https://tools.ietf.org/html/rfc6817) ä¸­çæè¿°ææåºå«ï¼è¿éçå®ç°æ C++ çæ¬ç [libutp](https://github.com/bittorrent/libutp)ï¼åä¸ªçæ¬çå®ç°ä¸å®å¨ä¸è´ï¼ã\n\n## UDP å ÂµTP é¦é¨\nââä¸ºäºæ¹ä¾¿ä¸ TCP åç®åçå¯¹æ¯ï¼æ UDP çé¦é¨ï¼ååä¸ªå­èï¼ä¸ ÂµTP çé¦é¨ï¼å©ä½é¨åï¼æ¾å¨äºä¸ä¸ªå¾ä¸­ç¤ºæãä» UDP é¦é¨å­æ®µæ°éçå¯ä»¥åç° UDP åè®®ç¸å¯¹ TCP åè®®æ¯å¦æ­¤ç®åï¼ä»¥è³äºæä»¬wå¯ä»¥å° TCP åè®®çææ¯ç±»ä¼¼ ÂµTP åè®®ä¸æ ·çåºäº UDP åè®®çè¿è¾å±åè®®ã\n![UDP Header And ÂµTP Header](udp_utp_header.png)\n\n### UDP é¦é¨\n - **æº / ç®ç«¯å£ï¼Source / Destination portï¼**ï¼ç¨äºç¡®è®¤éä¿¡è¿ç¨åæ¹ãæºç«¯å£æ¯å¯éçï¼å¦æè®¾ç½®äºæºç«¯å£ï¼åæ¥æ¶æ¹å°å¶è§ä¸ºåå¤ç«¯å£ãå¦æä¸éè¦åå¤å°±ä¸éè¦è®¾ç½®ï¼\n - **æ»é¿åº¦ï¼Lengthï¼**ï¼å®ä¹äº UDP ç¨æ·æ°æ®æ¥çæ»é¿åº¦ï¼åæ¬é¦é¨åæ°æ®ãTCP é¦é¨ä¸­æ¯æ²¡ææè°âæ¥ææ®µæ»é¿åº¦âçå­æ®µçï¼é¿åº¦å¯ä»¥éè¿ IP å±çé¿åº¦åå» IP é¦é¨é¿åº¦è®¡ç®æå¾ï¼æä»¥ä¸å®ç¨åº¦ä¸æ¶åä½çï¼å¯ä»¥åè Stack OverFlow ä¸ç[ç¸å³è®¨è®º](https://stackoverflow.com/a/16748680/5091903)ï¼\n - **æ ¡éªåï¼Checksumï¼**ï¼ç¨äºå¯¹æ´ä¸ªç¨æ·æ°æ®æ¥çæ ¡éªï¼éè¿ IP ä½é¦é¨ä¸åç¨æ·æ°æ®æ¥è®¡ç®å¾å°ï¼\n\nââå¯è§ UDP é¦é¨çè¿äºå­æ®µå¨çè®ºä¸å¯ä»¥æ¯ TCP é¦é¨å­æ®µçå­éãå æ­¤æä»¬å¯ä»¥ç²ç¥å°è®² **TCP æ¯åºäº UDP çä¼ è¾å±åè®®ã**\nââUDP æå¡æ¯ä¸ä¸ªâå°½åèä¸ºâçæå¡ï¼å®**æ²¡ææµéæ§å¶**ï¼**åªè½éè¿æ ¡éªåè¿è¡å·®éæ§å¶ï¼ä¸¢åä¸ä¼ç¥æï¼ä¹ä¸ä¼éä¼ **ï¼ä¹**æ²¡ææ¥å¡æ§å¶**ã\n### ÂµTP é¦é¨\n - **version**ï¼çæ¬å·ï¼ç°å¨ä¸º 1ï¼[è¿æä¸ä¸ªåå§çæ¬å· 0 å­å¨](https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c)\n - **connection_id**ï¼ç¨äºæ è®°è¿æ¥ã[è¿ä¸ªå­æ®µæ¯å¿é¡»çä¹?](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98)ï¼\n - **timestamp_microseconds**ï¼åéæ°æ®åçæ¶é´ï¼åè®¡ç®å»¶è¿æ¶é´ï¼rtt ç¸å³ï¼\n - **timestamp_difference_microseconds**ï¼å½åæ¶é´åä¸ä¸æ¬¡æ¶å°çåä¸­ç timestamp_microseconds ä¹å·®ï¼\n - **wnd_size**ï¼è¡¨ç¤ºå¦ä¸ç«¯å»ºè®®ççªå£å¤§å°ï¼ç¸å½äº TCP ä¸­çæ¥æ¶çªå£ï¼\n - **extension**ï¼ä»£è¡¨ç¬¬ä¸ä¸ªæ©å±çç±»åï¼0 è¡¨ç¤ºæ²¡ææ©å±ï¼1 è¡¨ç¤º Selective ACKsï¼éæ©ç¡®è®¤æ©å±ï¼ã\n - **type**ï¼æ°æ®åçç±»åãå¯ä»¥æï¼\n     - ST_DATA  = 0ï¼æ¿è½½æææ°æ®çæ°æ®åï¼\n     - ST_FIN   = 1ï¼ç»æ­¢è¿æ¥ãæ¯éä¿¡åæ¹åéçæåä¸ä¸ªåï¼ç±»ä¼¼äº TCP ç FIN æ è®°ãä½æ¯åé ST_FIN çä¸æ¹è¿æ¯ä¼ç­å¾å¯è½ä¸¢å¤±æèå¤±åºå°è¾¾çåï¼å³ä½¿æ¶å°äºå¯¹æ¹ç ST_FIN åï¼\n     - ST_STATE = 2ï¼ç¨äºæ¥åç¶æï¼ä¼ è¾ä¸ä¸ªæ²¡ææ°æ®ç ACKãå TCP ä¸­æªæºå¸¦æ°æ®ç ACK åä¸æ ·ï¼å®ä¸æ¶èåºå·ï¼\n     - ST_RESET = 3ï¼å¼ºå¶éç½®è¿æ¥ãç±»ä¼¼ TCP ç RST æ è®°ã\n     - ST_SYN   = 4ï¼åèµ·è¿æ¥ãç±»ä¼¼ TCP ç SYN æ è®°ãåèµ·æ¹ä¼éæºä¸ä¸ª connection_id ID ç¨äºç»æ¥æ¶æ¹åç»­çåå¤ä½¿ç¨ãç¶ååèµ·æ¹ä¹åçåä¸­ä¼ è¾ç connection_id ä¸º ID + 1ï¼\n - **seq_nr**ï¼è¡¨ç¤ºè¿ä¸ªæ°æ®åçåºå·ãæ³¨æå TCP ä¸­ä»£è¡¨å­å·å·çåºå·ææä¸åãåå§åºå·åæ ·ä¹æ¯éæºçæã\n - **ack_nr**ï¼è¡¨ç¤ºæåæ¶å°çæ°æ®åçseq_nrï¼\n\n## è¿æ¥è¿ç¨\nââå¾ç¤ºä¸ºä¸æ¬¡å¨ qBittorrent ä¸­å¯¹ä¸ä¸ªç§å­å¼å§ BT ä¸è½½äºåç§å·¦å³ååæ­¢ä¸è½½æ¶ï¼ä¸å¶ä¸­ä¸ä¸ª peer çäº¤äºè¿ç¨ã\n![è¿æ¥è¿ç¨ï¼ä»¥ connection_id ä¸º 8671 å 8672 çè¿ä¸ä¸ªè¿ç¨ä¸ºä¾ï¼](wireshark.png)\n\n## ä¸¢å\nåä¸¢åå¤çæä¸ä¸ªåçªå£ç¸å³çåééè¦åè¿è¡è¯´æï¼\n - ***max_window***ï¼å®ä¹äºæªè¢«ç¡®è®¤çå­èçä¸éï¼ç¸å½ä¸ TCP ä¸­çæ¥å¡çªå£ï¼\n - ***wnd_size***ï¼åé¦é¨ä¸­ç wnd_sizeï¼å TCP ä¸­ç¸åï¼å®éçåéçªå£å¤§å°ä¸º `min(max_windows, wnd_size)`ï¼\n - ***cur_window***ï¼è¡¨ç¤ºå½åæªè¢«ç¡®è®¤çå­èçæ°éï¼\n\nå½éè¦åéæ°æ®åæ¶ï¼ä»å½ `cur_window + packet_size <= min(max_windows, wnd_size)` æç«ï¼è¿ä¸ªæ°æ®åæè½è¢«åéã\n\n - å½åºå·ä¸º `seq_nr - cur_window` çæ°æ®åï¼åééåä¸­å¹´é¾æå¤§çæªè¢«ç¡®è®¤çæ°æ®åï¼ä¸ä¸ä¸ªçè®ºä¸éè¦è¢«ç¡®è®¤çå°±æ¯å®ï¼æ²¡æè¢«ç¡®è®¤ï¼ä½æ¯å·²ç»æè³å°ä¸ä¸ªåºå·å¤§äºå®çæ°æ®åéè¿ Selective ACK è¢«ç¡®è®¤ï¼é£ä¹è¿ä¸ªæ°æ®åè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã\n - å¦æ `ack_nr + 1` è¿ä¸ªåå·²ç»åéäºï¼èæ¶å°ä¸ä¸ªéå¤ç `ack_nr` ç ACKï¼é£ä¹ `ack_nr + 1`è¿ä¸ªåè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã\n\nå¦ææ£æµå°ä¸¢åï¼é£ä¹æ¥å¡çªå£ **max_window** å¤§å°ååã\n## è¶æ¶\nÂµTP çè¶æ¶è®¡æ¶å TCP ä¸­ RTO è®¡æ¶å¨ä¸å¤ªä¸æ ·ï¼RTO è®¡æ¶å¨ä¸»è¦ç¨äºå¯¹ ACK çè®¡æ¶ï¼ä½æ¯ãÂµTP çè®¡æ¶å¨åæ¯ææ¥æ¶ä»»ä½æ°æ®åè¶æ¶æ¶é´ï¼å¦æè¶æ¶æ¶é´åæ²¡æä»»ä½æ°æ®åå°è¾¾åè¶æ¶ï¼å¦æè¶æ¶ï¼å **packet_size** å **max_window** å°é½ä¼è¢«è®¾ç½®ä¸ºæå°æ°æ®åå¤§å°ï¼150 å­èï¼ã **ï¼çé®ï¼ï¼packet_size çè°æ´ç­ç¥æ¯ä»ä¹ï¼**\n\n### è¶æ¶æ¶é´çè®¡ç®\næ¯å½æ¶å°ä¸ä¸ªæ°æ®åç ACKï¼å°±ä¼æ´æ°å¾è¿æ¶é´ï¼ä¸èèéä¼ çåï¼ï¼å¾è¿æ¶é´ç¨äºè®¡ç®è¶æ¶æ¶é´ãåè¯´æä¸ç¸å³çåéï¼\n - ***rtt***ï¼å¾è¿æ¶é´ï¼\n - ***rtt_var***ï¼å¾è¿æ¶é´å·®å¼ï¼\n - ***packet_rtt***ï¼å½åæ¶å° ACK å¯¹åºçåçå¾è¿æ¶é´ï¼å³å½åæ¶é´åå»è¿ä¸ªååéæ¶çæ¶é´ï¼å³é¦é¨ä¸­ç timestamp å­æ®µè®°å½çå¼ã\n - ***timeout***ï¼è¶æ¶æ¶é´ï¼\n\néè¿ä»¥ä¸å¬å¼æ´æ° rttï¼\n```\ndelta = rtt - packet_rtt\nrtt_var += (abs(delta) - rtt_var) / 4;\nrtt += (packet_rtt - rtt) / 8;\n```\næ­£å¸¸æåµä¸éè¿ rtt è®¡ç®å¾å° timeoutï¼ç¬¬ä¸æ¬¡ç±äºæ²¡æ rttï¼timeout ä½¿ç¨åå§å¼ 1000 msï¼ï¼ï¼\n```\ntimeout = max(rtt + rtt_var * 4, 500);\n```\nå¦æéå°è¶æ¶ï¼å timeout ç¿»åã\n\n## æ¥å¡æ§å¶\nå¨**ä¸¢å**å**è¶æ¶**é¨åå·²ç»æ¶åå°æ¥å¡çªå£çè°æ´äºãÂµTP çæ¥å¡æ§å¶å¯ä»¥çè§£ä¸ºä¸ç§åºäºå»¶è¿çè´åé¦æ¥å¡æ§å¶ï¼éè¿å»¶è¿çååæ§å¶çªå£å¤§å°çååï¼è¾¾å°æ¥å¡æ§å¶ç®çãè®¡ç®çªå£å¤§å°è¿ç¨ä¸­çç¸å³å¸¸éååéçå®ä¹å¦ä¸ï¼\n - ***CONTROL_TARGET***ï¼ÂµTP æè½æ¥æ¶çä¸è¡ç¼å²å»¶è¿ï¼ç°å¨æ¯ 100 msï¼\n - ***base_delay***ï¼ä¸¤åéåçæ¶å°çæ°æ®åçæä½å»¶è¿ï¼\n - ***our_delay***ï¼å½åçæ°æ®åå»¶è¿ï¼\n - ***off_target***ï¼å®éå»¶è¿åç®æ å»¶è¿çå·®è·ãå³`CONTROL_TARGET - our_delay`ï¼\n - ***outstanding_packet***ï¼å·²ç»è¢«åéä½æ¯æªè¢«ç¡®è®¤çæ°æ®åï¼\n\nå·ä½è®¡ç®è¿ç¨å¦ä¸ï¼\n```\ndelay_factor = off_target / CCONTROL_TARGET;\nwindow_factor = outstanding_packet / max_window;\nscaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;\n\nmax_window += scaled_gain;\n```\nå½ `off_target > 0` æ¶ï¼å½ååçå»¶è¿æ¶é´æ¯è®¾å®çè¿å°ä¸äºï¼é£ä¹çªå£ä¼ç¼©å°ï¼åééçå°±ä¼æ¾æ¢ï¼åä¹ï¼çªå£å¢å ï¼éçå å¿«ã\n\n\n## åèèµæ\n1. [BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol](http://www.bittorrent.org/beps/bep_0029.html)\n2. [RFC 6817 - Low Extra Delay Background Transport (LEDBAT)](https://tools.ietf.org/html/rfc6817)\n3. [Calvin's Marbles - libutpæºç ç®æ](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/)","source":"_posts/Âµtp.md","raw":"---\ntitle: ÂµTP åè®® ââ å¯¹ BEP29 çç®è¦çè§£\nkeywords: []\ndate: 2018/08/04 17:05:00\ntags: [Network, BT]\ncategories:\n---\nå¨ {% post_link tcp %}ä¸­åé¡¾äº TCPï¼èè¿ç¯æç« ä¸»è¦è®²ç¨äº BT ç½ç»çåºäº UDP çè¿è¾å±åè®® ÂµTPï¼åæ¶é¡ºä¾¿åé¡¾ UDPãä¸é¢çåå®¹æ´å¤æ¯åºäºå¯¹ [BEP29](http://www.bittorrent.org/beps/bep_0029.html) ï¼BitTorrent ç 29 å·ææ¡ï¼æèç´ç¿»ä¸ºå¢å¼ºå»ºè®®ï¼ç±»ä¼¼çæ JEPï¼PEPï¼ççè§£ã\n## åå­æ¢ç©¶\nââÂµTP çä¸»è¦ææ¡£ BEP29 çåå»ºäº 2009 å¹´ï¼å§ä¸è®¤ä¸ºè¿ä¹æ¯è®¾è®¡å®æçå¤§è´æ¶é´ï¼ÂµTP å¨ uTorrent ç 1.8 ä¸­é¦æ¬¡å å¥ï¼2009 å¹´ï¼è¿ä¸ªäºå®ä¹ä½è¯äºè¿ç¹ãå®çè®¾è®¡èåæ¬ï¼\n - [Ludvig Strigeus](https://en.wikipedia.org/wiki/Ludvig_Strigeus)ï¼Î¼Torrent ä½èï¼BitTorrent å¬å¸ 2006 å¹´æ¶è´­ Î¼Torrentï¼ç®åå¨ Spotify å·¥ä½ï¼\n - Greg Hazel\n - [Stanislav Shalunov](https://www.linkedin.com/in/shalunov)ï¼ÂµTP ä¸­çæ¥å¡ç®æ³ [LEDBAT](https://tools.ietf.org/html/rfc6817) ä¸»è¦ä½èï¼åæ¥è¿åé äºå¯ä»¥è±ç¦»ç°æèçªç½ç»ä½¿ç¨ç IM åºç¨ [FireChat](https://www.opengarden.com/firechat.html) ââ å®è¢«å¤æ¬¡ç¨å°âå ä¸­âè¿æ ·çå¬æ°è¿å¨ä¸­ï¼\n - Arvid Norbergï¼libtorrent å¼åèï¼ç®åå¨ [Blockstream](https://blockstream.com/) å·¥ä½ï¼\n - Bram Cohenï¼BitTorrent ä½èï¼\n\n## è®¾è®¡åå \nââå¨è¿å»å¤å¹´åï¼å¦æä½¿ç¨ BT è¿è¡ä¸è½½ç­é¨èµæºçè¯å¯ä»¥æåå°å°éåº¦é£å¿«ï¼ä½æ¯åæ¶å¸¦æ¥çé®é¢å°±æ¯å¦ææ³è¦åæ¶çå¨çº¿è§é¢å°±ä¼å¸¦æ¥å¡é¡¿ãé®é¢å¨äº DSL å modem çå¾å¾æä¸ä¸ªåå®ä»¬çåééçä¸ææ¯ä¾çåéç¼å²åºï¼ä¸ææ¯ä¾å°å¯ä»¥å®¹çº³å ç§éçæ°æ®éãè BT å¾å¾ä¼ä¸è®¸å¤ peer å»ºç« TCP è¿æ¥ï¼å¨ TCP å°å¸¦å®½ååå°åéå°æ¯ä¸ªè¿æ¥çåæä¸ï¼BT å°±å ç¨äºè¾å¤çå¸¦å®½ï¼ä½æ¯å¶ä»è¯¸å¦æµè§ç½é¡µãå³æ¶éè®¯è¿äºåºæ¯çä¼åçº§å®éä¸åºè¯¥è¦æ¯ BT ä¼ è¾æ´é«äºï¼ä½æ¯å ä¸º BT å ç©çå±çè¿ç§ç¹æ§å¯¼è´äºå¶ä»æå¡æå»¶è¿ï¼å½±åäºä½¿ç¨ BT æ¶å¶ä»æå¡çä½éªã\nââÂµTP éè¿å° modem çç¼å²éåçå¤§å°ä½ä¸ºä¸ä¸ªæ§å¶å å­æ¥è°æ´åééçï¼å½éåè¿å¤§æ¶ï¼å°ä¼æ¾æ¢åééåº¦ãè¿ç§ç­ç¥ä½¿å¾ BT å¨æ²¡æç«äºçæåµä¸å¯ä»¥ååå©ç¨ä¸ä¼ å¸¦å®½ï¼å¨æå¤§éå¶ä»æµéçæåµä¸åæ¾æ¢åééçã\nââä¸è¿°æ¶ Bittorrent ææ¡£ä¸­çè¯´æ³ï¼ä½æ¯å®éä¸ ÂµTP æ¯åºäºåçå»¶æ¶çï¼èä¸æ¯åºäºéåå¤§å°çãèä¸ ÂµTP å·ä½å¯¹æ¥å¡ç®æ³ LEDBAT çå®ç°æä¸å¨ IETF äºèç½èæ¡ [RFC 6817](https://tools.ietf.org/html/rfc6817) ä¸­çæè¿°ææåºå«ï¼è¿éçå®ç°æ C++ çæ¬ç [libutp](https://github.com/bittorrent/libutp)ï¼åä¸ªçæ¬çå®ç°ä¸å®å¨ä¸è´ï¼ã\n\n## UDP å ÂµTP é¦é¨\nââä¸ºäºæ¹ä¾¿ä¸ TCP åç®åçå¯¹æ¯ï¼æ UDP çé¦é¨ï¼ååä¸ªå­èï¼ä¸ ÂµTP çé¦é¨ï¼å©ä½é¨åï¼æ¾å¨äºä¸ä¸ªå¾ä¸­ç¤ºæãä» UDP é¦é¨å­æ®µæ°éçå¯ä»¥åç° UDP åè®®ç¸å¯¹ TCP åè®®æ¯å¦æ­¤ç®åï¼ä»¥è³äºæä»¬wå¯ä»¥å° TCP åè®®çææ¯ç±»ä¼¼ ÂµTP åè®®ä¸æ ·çåºäº UDP åè®®çè¿è¾å±åè®®ã\n![UDP Header And ÂµTP Header](udp_utp_header.png)\n\n### UDP é¦é¨\n - **æº / ç®ç«¯å£ï¼Source / Destination portï¼**ï¼ç¨äºç¡®è®¤éä¿¡è¿ç¨åæ¹ãæºç«¯å£æ¯å¯éçï¼å¦æè®¾ç½®äºæºç«¯å£ï¼åæ¥æ¶æ¹å°å¶è§ä¸ºåå¤ç«¯å£ãå¦æä¸éè¦åå¤å°±ä¸éè¦è®¾ç½®ï¼\n - **æ»é¿åº¦ï¼Lengthï¼**ï¼å®ä¹äº UDP ç¨æ·æ°æ®æ¥çæ»é¿åº¦ï¼åæ¬é¦é¨åæ°æ®ãTCP é¦é¨ä¸­æ¯æ²¡ææè°âæ¥ææ®µæ»é¿åº¦âçå­æ®µçï¼é¿åº¦å¯ä»¥éè¿ IP å±çé¿åº¦åå» IP é¦é¨é¿åº¦è®¡ç®æå¾ï¼æä»¥ä¸å®ç¨åº¦ä¸æ¶åä½çï¼å¯ä»¥åè Stack OverFlow ä¸ç[ç¸å³è®¨è®º](https://stackoverflow.com/a/16748680/5091903)ï¼\n - **æ ¡éªåï¼Checksumï¼**ï¼ç¨äºå¯¹æ´ä¸ªç¨æ·æ°æ®æ¥çæ ¡éªï¼éè¿ IP ä½é¦é¨ä¸åç¨æ·æ°æ®æ¥è®¡ç®å¾å°ï¼\n\nââå¯è§ UDP é¦é¨çè¿äºå­æ®µå¨çè®ºä¸å¯ä»¥æ¯ TCP é¦é¨å­æ®µçå­éãå æ­¤æä»¬å¯ä»¥ç²ç¥å°è®² **TCP æ¯åºäº UDP çä¼ è¾å±åè®®ã**\nââUDP æå¡æ¯ä¸ä¸ªâå°½åèä¸ºâçæå¡ï¼å®**æ²¡ææµéæ§å¶**ï¼**åªè½éè¿æ ¡éªåè¿è¡å·®éæ§å¶ï¼ä¸¢åä¸ä¼ç¥æï¼ä¹ä¸ä¼éä¼ **ï¼ä¹**æ²¡ææ¥å¡æ§å¶**ã\n### ÂµTP é¦é¨\n - **version**ï¼çæ¬å·ï¼ç°å¨ä¸º 1ï¼[è¿æä¸ä¸ªåå§çæ¬å· 0 å­å¨](https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c)\n - **connection_id**ï¼ç¨äºæ è®°è¿æ¥ã[è¿ä¸ªå­æ®µæ¯å¿é¡»çä¹?](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98)ï¼\n - **timestamp_microseconds**ï¼åéæ°æ®åçæ¶é´ï¼åè®¡ç®å»¶è¿æ¶é´ï¼rtt ç¸å³ï¼\n - **timestamp_difference_microseconds**ï¼å½åæ¶é´åä¸ä¸æ¬¡æ¶å°çåä¸­ç timestamp_microseconds ä¹å·®ï¼\n - **wnd_size**ï¼è¡¨ç¤ºå¦ä¸ç«¯å»ºè®®ççªå£å¤§å°ï¼ç¸å½äº TCP ä¸­çæ¥æ¶çªå£ï¼\n - **extension**ï¼ä»£è¡¨ç¬¬ä¸ä¸ªæ©å±çç±»åï¼0 è¡¨ç¤ºæ²¡ææ©å±ï¼1 è¡¨ç¤º Selective ACKsï¼éæ©ç¡®è®¤æ©å±ï¼ã\n - **type**ï¼æ°æ®åçç±»åãå¯ä»¥æï¼\n     - ST_DATA  = 0ï¼æ¿è½½æææ°æ®çæ°æ®åï¼\n     - ST_FIN   = 1ï¼ç»æ­¢è¿æ¥ãæ¯éä¿¡åæ¹åéçæåä¸ä¸ªåï¼ç±»ä¼¼äº TCP ç FIN æ è®°ãä½æ¯åé ST_FIN çä¸æ¹è¿æ¯ä¼ç­å¾å¯è½ä¸¢å¤±æèå¤±åºå°è¾¾çåï¼å³ä½¿æ¶å°äºå¯¹æ¹ç ST_FIN åï¼\n     - ST_STATE = 2ï¼ç¨äºæ¥åç¶æï¼ä¼ è¾ä¸ä¸ªæ²¡ææ°æ®ç ACKãå TCP ä¸­æªæºå¸¦æ°æ®ç ACK åä¸æ ·ï¼å®ä¸æ¶èåºå·ï¼\n     - ST_RESET = 3ï¼å¼ºå¶éç½®è¿æ¥ãç±»ä¼¼ TCP ç RST æ è®°ã\n     - ST_SYN   = 4ï¼åèµ·è¿æ¥ãç±»ä¼¼ TCP ç SYN æ è®°ãåèµ·æ¹ä¼éæºä¸ä¸ª connection_id ID ç¨äºç»æ¥æ¶æ¹åç»­çåå¤ä½¿ç¨ãç¶ååèµ·æ¹ä¹åçåä¸­ä¼ è¾ç connection_id ä¸º ID + 1ï¼\n - **seq_nr**ï¼è¡¨ç¤ºè¿ä¸ªæ°æ®åçåºå·ãæ³¨æå TCP ä¸­ä»£è¡¨å­å·å·çåºå·ææä¸åãåå§åºå·åæ ·ä¹æ¯éæºçæã\n - **ack_nr**ï¼è¡¨ç¤ºæåæ¶å°çæ°æ®åçseq_nrï¼\n\n## è¿æ¥è¿ç¨\nââå¾ç¤ºä¸ºä¸æ¬¡å¨ qBittorrent ä¸­å¯¹ä¸ä¸ªç§å­å¼å§ BT ä¸è½½äºåç§å·¦å³ååæ­¢ä¸è½½æ¶ï¼ä¸å¶ä¸­ä¸ä¸ª peer çäº¤äºè¿ç¨ã\n![è¿æ¥è¿ç¨ï¼ä»¥ connection_id ä¸º 8671 å 8672 çè¿ä¸ä¸ªè¿ç¨ä¸ºä¾ï¼](wireshark.png)\n\n## ä¸¢å\nåä¸¢åå¤çæä¸ä¸ªåçªå£ç¸å³çåééè¦åè¿è¡è¯´æï¼\n - ***max_window***ï¼å®ä¹äºæªè¢«ç¡®è®¤çå­èçä¸éï¼ç¸å½ä¸ TCP ä¸­çæ¥å¡çªå£ï¼\n - ***wnd_size***ï¼åé¦é¨ä¸­ç wnd_sizeï¼å TCP ä¸­ç¸åï¼å®éçåéçªå£å¤§å°ä¸º `min(max_windows, wnd_size)`ï¼\n - ***cur_window***ï¼è¡¨ç¤ºå½åæªè¢«ç¡®è®¤çå­èçæ°éï¼\n\nå½éè¦åéæ°æ®åæ¶ï¼ä»å½ `cur_window + packet_size <= min(max_windows, wnd_size)` æç«ï¼è¿ä¸ªæ°æ®åæè½è¢«åéã\n\n - å½åºå·ä¸º `seq_nr - cur_window` çæ°æ®åï¼åééåä¸­å¹´é¾æå¤§çæªè¢«ç¡®è®¤çæ°æ®åï¼ä¸ä¸ä¸ªçè®ºä¸éè¦è¢«ç¡®è®¤çå°±æ¯å®ï¼æ²¡æè¢«ç¡®è®¤ï¼ä½æ¯å·²ç»æè³å°ä¸ä¸ªåºå·å¤§äºå®çæ°æ®åéè¿ Selective ACK è¢«ç¡®è®¤ï¼é£ä¹è¿ä¸ªæ°æ®åè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã\n - å¦æ `ack_nr + 1` è¿ä¸ªåå·²ç»åéäºï¼èæ¶å°ä¸ä¸ªéå¤ç `ack_nr` ç ACKï¼é£ä¹ `ack_nr + 1`è¿ä¸ªåè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã\n\nå¦ææ£æµå°ä¸¢åï¼é£ä¹æ¥å¡çªå£ **max_window** å¤§å°ååã\n## è¶æ¶\nÂµTP çè¶æ¶è®¡æ¶å TCP ä¸­ RTO è®¡æ¶å¨ä¸å¤ªä¸æ ·ï¼RTO è®¡æ¶å¨ä¸»è¦ç¨äºå¯¹ ACK çè®¡æ¶ï¼ä½æ¯ãÂµTP çè®¡æ¶å¨åæ¯ææ¥æ¶ä»»ä½æ°æ®åè¶æ¶æ¶é´ï¼å¦æè¶æ¶æ¶é´åæ²¡æä»»ä½æ°æ®åå°è¾¾åè¶æ¶ï¼å¦æè¶æ¶ï¼å **packet_size** å **max_window** å°é½ä¼è¢«è®¾ç½®ä¸ºæå°æ°æ®åå¤§å°ï¼150 å­èï¼ã **ï¼çé®ï¼ï¼packet_size çè°æ´ç­ç¥æ¯ä»ä¹ï¼**\n\n### è¶æ¶æ¶é´çè®¡ç®\næ¯å½æ¶å°ä¸ä¸ªæ°æ®åç ACKï¼å°±ä¼æ´æ°å¾è¿æ¶é´ï¼ä¸èèéä¼ çåï¼ï¼å¾è¿æ¶é´ç¨äºè®¡ç®è¶æ¶æ¶é´ãåè¯´æä¸ç¸å³çåéï¼\n - ***rtt***ï¼å¾è¿æ¶é´ï¼\n - ***rtt_var***ï¼å¾è¿æ¶é´å·®å¼ï¼\n - ***packet_rtt***ï¼å½åæ¶å° ACK å¯¹åºçåçå¾è¿æ¶é´ï¼å³å½åæ¶é´åå»è¿ä¸ªååéæ¶çæ¶é´ï¼å³é¦é¨ä¸­ç timestamp å­æ®µè®°å½çå¼ã\n - ***timeout***ï¼è¶æ¶æ¶é´ï¼\n\néè¿ä»¥ä¸å¬å¼æ´æ° rttï¼\n```\ndelta = rtt - packet_rtt\nrtt_var += (abs(delta) - rtt_var) / 4;\nrtt += (packet_rtt - rtt) / 8;\n```\næ­£å¸¸æåµä¸éè¿ rtt è®¡ç®å¾å° timeoutï¼ç¬¬ä¸æ¬¡ç±äºæ²¡æ rttï¼timeout ä½¿ç¨åå§å¼ 1000 msï¼ï¼ï¼\n```\ntimeout = max(rtt + rtt_var * 4, 500);\n```\nå¦æéå°è¶æ¶ï¼å timeout ç¿»åã\n\n## æ¥å¡æ§å¶\nå¨**ä¸¢å**å**è¶æ¶**é¨åå·²ç»æ¶åå°æ¥å¡çªå£çè°æ´äºãÂµTP çæ¥å¡æ§å¶å¯ä»¥çè§£ä¸ºä¸ç§åºäºå»¶è¿çè´åé¦æ¥å¡æ§å¶ï¼éè¿å»¶è¿çååæ§å¶çªå£å¤§å°çååï¼è¾¾å°æ¥å¡æ§å¶ç®çãè®¡ç®çªå£å¤§å°è¿ç¨ä¸­çç¸å³å¸¸éååéçå®ä¹å¦ä¸ï¼\n - ***CONTROL_TARGET***ï¼ÂµTP æè½æ¥æ¶çä¸è¡ç¼å²å»¶è¿ï¼ç°å¨æ¯ 100 msï¼\n - ***base_delay***ï¼ä¸¤åéåçæ¶å°çæ°æ®åçæä½å»¶è¿ï¼\n - ***our_delay***ï¼å½åçæ°æ®åå»¶è¿ï¼\n - ***off_target***ï¼å®éå»¶è¿åç®æ å»¶è¿çå·®è·ãå³`CONTROL_TARGET - our_delay`ï¼\n - ***outstanding_packet***ï¼å·²ç»è¢«åéä½æ¯æªè¢«ç¡®è®¤çæ°æ®åï¼\n\nå·ä½è®¡ç®è¿ç¨å¦ä¸ï¼\n```\ndelay_factor = off_target / CCONTROL_TARGET;\nwindow_factor = outstanding_packet / max_window;\nscaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;\n\nmax_window += scaled_gain;\n```\nå½ `off_target > 0` æ¶ï¼å½ååçå»¶è¿æ¶é´æ¯è®¾å®çè¿å°ä¸äºï¼é£ä¹çªå£ä¼ç¼©å°ï¼åééçå°±ä¼æ¾æ¢ï¼åä¹ï¼çªå£å¢å ï¼éçå å¿«ã\n\n\n## åèèµæ\n1. [BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol](http://www.bittorrent.org/beps/bep_0029.html)\n2. [RFC 6817 - Low Extra Delay Background Transport (LEDBAT)](https://tools.ietf.org/html/rfc6817)\n3. [Calvin's Marbles - libutpæºç ç®æ](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/)","slug":"Âµtp","published":1,"updated":"2018-08-10T08:21:14.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjknq4rfr000a2ofnm2u6ykix","content":"<p>å¨ <a href=\"/2018/07/20/tcp/\" title=\"TCP æ¸©æç¥æ°\">TCP æ¸©æç¥æ°</a>ä¸­åé¡¾äº TCPï¼èè¿ç¯æç« ä¸»è¦è®²ç¨äº BT ç½ç»çåºäº UDP çè¿è¾å±åè®® ÂµTPï¼åæ¶é¡ºä¾¿åé¡¾ UDPãä¸é¢çåå®¹æ´å¤æ¯åºäºå¯¹ <a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BEP29</a> ï¼BitTorrent ç 29 å·ææ¡ï¼æèç´ç¿»ä¸ºå¢å¼ºå»ºè®®ï¼ç±»ä¼¼çæ JEPï¼PEPï¼ççè§£ã</p>\n<h2 id=\"åå­æ¢ç©¶\"><a href=\"#åå­æ¢ç©¶\" class=\"headerlink\" title=\"åå­æ¢ç©¶\"></a>åå­æ¢ç©¶</h2><p>ââÂµTP çä¸»è¦ææ¡£ BEP29 çåå»ºäº 2009 å¹´ï¼å§ä¸è®¤ä¸ºè¿ä¹æ¯è®¾è®¡å®æçå¤§è´æ¶é´ï¼ÂµTP å¨ uTorrent ç 1.8 ä¸­é¦æ¬¡å å¥ï¼2009 å¹´ï¼è¿ä¸ªäºå®ä¹ä½è¯äºè¿ç¹ãå®çè®¾è®¡èåæ¬ï¼</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Ludvig_Strigeus\" target=\"_blank\" rel=\"noopener\">Ludvig Strigeus</a>ï¼Î¼Torrent ä½èï¼BitTorrent å¬å¸ 2006 å¹´æ¶è´­ Î¼Torrentï¼ç®åå¨ Spotify å·¥ä½ï¼</li>\n<li>Greg Hazel</li>\n<li><a href=\"https://www.linkedin.com/in/shalunov\" target=\"_blank\" rel=\"noopener\">Stanislav Shalunov</a>ï¼ÂµTP ä¸­çæ¥å¡ç®æ³ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">LEDBAT</a> ä¸»è¦ä½èï¼åæ¥è¿åé äºå¯ä»¥è±ç¦»ç°æèçªç½ç»ä½¿ç¨ç IM åºç¨ <a href=\"https://www.opengarden.com/firechat.html\" target=\"_blank\" rel=\"noopener\">FireChat</a> ââ å®è¢«å¤æ¬¡ç¨å°âå ä¸­âè¿æ ·çå¬æ°è¿å¨ä¸­ï¼</li>\n<li>Arvid Norbergï¼libtorrent å¼åèï¼ç®åå¨ <a href=\"https://blockstream.com/\" target=\"_blank\" rel=\"noopener\">Blockstream</a> å·¥ä½ï¼</li>\n<li>Bram Cohenï¼BitTorrent ä½èï¼</li>\n</ul>\n<h2 id=\"è®¾è®¡åå \"><a href=\"#è®¾è®¡åå \" class=\"headerlink\" title=\"è®¾è®¡åå \"></a>è®¾è®¡åå </h2><p>ââå¨è¿å»å¤å¹´åï¼å¦æä½¿ç¨ BT è¿è¡ä¸è½½ç­é¨èµæºçè¯å¯ä»¥æåå°å°éåº¦é£å¿«ï¼ä½æ¯åæ¶å¸¦æ¥çé®é¢å°±æ¯å¦ææ³è¦åæ¶çå¨çº¿è§é¢å°±ä¼å¸¦æ¥å¡é¡¿ãé®é¢å¨äº DSL å modem çå¾å¾æä¸ä¸ªåå®ä»¬çåééçä¸ææ¯ä¾çåéç¼å²åºï¼ä¸ææ¯ä¾å°å¯ä»¥å®¹çº³å ç§éçæ°æ®éãè BT å¾å¾ä¼ä¸è®¸å¤ peer å»ºç« TCP è¿æ¥ï¼å¨ TCP å°å¸¦å®½ååå°åéå°æ¯ä¸ªè¿æ¥çåæä¸ï¼BT å°±å ç¨äºè¾å¤çå¸¦å®½ï¼ä½æ¯å¶ä»è¯¸å¦æµè§ç½é¡µãå³æ¶éè®¯è¿äºåºæ¯çä¼åçº§å®éä¸åºè¯¥è¦æ¯ BT ä¼ è¾æ´é«äºï¼ä½æ¯å ä¸º BT å ç©çå±çè¿ç§ç¹æ§å¯¼è´äºå¶ä»æå¡æå»¶è¿ï¼å½±åäºä½¿ç¨ BT æ¶å¶ä»æå¡çä½éªã<br>ââÂµTP éè¿å° modem çç¼å²éåçå¤§å°ä½ä¸ºä¸ä¸ªæ§å¶å å­æ¥è°æ´åééçï¼å½éåè¿å¤§æ¶ï¼å°ä¼æ¾æ¢åééåº¦ãè¿ç§ç­ç¥ä½¿å¾ BT å¨æ²¡æç«äºçæåµä¸å¯ä»¥ååå©ç¨ä¸ä¼ å¸¦å®½ï¼å¨æå¤§éå¶ä»æµéçæåµä¸åæ¾æ¢åééçã<br>ââä¸è¿°æ¶ Bittorrent ææ¡£ä¸­çè¯´æ³ï¼ä½æ¯å®éä¸ ÂµTP æ¯åºäºåçå»¶æ¶çï¼èä¸æ¯åºäºéåå¤§å°çãèä¸ ÂµTP å·ä½å¯¹æ¥å¡ç®æ³ LEDBAT çå®ç°æä¸å¨ IETF äºèç½èæ¡ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817</a> ä¸­çæè¿°ææåºå«ï¼è¿éçå®ç°æ C++ çæ¬ç <a href=\"https://github.com/bittorrent/libutp\" target=\"_blank\" rel=\"noopener\">libutp</a>ï¼åä¸ªçæ¬çå®ç°ä¸å®å¨ä¸è´ï¼ã</p>\n<h2 id=\"UDP-å-ÂµTP-é¦é¨\"><a href=\"#UDP-å-ÂµTP-é¦é¨\" class=\"headerlink\" title=\"UDP å ÂµTP é¦é¨\"></a>UDP å ÂµTP é¦é¨</h2><p>ââä¸ºäºæ¹ä¾¿ä¸ TCP åç®åçå¯¹æ¯ï¼æ UDP çé¦é¨ï¼ååä¸ªå­èï¼ä¸ ÂµTP çé¦é¨ï¼å©ä½é¨åï¼æ¾å¨äºä¸ä¸ªå¾ä¸­ç¤ºæãä» UDP é¦é¨å­æ®µæ°éçå¯ä»¥åç° UDP åè®®ç¸å¯¹ TCP åè®®æ¯å¦æ­¤ç®åï¼ä»¥è³äºæä»¬wå¯ä»¥å° TCP åè®®çææ¯ç±»ä¼¼ ÂµTP åè®®ä¸æ ·çåºäº UDP åè®®çè¿è¾å±åè®®ã<br><img src=\"udp_utp_header.png\" alt=\"UDP Header And ÂµTP Header\"></p>\n<h3 id=\"UDP-é¦é¨\"><a href=\"#UDP-é¦é¨\" class=\"headerlink\" title=\"UDP é¦é¨\"></a>UDP é¦é¨</h3><ul>\n<li><strong>æº / ç®ç«¯å£ï¼Source / Destination portï¼</strong>ï¼ç¨äºç¡®è®¤éä¿¡è¿ç¨åæ¹ãæºç«¯å£æ¯å¯éçï¼å¦æè®¾ç½®äºæºç«¯å£ï¼åæ¥æ¶æ¹å°å¶è§ä¸ºåå¤ç«¯å£ãå¦æä¸éè¦åå¤å°±ä¸éè¦è®¾ç½®ï¼</li>\n<li><strong>æ»é¿åº¦ï¼Lengthï¼</strong>ï¼å®ä¹äº UDP ç¨æ·æ°æ®æ¥çæ»é¿åº¦ï¼åæ¬é¦é¨åæ°æ®ãTCP é¦é¨ä¸­æ¯æ²¡ææè°âæ¥ææ®µæ»é¿åº¦âçå­æ®µçï¼é¿åº¦å¯ä»¥éè¿ IP å±çé¿åº¦åå» IP é¦é¨é¿åº¦è®¡ç®æå¾ï¼æä»¥ä¸å®ç¨åº¦ä¸æ¶åä½çï¼å¯ä»¥åè Stack OverFlow ä¸ç<a href=\"https://stackoverflow.com/a/16748680/5091903\" target=\"_blank\" rel=\"noopener\">ç¸å³è®¨è®º</a>ï¼</li>\n<li><strong>æ ¡éªåï¼Checksumï¼</strong>ï¼ç¨äºå¯¹æ´ä¸ªç¨æ·æ°æ®æ¥çæ ¡éªï¼éè¿ IP ä½é¦é¨ä¸åç¨æ·æ°æ®æ¥è®¡ç®å¾å°ï¼</li>\n</ul>\n<p>ââå¯è§ UDP é¦é¨çè¿äºå­æ®µå¨çè®ºä¸å¯ä»¥æ¯ TCP é¦é¨å­æ®µçå­éãå æ­¤æä»¬å¯ä»¥ç²ç¥å°è®² <strong>TCP æ¯åºäº UDP çä¼ è¾å±åè®®ã</strong><br>ââUDP æå¡æ¯ä¸ä¸ªâå°½åèä¸ºâçæå¡ï¼å®<strong>æ²¡ææµéæ§å¶</strong>ï¼<strong>åªè½éè¿æ ¡éªåè¿è¡å·®éæ§å¶ï¼ä¸¢åä¸ä¼ç¥æï¼ä¹ä¸ä¼éä¼ </strong>ï¼ä¹<strong>æ²¡ææ¥å¡æ§å¶</strong>ã</p>\n<h3 id=\"ÂµTP-é¦é¨\"><a href=\"#ÂµTP-é¦é¨\" class=\"headerlink\" title=\"ÂµTP é¦é¨\"></a>ÂµTP é¦é¨</h3><ul>\n<li><strong>version</strong>ï¼çæ¬å·ï¼ç°å¨ä¸º 1ï¼<a href=\"https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c\" target=\"_blank\" rel=\"noopener\">è¿æä¸ä¸ªåå§çæ¬å· 0 å­å¨</a></li>\n<li><strong>connection_id</strong>ï¼ç¨äºæ è®°è¿æ¥ã<a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98\" target=\"_blank\" rel=\"noopener\">è¿ä¸ªå­æ®µæ¯å¿é¡»çä¹?</a>ï¼</li>\n<li><strong>timestamp_microseconds</strong>ï¼åéæ°æ®åçæ¶é´ï¼åè®¡ç®å»¶è¿æ¶é´ï¼rtt ç¸å³ï¼</li>\n<li><strong>timestamp_difference_microseconds</strong>ï¼å½åæ¶é´åä¸ä¸æ¬¡æ¶å°çåä¸­ç timestamp_microseconds ä¹å·®ï¼</li>\n<li><strong>wnd_size</strong>ï¼è¡¨ç¤ºå¦ä¸ç«¯å»ºè®®ççªå£å¤§å°ï¼ç¸å½äº TCP ä¸­çæ¥æ¶çªå£ï¼</li>\n<li><strong>extension</strong>ï¼ä»£è¡¨ç¬¬ä¸ä¸ªæ©å±çç±»åï¼0 è¡¨ç¤ºæ²¡ææ©å±ï¼1 è¡¨ç¤º Selective ACKsï¼éæ©ç¡®è®¤æ©å±ï¼ã</li>\n<li><strong>type</strong>ï¼æ°æ®åçç±»åãå¯ä»¥æï¼<ul>\n<li>ST_DATA  = 0ï¼æ¿è½½æææ°æ®çæ°æ®åï¼</li>\n<li>ST_FIN   = 1ï¼ç»æ­¢è¿æ¥ãæ¯éä¿¡åæ¹åéçæåä¸ä¸ªåï¼ç±»ä¼¼äº TCP ç FIN æ è®°ãä½æ¯åé ST_FIN çä¸æ¹è¿æ¯ä¼ç­å¾å¯è½ä¸¢å¤±æèå¤±åºå°è¾¾çåï¼å³ä½¿æ¶å°äºå¯¹æ¹ç ST_FIN åï¼</li>\n<li>ST_STATE = 2ï¼ç¨äºæ¥åç¶æï¼ä¼ è¾ä¸ä¸ªæ²¡ææ°æ®ç ACKãå TCP ä¸­æªæºå¸¦æ°æ®ç ACK åä¸æ ·ï¼å®ä¸æ¶èåºå·ï¼</li>\n<li>ST_RESET = 3ï¼å¼ºå¶éç½®è¿æ¥ãç±»ä¼¼ TCP ç RST æ è®°ã</li>\n<li>ST_SYN   = 4ï¼åèµ·è¿æ¥ãç±»ä¼¼ TCP ç SYN æ è®°ãåèµ·æ¹ä¼éæºä¸ä¸ª connection_id ID ç¨äºç»æ¥æ¶æ¹åç»­çåå¤ä½¿ç¨ãç¶ååèµ·æ¹ä¹åçåä¸­ä¼ è¾ç connection_id ä¸º ID + 1ï¼</li>\n</ul>\n</li>\n<li><strong>seq_nr</strong>ï¼è¡¨ç¤ºè¿ä¸ªæ°æ®åçåºå·ãæ³¨æå TCP ä¸­ä»£è¡¨å­å·å·çåºå·ææä¸åãåå§åºå·åæ ·ä¹æ¯éæºçæã</li>\n<li><strong>ack_nr</strong>ï¼è¡¨ç¤ºæåæ¶å°çæ°æ®åçseq_nrï¼</li>\n</ul>\n<h2 id=\"è¿æ¥è¿ç¨\"><a href=\"#è¿æ¥è¿ç¨\" class=\"headerlink\" title=\"è¿æ¥è¿ç¨\"></a>è¿æ¥è¿ç¨</h2><p>ââå¾ç¤ºä¸ºä¸æ¬¡å¨ qBittorrent ä¸­å¯¹ä¸ä¸ªç§å­å¼å§ BT ä¸è½½äºåç§å·¦å³ååæ­¢ä¸è½½æ¶ï¼ä¸å¶ä¸­ä¸ä¸ª peer çäº¤äºè¿ç¨ã<br><img src=\"wireshark.png\" alt=\"è¿æ¥è¿ç¨ï¼ä»¥ connection_id ä¸º 8671 å 8672 çè¿ä¸ä¸ªè¿ç¨ä¸ºä¾ï¼\"></p>\n<h2 id=\"ä¸¢å\"><a href=\"#ä¸¢å\" class=\"headerlink\" title=\"ä¸¢å\"></a>ä¸¢å</h2><p>åä¸¢åå¤çæä¸ä¸ªåçªå£ç¸å³çåééè¦åè¿è¡è¯´æï¼</p>\n<ul>\n<li><strong><em>max_window</em></strong>ï¼å®ä¹äºæªè¢«ç¡®è®¤çå­èçä¸éï¼ç¸å½ä¸ TCP ä¸­çæ¥å¡çªå£ï¼</li>\n<li><strong><em>wnd_size</em></strong>ï¼åé¦é¨ä¸­ç wnd_sizeï¼å TCP ä¸­ç¸åï¼å®éçåéçªå£å¤§å°ä¸º <code>min(max_windows, wnd_size)</code>ï¼</li>\n<li><strong><em>cur_window</em></strong>ï¼è¡¨ç¤ºå½åæªè¢«ç¡®è®¤çå­èçæ°éï¼</li>\n</ul>\n<p>å½éè¦åéæ°æ®åæ¶ï¼ä»å½ <code>cur_window + packet_size &lt;= min(max_windows, wnd_size)</code> æç«ï¼è¿ä¸ªæ°æ®åæè½è¢«åéã</p>\n<ul>\n<li>å½åºå·ä¸º <code>seq_nr - cur_window</code> çæ°æ®åï¼åééåä¸­å¹´é¾æå¤§çæªè¢«ç¡®è®¤çæ°æ®åï¼ä¸ä¸ä¸ªçè®ºä¸éè¦è¢«ç¡®è®¤çå°±æ¯å®ï¼æ²¡æè¢«ç¡®è®¤ï¼ä½æ¯å·²ç»æè³å°ä¸ä¸ªåºå·å¤§äºå®çæ°æ®åéè¿ Selective ACK è¢«ç¡®è®¤ï¼é£ä¹è¿ä¸ªæ°æ®åè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã</li>\n<li>å¦æ <code>ack_nr + 1</code> è¿ä¸ªåå·²ç»åéäºï¼èæ¶å°ä¸ä¸ªéå¤ç <code>ack_nr</code> ç ACKï¼é£ä¹ <code>ack_nr + 1</code>è¿ä¸ªåè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã</li>\n</ul>\n<p>å¦ææ£æµå°ä¸¢åï¼é£ä¹æ¥å¡çªå£ <strong>max_window</strong> å¤§å°ååã</p>\n<h2 id=\"è¶æ¶\"><a href=\"#è¶æ¶\" class=\"headerlink\" title=\"è¶æ¶\"></a>è¶æ¶</h2><p>ÂµTP çè¶æ¶è®¡æ¶å TCP ä¸­ RTO è®¡æ¶å¨ä¸å¤ªä¸æ ·ï¼RTO è®¡æ¶å¨ä¸»è¦ç¨äºå¯¹ ACK çè®¡æ¶ï¼ä½æ¯ãÂµTP çè®¡æ¶å¨åæ¯ææ¥æ¶ä»»ä½æ°æ®åè¶æ¶æ¶é´ï¼å¦æè¶æ¶æ¶é´åæ²¡æä»»ä½æ°æ®åå°è¾¾åè¶æ¶ï¼å¦æè¶æ¶ï¼å <strong>packet_size</strong> å <strong>max_window</strong> å°é½ä¼è¢«è®¾ç½®ä¸ºæå°æ°æ®åå¤§å°ï¼150 å­èï¼ã <strong>ï¼çé®ï¼ï¼packet_size çè°æ´ç­ç¥æ¯ä»ä¹ï¼</strong></p>\n<h3 id=\"è¶æ¶æ¶é´çè®¡ç®\"><a href=\"#è¶æ¶æ¶é´çè®¡ç®\" class=\"headerlink\" title=\"è¶æ¶æ¶é´çè®¡ç®\"></a>è¶æ¶æ¶é´çè®¡ç®</h3><p>æ¯å½æ¶å°ä¸ä¸ªæ°æ®åç ACKï¼å°±ä¼æ´æ°å¾è¿æ¶é´ï¼ä¸èèéä¼ çåï¼ï¼å¾è¿æ¶é´ç¨äºè®¡ç®è¶æ¶æ¶é´ãåè¯´æä¸ç¸å³çåéï¼</p>\n<ul>\n<li><strong><em>rtt</em></strong>ï¼å¾è¿æ¶é´ï¼</li>\n<li><strong><em>rtt_var</em></strong>ï¼å¾è¿æ¶é´å·®å¼ï¼</li>\n<li><strong><em>packet_rtt</em></strong>ï¼å½åæ¶å° ACK å¯¹åºçåçå¾è¿æ¶é´ï¼å³å½åæ¶é´åå»è¿ä¸ªååéæ¶çæ¶é´ï¼å³é¦é¨ä¸­ç timestamp å­æ®µè®°å½çå¼ã</li>\n<li><strong><em>timeout</em></strong>ï¼è¶æ¶æ¶é´ï¼</li>\n</ul>\n<p>éè¿ä»¥ä¸å¬å¼æ´æ° rttï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delta = rtt - packet_rtt</span><br><span class=\"line\">rtt_var += (abs(delta) - rtt_var) / 4;</span><br><span class=\"line\">rtt += (packet_rtt - rtt) / 8;</span><br></pre></td></tr></table></figure></p>\n<p>æ­£å¸¸æåµä¸éè¿ rtt è®¡ç®å¾å° timeoutï¼ç¬¬ä¸æ¬¡ç±äºæ²¡æ rttï¼timeout ä½¿ç¨åå§å¼ 1000 msï¼ï¼ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timeout = max(rtt + rtt_var * 4, 500);</span><br></pre></td></tr></table></figure></p>\n<p>å¦æéå°è¶æ¶ï¼å timeout ç¿»åã</p>\n<h2 id=\"æ¥å¡æ§å¶\"><a href=\"#æ¥å¡æ§å¶\" class=\"headerlink\" title=\"æ¥å¡æ§å¶\"></a>æ¥å¡æ§å¶</h2><p>å¨<strong>ä¸¢å</strong>å<strong>è¶æ¶</strong>é¨åå·²ç»æ¶åå°æ¥å¡çªå£çè°æ´äºãÂµTP çæ¥å¡æ§å¶å¯ä»¥çè§£ä¸ºä¸ç§åºäºå»¶è¿çè´åé¦æ¥å¡æ§å¶ï¼éè¿å»¶è¿çååæ§å¶çªå£å¤§å°çååï¼è¾¾å°æ¥å¡æ§å¶ç®çãè®¡ç®çªå£å¤§å°è¿ç¨ä¸­çç¸å³å¸¸éååéçå®ä¹å¦ä¸ï¼</p>\n<ul>\n<li><strong><em>CONTROL_TARGET</em></strong>ï¼ÂµTP æè½æ¥æ¶çä¸è¡ç¼å²å»¶è¿ï¼ç°å¨æ¯ 100 msï¼</li>\n<li><strong><em>base_delay</em></strong>ï¼ä¸¤åéåçæ¶å°çæ°æ®åçæä½å»¶è¿ï¼</li>\n<li><strong><em>our_delay</em></strong>ï¼å½åçæ°æ®åå»¶è¿ï¼</li>\n<li><strong><em>off_target</em></strong>ï¼å®éå»¶è¿åç®æ å»¶è¿çå·®è·ãå³<code>CONTROL_TARGET - our_delay</code>ï¼</li>\n<li><strong><em>outstanding_packet</em></strong>ï¼å·²ç»è¢«åéä½æ¯æªè¢«ç¡®è®¤çæ°æ®åï¼</li>\n</ul>\n<p>å·ä½è®¡ç®è¿ç¨å¦ä¸ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delay_factor = off_target / CCONTROL_TARGET;</span><br><span class=\"line\">window_factor = outstanding_packet / max_window;</span><br><span class=\"line\">scaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;</span><br><span class=\"line\"></span><br><span class=\"line\">max_window += scaled_gain;</span><br></pre></td></tr></table></figure></p>\n<p>å½ <code>off_target &gt; 0</code> æ¶ï¼å½ååçå»¶è¿æ¶é´æ¯è®¾å®çè¿å°ä¸äºï¼é£ä¹çªå£ä¼ç¼©å°ï¼åééçå°±ä¼æ¾æ¢ï¼åä¹ï¼çªå£å¢å ï¼éçå å¿«ã</p>\n<h2 id=\"åèèµæ\"><a href=\"#åèèµæ\" class=\"headerlink\" title=\"åèèµæ\"></a>åèèµæ</h2><ol>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817 - Low Extra Delay Background Transport (LEDBAT)</a></li>\n<li><a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/\" target=\"_blank\" rel=\"noopener\">Calvinâs Marbles - libutpæºç ç®æ</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>å¨ <a href=\"/2018/07/20/tcp/\" title=\"TCP æ¸©æç¥æ°\">TCP æ¸©æç¥æ°</a>ä¸­åé¡¾äº TCPï¼èè¿ç¯æç« ä¸»è¦è®²ç¨äº BT ç½ç»çåºäº UDP çè¿è¾å±åè®® ÂµTPï¼åæ¶é¡ºä¾¿åé¡¾ UDPãä¸é¢çåå®¹æ´å¤æ¯åºäºå¯¹ <a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BEP29</a> ï¼BitTorrent ç 29 å·ææ¡ï¼æèç´ç¿»ä¸ºå¢å¼ºå»ºè®®ï¼ç±»ä¼¼çæ JEPï¼PEPï¼ççè§£ã</p>\n<h2 id=\"åå­æ¢ç©¶\"><a href=\"#åå­æ¢ç©¶\" class=\"headerlink\" title=\"åå­æ¢ç©¶\"></a>åå­æ¢ç©¶</h2><p>ââÂµTP çä¸»è¦ææ¡£ BEP29 çåå»ºäº 2009 å¹´ï¼å§ä¸è®¤ä¸ºè¿ä¹æ¯è®¾è®¡å®æçå¤§è´æ¶é´ï¼ÂµTP å¨ uTorrent ç 1.8 ä¸­é¦æ¬¡å å¥ï¼2009 å¹´ï¼è¿ä¸ªäºå®ä¹ä½è¯äºè¿ç¹ãå®çè®¾è®¡èåæ¬ï¼</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Ludvig_Strigeus\" target=\"_blank\" rel=\"noopener\">Ludvig Strigeus</a>ï¼Î¼Torrent ä½èï¼BitTorrent å¬å¸ 2006 å¹´æ¶è´­ Î¼Torrentï¼ç®åå¨ Spotify å·¥ä½ï¼</li>\n<li>Greg Hazel</li>\n<li><a href=\"https://www.linkedin.com/in/shalunov\" target=\"_blank\" rel=\"noopener\">Stanislav Shalunov</a>ï¼ÂµTP ä¸­çæ¥å¡ç®æ³ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">LEDBAT</a> ä¸»è¦ä½èï¼åæ¥è¿åé äºå¯ä»¥è±ç¦»ç°æèçªç½ç»ä½¿ç¨ç IM åºç¨ <a href=\"https://www.opengarden.com/firechat.html\" target=\"_blank\" rel=\"noopener\">FireChat</a> ââ å®è¢«å¤æ¬¡ç¨å°âå ä¸­âè¿æ ·çå¬æ°è¿å¨ä¸­ï¼</li>\n<li>Arvid Norbergï¼libtorrent å¼åèï¼ç®åå¨ <a href=\"https://blockstream.com/\" target=\"_blank\" rel=\"noopener\">Blockstream</a> å·¥ä½ï¼</li>\n<li>Bram Cohenï¼BitTorrent ä½èï¼</li>\n</ul>\n<h2 id=\"è®¾è®¡åå \"><a href=\"#è®¾è®¡åå \" class=\"headerlink\" title=\"è®¾è®¡åå \"></a>è®¾è®¡åå </h2><p>ââå¨è¿å»å¤å¹´åï¼å¦æä½¿ç¨ BT è¿è¡ä¸è½½ç­é¨èµæºçè¯å¯ä»¥æåå°å°éåº¦é£å¿«ï¼ä½æ¯åæ¶å¸¦æ¥çé®é¢å°±æ¯å¦ææ³è¦åæ¶çå¨çº¿è§é¢å°±ä¼å¸¦æ¥å¡é¡¿ãé®é¢å¨äº DSL å modem çå¾å¾æä¸ä¸ªåå®ä»¬çåééçä¸ææ¯ä¾çåéç¼å²åºï¼ä¸ææ¯ä¾å°å¯ä»¥å®¹çº³å ç§éçæ°æ®éãè BT å¾å¾ä¼ä¸è®¸å¤ peer å»ºç« TCP è¿æ¥ï¼å¨ TCP å°å¸¦å®½ååå°åéå°æ¯ä¸ªè¿æ¥çåæä¸ï¼BT å°±å ç¨äºè¾å¤çå¸¦å®½ï¼ä½æ¯å¶ä»è¯¸å¦æµè§ç½é¡µãå³æ¶éè®¯è¿äºåºæ¯çä¼åçº§å®éä¸åºè¯¥è¦æ¯ BT ä¼ è¾æ´é«äºï¼ä½æ¯å ä¸º BT å ç©çå±çè¿ç§ç¹æ§å¯¼è´äºå¶ä»æå¡æå»¶è¿ï¼å½±åäºä½¿ç¨ BT æ¶å¶ä»æå¡çä½éªã<br>ââÂµTP éè¿å° modem çç¼å²éåçå¤§å°ä½ä¸ºä¸ä¸ªæ§å¶å å­æ¥è°æ´åééçï¼å½éåè¿å¤§æ¶ï¼å°ä¼æ¾æ¢åééåº¦ãè¿ç§ç­ç¥ä½¿å¾ BT å¨æ²¡æç«äºçæåµä¸å¯ä»¥ååå©ç¨ä¸ä¼ å¸¦å®½ï¼å¨æå¤§éå¶ä»æµéçæåµä¸åæ¾æ¢åééçã<br>ââä¸è¿°æ¶ Bittorrent ææ¡£ä¸­çè¯´æ³ï¼ä½æ¯å®éä¸ ÂµTP æ¯åºäºåçå»¶æ¶çï¼èä¸æ¯åºäºéåå¤§å°çãèä¸ ÂµTP å·ä½å¯¹æ¥å¡ç®æ³ LEDBAT çå®ç°æä¸å¨ IETF äºèç½èæ¡ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817</a> ä¸­çæè¿°ææåºå«ï¼è¿éçå®ç°æ C++ çæ¬ç <a href=\"https://github.com/bittorrent/libutp\" target=\"_blank\" rel=\"noopener\">libutp</a>ï¼åä¸ªçæ¬çå®ç°ä¸å®å¨ä¸è´ï¼ã</p>\n<h2 id=\"UDP-å-ÂµTP-é¦é¨\"><a href=\"#UDP-å-ÂµTP-é¦é¨\" class=\"headerlink\" title=\"UDP å ÂµTP é¦é¨\"></a>UDP å ÂµTP é¦é¨</h2><p>ââä¸ºäºæ¹ä¾¿ä¸ TCP åç®åçå¯¹æ¯ï¼æ UDP çé¦é¨ï¼ååä¸ªå­èï¼ä¸ ÂµTP çé¦é¨ï¼å©ä½é¨åï¼æ¾å¨äºä¸ä¸ªå¾ä¸­ç¤ºæãä» UDP é¦é¨å­æ®µæ°éçå¯ä»¥åç° UDP åè®®ç¸å¯¹ TCP åè®®æ¯å¦æ­¤ç®åï¼ä»¥è³äºæä»¬wå¯ä»¥å° TCP åè®®çææ¯ç±»ä¼¼ ÂµTP åè®®ä¸æ ·çåºäº UDP åè®®çè¿è¾å±åè®®ã<br><img src=\"udp_utp_header.png\" alt=\"UDP Header And ÂµTP Header\"></p>\n<h3 id=\"UDP-é¦é¨\"><a href=\"#UDP-é¦é¨\" class=\"headerlink\" title=\"UDP é¦é¨\"></a>UDP é¦é¨</h3><ul>\n<li><strong>æº / ç®ç«¯å£ï¼Source / Destination portï¼</strong>ï¼ç¨äºç¡®è®¤éä¿¡è¿ç¨åæ¹ãæºç«¯å£æ¯å¯éçï¼å¦æè®¾ç½®äºæºç«¯å£ï¼åæ¥æ¶æ¹å°å¶è§ä¸ºåå¤ç«¯å£ãå¦æä¸éè¦åå¤å°±ä¸éè¦è®¾ç½®ï¼</li>\n<li><strong>æ»é¿åº¦ï¼Lengthï¼</strong>ï¼å®ä¹äº UDP ç¨æ·æ°æ®æ¥çæ»é¿åº¦ï¼åæ¬é¦é¨åæ°æ®ãTCP é¦é¨ä¸­æ¯æ²¡ææè°âæ¥ææ®µæ»é¿åº¦âçå­æ®µçï¼é¿åº¦å¯ä»¥éè¿ IP å±çé¿åº¦åå» IP é¦é¨é¿åº¦è®¡ç®æå¾ï¼æä»¥ä¸å®ç¨åº¦ä¸æ¶åä½çï¼å¯ä»¥åè Stack OverFlow ä¸ç<a href=\"https://stackoverflow.com/a/16748680/5091903\" target=\"_blank\" rel=\"noopener\">ç¸å³è®¨è®º</a>ï¼</li>\n<li><strong>æ ¡éªåï¼Checksumï¼</strong>ï¼ç¨äºå¯¹æ´ä¸ªç¨æ·æ°æ®æ¥çæ ¡éªï¼éè¿ IP ä½é¦é¨ä¸åç¨æ·æ°æ®æ¥è®¡ç®å¾å°ï¼</li>\n</ul>\n<p>ââå¯è§ UDP é¦é¨çè¿äºå­æ®µå¨çè®ºä¸å¯ä»¥æ¯ TCP é¦é¨å­æ®µçå­éãå æ­¤æä»¬å¯ä»¥ç²ç¥å°è®² <strong>TCP æ¯åºäº UDP çä¼ è¾å±åè®®ã</strong><br>ââUDP æå¡æ¯ä¸ä¸ªâå°½åèä¸ºâçæå¡ï¼å®<strong>æ²¡ææµéæ§å¶</strong>ï¼<strong>åªè½éè¿æ ¡éªåè¿è¡å·®éæ§å¶ï¼ä¸¢åä¸ä¼ç¥æï¼ä¹ä¸ä¼éä¼ </strong>ï¼ä¹<strong>æ²¡ææ¥å¡æ§å¶</strong>ã</p>\n<h3 id=\"ÂµTP-é¦é¨\"><a href=\"#ÂµTP-é¦é¨\" class=\"headerlink\" title=\"ÂµTP é¦é¨\"></a>ÂµTP é¦é¨</h3><ul>\n<li><strong>version</strong>ï¼çæ¬å·ï¼ç°å¨ä¸º 1ï¼<a href=\"https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c\" target=\"_blank\" rel=\"noopener\">è¿æä¸ä¸ªåå§çæ¬å· 0 å­å¨</a></li>\n<li><strong>connection_id</strong>ï¼ç¨äºæ è®°è¿æ¥ã<a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98\" target=\"_blank\" rel=\"noopener\">è¿ä¸ªå­æ®µæ¯å¿é¡»çä¹?</a>ï¼</li>\n<li><strong>timestamp_microseconds</strong>ï¼åéæ°æ®åçæ¶é´ï¼åè®¡ç®å»¶è¿æ¶é´ï¼rtt ç¸å³ï¼</li>\n<li><strong>timestamp_difference_microseconds</strong>ï¼å½åæ¶é´åä¸ä¸æ¬¡æ¶å°çåä¸­ç timestamp_microseconds ä¹å·®ï¼</li>\n<li><strong>wnd_size</strong>ï¼è¡¨ç¤ºå¦ä¸ç«¯å»ºè®®ççªå£å¤§å°ï¼ç¸å½äº TCP ä¸­çæ¥æ¶çªå£ï¼</li>\n<li><strong>extension</strong>ï¼ä»£è¡¨ç¬¬ä¸ä¸ªæ©å±çç±»åï¼0 è¡¨ç¤ºæ²¡ææ©å±ï¼1 è¡¨ç¤º Selective ACKsï¼éæ©ç¡®è®¤æ©å±ï¼ã</li>\n<li><strong>type</strong>ï¼æ°æ®åçç±»åãå¯ä»¥æï¼<ul>\n<li>ST_DATA  = 0ï¼æ¿è½½æææ°æ®çæ°æ®åï¼</li>\n<li>ST_FIN   = 1ï¼ç»æ­¢è¿æ¥ãæ¯éä¿¡åæ¹åéçæåä¸ä¸ªåï¼ç±»ä¼¼äº TCP ç FIN æ è®°ãä½æ¯åé ST_FIN çä¸æ¹è¿æ¯ä¼ç­å¾å¯è½ä¸¢å¤±æèå¤±åºå°è¾¾çåï¼å³ä½¿æ¶å°äºå¯¹æ¹ç ST_FIN åï¼</li>\n<li>ST_STATE = 2ï¼ç¨äºæ¥åç¶æï¼ä¼ è¾ä¸ä¸ªæ²¡ææ°æ®ç ACKãå TCP ä¸­æªæºå¸¦æ°æ®ç ACK åä¸æ ·ï¼å®ä¸æ¶èåºå·ï¼</li>\n<li>ST_RESET = 3ï¼å¼ºå¶éç½®è¿æ¥ãç±»ä¼¼ TCP ç RST æ è®°ã</li>\n<li>ST_SYN   = 4ï¼åèµ·è¿æ¥ãç±»ä¼¼ TCP ç SYN æ è®°ãåèµ·æ¹ä¼éæºä¸ä¸ª connection_id ID ç¨äºç»æ¥æ¶æ¹åç»­çåå¤ä½¿ç¨ãç¶ååèµ·æ¹ä¹åçåä¸­ä¼ è¾ç connection_id ä¸º ID + 1ï¼</li>\n</ul>\n</li>\n<li><strong>seq_nr</strong>ï¼è¡¨ç¤ºè¿ä¸ªæ°æ®åçåºå·ãæ³¨æå TCP ä¸­ä»£è¡¨å­å·å·çåºå·ææä¸åãåå§åºå·åæ ·ä¹æ¯éæºçæã</li>\n<li><strong>ack_nr</strong>ï¼è¡¨ç¤ºæåæ¶å°çæ°æ®åçseq_nrï¼</li>\n</ul>\n<h2 id=\"è¿æ¥è¿ç¨\"><a href=\"#è¿æ¥è¿ç¨\" class=\"headerlink\" title=\"è¿æ¥è¿ç¨\"></a>è¿æ¥è¿ç¨</h2><p>ââå¾ç¤ºä¸ºä¸æ¬¡å¨ qBittorrent ä¸­å¯¹ä¸ä¸ªç§å­å¼å§ BT ä¸è½½äºåç§å·¦å³ååæ­¢ä¸è½½æ¶ï¼ä¸å¶ä¸­ä¸ä¸ª peer çäº¤äºè¿ç¨ã<br><img src=\"wireshark.png\" alt=\"è¿æ¥è¿ç¨ï¼ä»¥ connection_id ä¸º 8671 å 8672 çè¿ä¸ä¸ªè¿ç¨ä¸ºä¾ï¼\"></p>\n<h2 id=\"ä¸¢å\"><a href=\"#ä¸¢å\" class=\"headerlink\" title=\"ä¸¢å\"></a>ä¸¢å</h2><p>åä¸¢åå¤çæä¸ä¸ªåçªå£ç¸å³çåééè¦åè¿è¡è¯´æï¼</p>\n<ul>\n<li><strong><em>max_window</em></strong>ï¼å®ä¹äºæªè¢«ç¡®è®¤çå­èçä¸éï¼ç¸å½ä¸ TCP ä¸­çæ¥å¡çªå£ï¼</li>\n<li><strong><em>wnd_size</em></strong>ï¼åé¦é¨ä¸­ç wnd_sizeï¼å TCP ä¸­ç¸åï¼å®éçåéçªå£å¤§å°ä¸º <code>min(max_windows, wnd_size)</code>ï¼</li>\n<li><strong><em>cur_window</em></strong>ï¼è¡¨ç¤ºå½åæªè¢«ç¡®è®¤çå­èçæ°éï¼</li>\n</ul>\n<p>å½éè¦åéæ°æ®åæ¶ï¼ä»å½ <code>cur_window + packet_size &lt;= min(max_windows, wnd_size)</code> æç«ï¼è¿ä¸ªæ°æ®åæè½è¢«åéã</p>\n<ul>\n<li>å½åºå·ä¸º <code>seq_nr - cur_window</code> çæ°æ®åï¼åééåä¸­å¹´é¾æå¤§çæªè¢«ç¡®è®¤çæ°æ®åï¼ä¸ä¸ä¸ªçè®ºä¸éè¦è¢«ç¡®è®¤çå°±æ¯å®ï¼æ²¡æè¢«ç¡®è®¤ï¼ä½æ¯å·²ç»æè³å°ä¸ä¸ªåºå·å¤§äºå®çæ°æ®åéè¿ Selective ACK è¢«ç¡®è®¤ï¼é£ä¹è¿ä¸ªæ°æ®åè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã</li>\n<li>å¦æ <code>ack_nr + 1</code> è¿ä¸ªåå·²ç»åéäºï¼èæ¶å°ä¸ä¸ªéå¤ç <code>ack_nr</code> ç ACKï¼é£ä¹ <code>ack_nr + 1</code>è¿ä¸ªåè¢«è®¤ä¸ºæ¯ä¸¢å¤±äºã</li>\n</ul>\n<p>å¦ææ£æµå°ä¸¢åï¼é£ä¹æ¥å¡çªå£ <strong>max_window</strong> å¤§å°ååã</p>\n<h2 id=\"è¶æ¶\"><a href=\"#è¶æ¶\" class=\"headerlink\" title=\"è¶æ¶\"></a>è¶æ¶</h2><p>ÂµTP çè¶æ¶è®¡æ¶å TCP ä¸­ RTO è®¡æ¶å¨ä¸å¤ªä¸æ ·ï¼RTO è®¡æ¶å¨ä¸»è¦ç¨äºå¯¹ ACK çè®¡æ¶ï¼ä½æ¯ãÂµTP çè®¡æ¶å¨åæ¯ææ¥æ¶ä»»ä½æ°æ®åè¶æ¶æ¶é´ï¼å¦æè¶æ¶æ¶é´åæ²¡æä»»ä½æ°æ®åå°è¾¾åè¶æ¶ï¼å¦æè¶æ¶ï¼å <strong>packet_size</strong> å <strong>max_window</strong> å°é½ä¼è¢«è®¾ç½®ä¸ºæå°æ°æ®åå¤§å°ï¼150 å­èï¼ã <strong>ï¼çé®ï¼ï¼packet_size çè°æ´ç­ç¥æ¯ä»ä¹ï¼</strong></p>\n<h3 id=\"è¶æ¶æ¶é´çè®¡ç®\"><a href=\"#è¶æ¶æ¶é´çè®¡ç®\" class=\"headerlink\" title=\"è¶æ¶æ¶é´çè®¡ç®\"></a>è¶æ¶æ¶é´çè®¡ç®</h3><p>æ¯å½æ¶å°ä¸ä¸ªæ°æ®åç ACKï¼å°±ä¼æ´æ°å¾è¿æ¶é´ï¼ä¸èèéä¼ çåï¼ï¼å¾è¿æ¶é´ç¨äºè®¡ç®è¶æ¶æ¶é´ãåè¯´æä¸ç¸å³çåéï¼</p>\n<ul>\n<li><strong><em>rtt</em></strong>ï¼å¾è¿æ¶é´ï¼</li>\n<li><strong><em>rtt_var</em></strong>ï¼å¾è¿æ¶é´å·®å¼ï¼</li>\n<li><strong><em>packet_rtt</em></strong>ï¼å½åæ¶å° ACK å¯¹åºçåçå¾è¿æ¶é´ï¼å³å½åæ¶é´åå»è¿ä¸ªååéæ¶çæ¶é´ï¼å³é¦é¨ä¸­ç timestamp å­æ®µè®°å½çå¼ã</li>\n<li><strong><em>timeout</em></strong>ï¼è¶æ¶æ¶é´ï¼</li>\n</ul>\n<p>éè¿ä»¥ä¸å¬å¼æ´æ° rttï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delta = rtt - packet_rtt</span><br><span class=\"line\">rtt_var += (abs(delta) - rtt_var) / 4;</span><br><span class=\"line\">rtt += (packet_rtt - rtt) / 8;</span><br></pre></td></tr></table></figure></p>\n<p>æ­£å¸¸æåµä¸éè¿ rtt è®¡ç®å¾å° timeoutï¼ç¬¬ä¸æ¬¡ç±äºæ²¡æ rttï¼timeout ä½¿ç¨åå§å¼ 1000 msï¼ï¼ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timeout = max(rtt + rtt_var * 4, 500);</span><br></pre></td></tr></table></figure></p>\n<p>å¦æéå°è¶æ¶ï¼å timeout ç¿»åã</p>\n<h2 id=\"æ¥å¡æ§å¶\"><a href=\"#æ¥å¡æ§å¶\" class=\"headerlink\" title=\"æ¥å¡æ§å¶\"></a>æ¥å¡æ§å¶</h2><p>å¨<strong>ä¸¢å</strong>å<strong>è¶æ¶</strong>é¨åå·²ç»æ¶åå°æ¥å¡çªå£çè°æ´äºãÂµTP çæ¥å¡æ§å¶å¯ä»¥çè§£ä¸ºä¸ç§åºäºå»¶è¿çè´åé¦æ¥å¡æ§å¶ï¼éè¿å»¶è¿çååæ§å¶çªå£å¤§å°çååï¼è¾¾å°æ¥å¡æ§å¶ç®çãè®¡ç®çªå£å¤§å°è¿ç¨ä¸­çç¸å³å¸¸éååéçå®ä¹å¦ä¸ï¼</p>\n<ul>\n<li><strong><em>CONTROL_TARGET</em></strong>ï¼ÂµTP æè½æ¥æ¶çä¸è¡ç¼å²å»¶è¿ï¼ç°å¨æ¯ 100 msï¼</li>\n<li><strong><em>base_delay</em></strong>ï¼ä¸¤åéåçæ¶å°çæ°æ®åçæä½å»¶è¿ï¼</li>\n<li><strong><em>our_delay</em></strong>ï¼å½åçæ°æ®åå»¶è¿ï¼</li>\n<li><strong><em>off_target</em></strong>ï¼å®éå»¶è¿åç®æ å»¶è¿çå·®è·ãå³<code>CONTROL_TARGET - our_delay</code>ï¼</li>\n<li><strong><em>outstanding_packet</em></strong>ï¼å·²ç»è¢«åéä½æ¯æªè¢«ç¡®è®¤çæ°æ®åï¼</li>\n</ul>\n<p>å·ä½è®¡ç®è¿ç¨å¦ä¸ï¼<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delay_factor = off_target / CCONTROL_TARGET;</span><br><span class=\"line\">window_factor = outstanding_packet / max_window;</span><br><span class=\"line\">scaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;</span><br><span class=\"line\"></span><br><span class=\"line\">max_window += scaled_gain;</span><br></pre></td></tr></table></figure></p>\n<p>å½ <code>off_target &gt; 0</code> æ¶ï¼å½ååçå»¶è¿æ¶é´æ¯è®¾å®çè¿å°ä¸äºï¼é£ä¹çªå£ä¼ç¼©å°ï¼åééçå°±ä¼æ¾æ¢ï¼åä¹ï¼çªå£å¢å ï¼éçå å¿«ã</p>\n<h2 id=\"åèèµæ\"><a href=\"#åèèµæ\" class=\"headerlink\" title=\"åèèµæ\"></a>åèèµæ</h2><ol>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817 - Low Extra Delay Background Transport (LEDBAT)</a></li>\n<li><a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/\" target=\"_blank\" rel=\"noopener\">Calvinâs Marbles - libutpæºç ç®æ</a></li>\n</ol>\n"}],"PostAsset":[{"_id":"source/_posts/tcp/wireshark.png","slug":"wireshark.png","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0},{"_id":"source/_posts/Âµtp/udp_utp_header.png","slug":"udp_utp_header.png","post":"cjknq4rfr000a2ofnm2u6ykix","modified":0,"renderable":0},{"_id":"source/_posts/Âµtp/wireshark.png","slug":"wireshark.png","post":"cjknq4rfr000a2ofnm2u6ykix","modified":0,"renderable":0},{"_id":"source/_posts/tcp/congestion_control_example.png","slug":"congestion_control_example.png","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0},{"_id":"source/_posts/tcp/sliding_window.png","slug":"sliding_window.png","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0},{"_id":"source/_posts/tcp/tcp_connection.png","slug":"tcp_connection.png","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0},{"_id":"source/_posts/tcp/tcp_header.png","slug":"tcp_header.png","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0},{"_id":"source/_posts/tcp/todo.mdx","slug":"todo.mdx","post":"cjknq4rfq00092ofnwap3aifd","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"cjknq4rf600022ofns11gjbgw","tag_id":"cjknq4rfa00052ofnslxxuhux","_id":"cjknq4rfd00072ofnsu3vysa2"},{"post_id":"cjknq4rf800042ofnduiqlpkx","tag_id":"cjknq4rfc00062ofnksz4270w","_id":"cjknq4rfh00082ofnh42u6dpp"},{"post_id":"cjknq4rfq00092ofnwap3aifd","tag_id":"cjknq4rfs000b2ofntq5mo0ql","_id":"cjknq4rfu000d2ofntmn4gglk"},{"post_id":"cjknq4rfr000a2ofnm2u6ykix","tag_id":"cjknq4rfs000b2ofntq5mo0ql","_id":"cjknq4rfv000f2ofn62byqmcl"},{"post_id":"cjknq4rfr000a2ofnm2u6ykix","tag_id":"cjknq4rfu000e2ofn1vz70ew1","_id":"cjknq4rfv000g2ofnjsrrz4kk"}],"Tag":[{"name":"BlockChain","_id":"cjknq4rfa00052ofnslxxuhux"},{"name":"Essay","_id":"cjknq4rfc00062ofnksz4270w"},{"name":"Network","_id":"cjknq4rfs000b2ofntq5mo0ql"},{"name":"BT","_id":"cjknq4rfu000e2ofn1vz70ew1"}]}}